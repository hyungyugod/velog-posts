# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡  ì½”ë”© í”„ë¡œì íŠ¸
### ğŸ“Œ 0-1. ë¡œê·¸ì•„ì›ƒì‹œ ì„¸ì…˜ ê¼¬ì„ ë¬¸ì œ
```js
const logoutButton = document.querySelector(".logout");
if (logoutButton) {
    let logoutInProgress = false; // ì¤‘ë³µ ìš”ì²­ ë°©ì§€
    
    logoutButton.addEventListener("click", async (e) => {
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
        
        // ì´ë¯¸ ë¡œê·¸ì•„ì›ƒì´ ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
        if (logoutInProgress) {
            return;
        }
        
        logoutInProgress = true;
        
        try {
            const response = await fetch('/api/logout', {
                method: 'POST',
                credentials: 'same-origin' // ì„¸ì…˜ ì¿ í‚¤ í¬í•¨
            });

            // ì‘ë‹µì„ ì™„ì „íˆ ë°›ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
            const data = await response.json();

            // ì„œë²„ ì‘ë‹µì´ ì„±ê³µì´ë“  ì‹¤íŒ¨ë“  ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            if (response.ok && data.success) {
                // ì„±ê³µ ì‹œì—ë§Œ ë©”ì‹œì§€ í‘œì‹œ
                alert(data.message);
            }
            
        } catch (error) {
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
            alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.');
        } finally {
            // ëª¨ë“  ê²½ìš°ì— ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™ (replace ì‚¬ìš©ìœ¼ë¡œ ë’¤ë¡œê°€ê¸° ë°©ì§€)
            window.location.replace('/main');
        }
    });
}
```
```java
@PostMapping("/api/logout")
    public ResponseEntity<ResponseDTO> logout(HttpServletRequest request) {
        // ì„¸ì…˜ ë¬´íš¨í™” ì²˜ë¦¬
        HttpSession session = request.getSession(false);
        if (session != null && !session.isNew()) {
            session.removeAttribute("memberInfo");
            session.invalidate();
        }
        
        ResponseDTO response = ResponseDTO.builder()
                .success(true)
                .message("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.")
                .timestamp(LocalDateTime.now())
                .build();
        return ResponseEntity.ok(response);
    }
```

### ğŸ“Œ 0-2. ì²´í¬ë°•ìŠ¤ ì›í˜•ìœ¼ë¡œ ë§Œë“¤ê³  ë‚´ë¶€ì— ì› ë„£ê¸°
- appearance: none; ì´ê±¸ë¡œ ê¸°ë³¸ ëª¨ì–‘ì„ ì§€ìš´ë‹¤. ì´í›„  border-radius: 50%; ë¡œ ì›ì„ ë§Œë“ ë‹¤.
- &:checkedë¡œ ì²´í¬ë˜ì—ˆì„ë•Œ ë°°ê²½ì„ background-color: #fff; í°ìƒ‰ìœ¼ë¡œ ë§Œë“ ë‹¤.
- &::after ë¡œ ë‚´ë¶€ì— ê°€ìƒìš”ì†Œë¥¼ ë„£ëŠ”ë° content: ''; ë¡œ ë¹ˆ ìš”ì†Œë¥¼ ë„£ê³  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);ë¡œ ê°€ìš´ë°ì— ìœ„ì¹˜ë¥¼ ì¡ê³  
- border-radius: 50%;ì™€ background-color: #333;ë¡œ ë‚´ë¶€ì— ê²€ì€ ì›ì„ ë§Œë“¤ì–´ ë””ìì¸í•œë‹¤.
```css
input[type="checkbox"] {
    display: inline-block;
    width: 15px;
    height: 15px;
    margin-right: 4px;
    margin-top: 1px;
    accent-color: #333;
    margin-bottom: 0px !important;
    border-radius: 50%;
    appearance: none;
    border: 1px solid #ccc;
    background-color: #fff;
    cursor: pointer;
    position: relative;
    
    &:checked {
        background-color: #fff;
        border-color: #333;
        
        &::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
        }
    }
}
```

### ğŸ“Œ 0-3. ì „ì²´ ì˜ì—­ ì¤‘ ì¼ë¶€ê°€ ë¶™ì–´ìˆê²Œ í•˜ê¸°
- position: sticky;: í‰ìƒì‹œì—ëŠ” ì¼ë°˜ì ì¸ position: relative ì²˜ëŸ¼ ë™ì‘í•˜ë‹¤ê°€ ìš”ì†Œê°€ ìŠ¤í¬ë¡¤ì— ë”°ë¼ íŠ¹ì • ìœ„ì¹˜ì— "ê³ ì •"ë˜ë„ë¡ í•œë‹¤. top: 60px;ì˜ ìœ„ì¹˜ì— ê³ ì •ëœë‹¤.
- JavaScriptì—ì„œ footerê°€ ë³´ì´ë©´ .stop í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ sticky íš¨ê³¼ë¥¼ í•´ì œí•˜ëŠ” íš¨ê³¼ë¥¼ ë„£ì—ˆë‹¤.
```css
.sticky-box {
        position: sticky;
        top: 60px;

        &.stop {
        position: static !important;
        }
    } 
```
- Footer ê°ì§€: Footerê°€ í™”ë©´ì— ë‚˜íƒ€ë‚˜ë©´ (entry.isIntersecting = true)ê°€ ëœë‹¤.
- IntersectionObserverì€ í™”ë©´ì„ ê°ì§€í•˜ëŠ” ë„êµ¬ì´ë‹¤.
- root: nullë¡œ ì „ì²´ í™”ë©´ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ëŠ”ë‹¤.
- 0px 0px -90% 0px = í•˜ë‹¨ì—ì„œ 90% ìœ„ìª½ì—ì„œ ê°ì§€ ì¦‰, footerê°€ í™”ë©´ í•˜ë‹¨ 10% ì§€ì ì— ë„ë‹¬í•˜ë©´ ê°ì§€í•œë‹¤.
```js
const stickyElement = document.getElementById('paySticky');
const footerElement = document.querySelector('footer');

// IntersectionObserverë¡œ Footerê°€ ë³´ì´ë©´ sticky í•´ì œ
const intersectionObserver = new IntersectionObserver(
    ([entry]) => {
        stickyElement.classList.toggle('stop', entry.isIntersecting);
    },
    {
        root: null,
        threshold: 0,
        rootMargin: "0px 0px -90% 0px"
    }
);
intersectionObserver.observe(footerElement);
```

### ğŸ“Œ 0-4. ì´ˆê¸°ì— ì „ì²´ ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì–´ìˆì§€ ì•Šì€ ë¬¸ì œ
- masterChk.checked = itemChks.length > 0 && itemChks.every(v => v.checked); ì—ì„œ ì´ˆê¸° ì„¤ì • ê°’ì„ ì²´í¬ê°€ í•˜ë‚˜ë¼ë„ ë˜ì–´ìˆê³  ëª¨ë“  ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì–´ìˆë‹¤ë©´ ì „ì²´ ì²´í¬ë„ trueë¡œ í•œë‹¤.
- changeëŠ” ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©´ ë¡œë“œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ masterChkê°€ ì²˜ìŒë¶€í„° ì²´í¬ë˜ì–´ìˆì–´ì•¼ í•œë‹¤ë©´ í•œì¤„ì„ ë¯¸ë¦¬ ì¶”ê°€í•´ë‘ì–´ì•¼ í•œë‹¤. 
```js
/* ì²´í¬ë°•ìŠ¤ ë¡œì§ ì „ì²´/ê°œë³„ */
  const masterChk = document.querySelector('.cart-all-checkbox'); // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
  const itemChks  = Array.from(document.querySelectorAll('.cart-item-checkbox')); // ê°œë³„ ìƒí’ˆ ì²´í¬ë°•ìŠ¤
  if (masterChk) { // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ê°€ ì˜ ë¡œë“œ ë˜ì—ˆë‹¤ë©´
      // ì´ˆê¸° ìƒíƒœ ì²´í¬ - ëª¨ë“  ê°œë³„ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ì „ì²´ ì²´í¬ë°•ìŠ¤ë„ ì²´í¬
      masterChk.checked = itemChks.length > 0 && itemChks.every(v => v.checked);

      masterChk.addEventListener('change', e => {
        itemChks.forEach(c => { 
          c.checked = e.target.checked; // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ì˜ ìƒíƒœì— ë”°ë¼ ê°œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½
        });
    });
```

### ğŸ“Œ 0-5. ê²°ì œ ê¸°ëŠ¥ êµ¬í˜„
- ê²°ì œ ê¸°ëŠ¥ì—ì„œ ê°€ì¥ ë§ì´ ê³ ë¯¼í•œ ê²ƒì€ ì–´ë–»ê²Œ ì¥ë°”êµ¬ë‹ˆ, ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì •ë³´ë¥¼ ë³´ë‚´ì–´ ê²°ì œ í˜ì´ì§€ì— ì–´ë–»ê²Œ íƒ€ì„ë¦¬í”„ë¥¼ ë„ì›Œì£¼ëŠëƒë‹¤.
- ë°”ë¡œ jsì—ì„œ ë™ì ìœ¼ë¡œ í˜ì´ì§€ì˜ ì •ë³´ë¥¼ ì£¼ì›Œì„œ í¼ì„ ìƒì„±í•˜ì—¬ post ë°©ì‹(submit)ìœ¼ë¡œ ë³´ë‚´ëŠ” ë°©ë²•ë„ ìƒê°í–ˆì§€ë§Œ ë°”ë¡œ ì •ë³´ê°€ íœ˜ë°œë˜ëŠ” ë¬¸ì œì™€ ê¹”ë”í•˜ì§€ ì•Šì•˜ë‹¤.
- ë˜ ajaxë¡œ ë°”ë¡œ ë³´ë‚´ë³´ë ¤ê³  í–ˆì§€ë§Œ ajaxë¡œ ë– ë‚œ ìš”ì²­ì— ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë·° ì´ë¦„ìœ¼ë¡œ ì‘ë‹µí•˜ë©´ ì•ˆë˜ì–´ì„œ ì´ ë°©ë²•ë„ êµ¬í˜„í•˜ì§€ ëª»í–ˆë‹¤.
- ê·¸ë˜ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë‘ë²ˆ ê±°ì³ í˜ì´ì§€ë¥¼ ì´ë™í•˜ëŠ” ë°©ë²•ë°–ì— ë‚¨ì§€ì•Šì•˜ëŠ”ë° dbì— ì €ì¥í•  ê²ƒì´ëƒ ì„¸ì…˜ì— ì €ì¥í•  ê²ƒì´ëƒì— ëŒ€í•´ ê³ ë¯¼ì„ ë§ì´ í•˜ì˜€ë‹¤. ì´ë•Œ ì„¸ì…˜ì— ì €ì¥í•˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì„¸ì…˜ ë°©ì‹ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ì¡°ê¸ˆ ì•ˆì •ì„±ì´ ë–¨ì–´ì§€ê³  dbì™€ ì—°ë™í• ë•Œ ê¹”ë”í•˜ì§€ ì•Šì€ ë¬¸ì œê°€ ìˆì–´ì„œ 
- ì²«ë²ˆì§¸ ajax ìš”ì²­ ì‹œì—ëŠ” dbì— ì €ì¥í•œ í›„ ì„±ê³µì‘ë‹µê³¼ ìƒì„±í•œ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ëŒë ¤ì£¼ê³  ì´ë¥¼ í†µí•´ jsì—ì„œ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— í¬í•¨í•˜ì—¬ ì£¼ë¬¸ì„œ ì‘ì„± í˜ì´ì§€ë¡œ ì •ë³´ë¥¼ ì „ì†¡í•˜ë©´ ê·¸ìª½ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ ì£¼ë¬¸ì„œì— ê²°ì œ ëŒ€ê¸°ì¤‘ìœ¼ë¡œ ì €ì¥ëœ ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì™€ íƒ€ì„ë¦¬í”„ë¡œ í˜ì´ì§€ë¥¼ ì™„ì„±í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤.
- ì´ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•˜ê¸° ìœ„í•´ ê¸°ì¡´ì— dbì— ëª¨ë‘ not nullë¡œ ë˜ì–´ìˆë˜ ê¸°ë³¸ ì •ë³´ë“¤ì„ ëª¨ë‘ null í—ˆìš©ìœ¼ë¡œ ë°”ê¿¨ê³  (ì£¼ë¬¸ì„œ ì‘ì„± í˜ì´ì§€ì—ì„œ ì£¼ì†Œ, ìˆ˜ì·¨ì¸ ì •ë³´ë“±ì„ ì¨ì•¼í–ˆìœ¼ë¯€ë¡œ) enumê°’ì— ê²°ì œëŒ€ê¸°ì¤‘ì„ ì¶”ê°€í•˜ì˜€ë‹¤.
- ì•„ë˜ëŠ” ìš°ì„  ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ajax ë³´ë‚´ëŠ” ì½”ë“œì˜ ì£¼ìš” ë¶€ë¶„ë§Œ ë–¼ì„œ ì„¤ëª…í•˜ê² ë‹¤.

#### ì²«ë²ˆì§¸ ajax ìš”ì²­
- cartì—ì„œ ì •ë³´ë¥¼ íƒ€ì„ë¦¬í”„ë¡œ ë¿Œë ¤ë‘˜ë•Œ ìƒí’ˆ ë‹¨ìœ„ë¡œëŠ” ê³µí†µ ì •ë³´ë¥¼, ì˜µì…˜ ë‹¨ìœ„ë¡œëŠ” ì˜µì…˜ ê°ê°ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ dataë¡œ ì…ë ¥í•´ë‘”ë‹¤.
- ì´ë ‡ê²Œ ê³µí†µë°ì´í„°ì™€ ì˜µì…˜ì˜ ê³ ìœ ë°ì´í„°ë¥¼ êµ¬ë¶„í•´ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.
- data- ì´í›„ì˜ color-name ì´ëŸ°ì‹ì˜ ë°ì´í„°ëŠ” jsì—ì„œ colorNameìœ¼ë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```html
<!-- trì—ëŠ” ê³µí†µ ë°ì´í„° -->
<tr class="cart-item-row"
  th:data-cart-id="${item.cartId}"
  th:data-user-id="${item.userId}"
  th:data-product-id="${item.productId}"
  th:data-color-id="${item.colorId}"
  th:data-img="@{${item.productImg}}"
  th:data-name="${item.productName}"
  th:data-price="${item.productPrice}"
  th:data-product-price="${item.productPrice}"
  th:data-delivery-method="${item.deliveryMethod}"
  th:data-delivery-price="${item.deliveryPrice}"
  th:data-product-origin="${item.productOrigin}">

<!-- ê° ì˜µì…˜ì—ëŠ” ì˜µì…˜ë“¤ì˜ ê³ ìœ  ë°ì´í„° -->
<div class="cart-product-option" th:each="o : ${item.options}" th:if="${item.options != null and !item.options.isEmpty()}" th:data-color-id="${o.colorId}" th:data-color-name="${o.colorName}" th:data-quantity="${o.optionQuantity}">
```
- ì´ì œ ì´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤. ê°™ì€ ìƒí’ˆì´ì–´ë„ ìƒ‰ìƒì´ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ìƒí’ˆì´ë¯€ë¡œ ë¹ˆë°°ì—´ì— ìƒ‰ìƒ-ìˆ˜ëŸ‰ìœ¼ë¡œ ì •ë³´ë“¤ì„ ì±„ìš´ë‹¤. ì´ë•Œ ê³µí†µì •ë³´ì™€ ì˜µì…˜ ê°œë³„ ì •ë³´ë¥¼ í•œ ê°ì²´ì— ëª¨ë‘ ì±„ìš´ë‹¤.
- ë°”ë¡œêµ¬ë§¤ ë²„íŠ¼ì€ ìƒí’ˆë§ˆë‹¤ í•˜ë‚˜ì”© ìˆëŠ” ë²„íŠ¼ì´ë‹¤. ìƒí’ˆ ì˜µì…˜ í–‰ì„ ëª¨ë‘ productOptionsë¡œ ê°€ì ¸ì™€ì„œ(optionEl) ì´ë¥¼ ë°˜ë³µëŒë©° ê°ì ì €ì¥ëœ ê°œë³„ ë°ì´í„°ì…‹ (optionEl.dataset)ë“¤ê³¼ ìƒí’ˆ í–‰ì— ìˆëŠ” ë°ì´í„° ì…‹ì„ ê°€ì ¸ì™€ ê°ì²´ì— ë‹´ê³  ë‹¤ ë‹´ìœ¼ë©´ ë§Œë“¤ì–´ë’€ë˜ ë¹ˆ ë°°ì—´ì— ì‚½ì…í•œë‹¤.
- const row = e.target.closest('tr.cart-item-row'); ì€ í•´ë‹¹ ë²„íŠ¼ê³¼ ê°€ì¥ ê°€ê¹Œìš´ tr.cart-item-row tríƒœê·¸ì˜ .cart-item-rowí´ë˜ìŠ¤ë¥¼ ê°€ì ¸ì˜¨ë‹¤. (ì—¬ê¸°ì— datasetì´ ì„¸ê²¨ì ¸ ìˆë‹¤.)
- ì²´í¬í•œ ìƒí’ˆë§Œ ì£¼ë¬¸ì€ ì²´í¬í•œ ìƒí’ˆë“¤ì„ ì „ì²´ ì£¼ë¬¸í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ìœ„ì˜ ë°©ì‹ê³¼ ê°™ì§€ë§Œ ì²´í¬í•œ ìƒí’ˆë“¤ì„ì˜ tr.cart-item-rowë„ ëª¨ë‘ ëŒì•„ì•¼ í•˜ë¯€ë¡œ ì´ë¥¼ ë„ëŠ” ê³¼ì •ì´ ì¶”ê°€ë˜ì–´ ìœ„ì˜ ê³¼ì •ì„ ì´ì¤‘ ë°˜ë³µë¬¸ì„ í†µí•´ ìˆ˜í–‰í•œë‹¤.
```js
/* ë°”ë¡œêµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
  buyBtns.forEach(btn => {
    btn.addEventListener('click', async function(e) {
      const row = e.target.closest('tr.cart-item-row');
      if (!row) return;

      // í•´ë‹¹ ìƒí’ˆì˜ ëª¨ë“  ì˜µì…˜ë“¤ì„ ìˆ˜ì§‘
      const selectedOrderItems = [];
      const productOptions = row.querySelectorAll('.cart-product-option');
      
      productOptions.forEach(optionEl => {
        const orderItem = {
          // trì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ë°ì´í„° (ìƒí’ˆ ê³µí†µ ì •ë³´)
          productId: parseInt(row.dataset.productId),
          orderProductName: row.dataset.name,
          orderProductPrice: parseInt(row.dataset.productPrice),
          orderProductImg: row.dataset.img,
          orderProductOrigin: row.dataset.productOrigin,
          deliveryPrice: parseInt(row.dataset.deliveryPrice),
          
          // optionì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ë°ì´í„° (ìƒ‰ìƒë³„ ê³ ìœ  ì •ë³´)
          colorId: parseInt(optionEl.dataset.colorId),
          orderQuantity: parseInt(optionEl.dataset.quantity)
        };
        selectedOrderItems.push(orderItem);
      });

if (btnOrder) {
    btnOrder.addEventListener('click', async function() {
      // ì²´í¬ë°•ìŠ¤ í™•ì¸
      const checkedItemsPC = document.querySelectorAll('.cart-item-checkbox:checked');
      
      if (checkedItemsPC.length === 0) {
        alert('ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // ì„ íƒëœ ìƒí’ˆ-ìƒ‰ìƒë³„ ì •ë³´ë“¤ì„ ìˆ˜ì§‘
      const selectedOrderItems = [];
      
      // ê° ì²´í¬ëœ í–‰ì—ì„œ í•„ìš”í•œ ëª¨ë“  ì •ë³´ ìˆ˜ì§‘
      checkedItemsPC.forEach(checkbox => {
        const row = checkbox.closest('tr.cart-item-row');
        if (row) {
          // ê° ì˜µì…˜ë³„ë¡œ ê°œë³„ í•­ëª© ìƒì„±
          const productOptions = row.querySelectorAll('.cart-product-option');
            productOptions.forEach(optionEl => {
            const orderItem = {
              // trì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ë°ì´í„° (ìƒí’ˆ ê³µí†µ ì •ë³´)
              productId: parseInt(row.dataset.productId),
              orderProductName: row.dataset.name,
              orderProductPrice: parseInt(row.dataset.productPrice),
              orderProductImg: row.dataset.img,
              orderProductOrigin: row.dataset.productOrigin,
              deliveryPrice: parseInt(row.dataset.deliveryPrice),
              
              // optionì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ë°ì´í„° (ìƒ‰ìƒë³„ ê³ ìœ  ì •ë³´)
              colorId: parseInt(optionEl.dataset.colorId),
              orderQuantity: parseInt(optionEl.dataset.quantity)
            };
            selectedOrderItems.push(orderItem);
          });
```
- ì´í›„ fetchë¥¼ í†µí•´ ajax ìš”ì²­ì„ ë³´ë‚´ëŠ”ë° ì´ë•Œ ìœ„ì—ì„œ ë§Œë“  ê°ì²´ì˜ ë°°ì—´ì„ ì „ì†¡í•œë‹¤.
```js
 try {
        // AJAXë¡œ ê²°ì œ ì¤€ë¹„ API í˜¸ì¶œ - ìƒì„¸ ì •ë³´ì™€ í•¨ê»˜ ì „ì†¡
        const response = await fetch('/api/payment/prepare', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(selectedOrderItems)
        });
```

#### ì²«ë²ˆì§¸ paymentRestController
- ìš°ì„  ê°’ì„ @RequestBody List<OrderProduct> orderProductsë¡œ ë°›ëŠ”ë‹¤. ì£¼ë¬¸ í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ëŠ” ì£¼ë¬¸ ìƒí’ˆ í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ë‚˜ë¥´ê¸° ìœ„í•œ dtoì¸ë° ìœ„ì˜ ì •ë³´ë“¤ë„ ë‚˜ë¥´ê¸° ìœ„í•´ ì¹¼ëŸ¼ì„ ëª‡ê°œ ì¶”ê°€í–ˆë‹¤.
- ìœ íš¨ì„± ê²€ì‚¬ë“¤ì„ ê±°ì³ì¤€ í›„ì— ë¯¸ë¦¬ ì •í•´ë‘” ê·œì¹™ëŒ€ë¡œ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ìƒì„±í•œë‹¤.
- ê·¸ë¦¬ê³  orderê°ì²´ì™€ orderProductsë¥¼ í†µí•´ ì£¼ë¬¸ í…Œì´ë¸”ê³¼ ì£¼ë¬¸-ìƒí’ˆ í…Œì´ë¸”ì— ê°ê° ë°ì´í„°ë¥¼ ì‚½ì…í•œë‹¤. ì´ ë‘˜ì€ order_idë¡œ ì´ì–´ì ¸ ìˆìœ¼ë©° ì•ìœ¼ë¡œ ê³ ìœ í•œ ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ í†µí•´ ì´ë“¤ì„ ê³„ì† ì‚¬ìš©í•  ê²ƒì´ë‹¤.
- ê°’ì´ dbì— ì €ì¥ë˜ì—ˆìœ¼ë©´ ì£¼ë¬¸ë²ˆí˜¸ì™€ í•¨ê»˜ ì„±ê³µ í–ˆë‹¤ëŠ” ì‘ë‹µì„ ë‹¤ì‹œ ëŒë ¤ì¤€ë‹¤.
```java
@PostMapping("/api/payment/prepare")
        public ResponseEntity<ResponseDTO> prepareOrder(@RequestBody List<OrderProduct> orderProducts,
                                                        @SessionAttribute("memberInfo") User member) throws Exception {
            // ì£¼ë¬¸ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ê²€ì¦
                if (orderProducts == null || orderProducts.isEmpty()) {
                        throw new InvalidFormatException("ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
                }
            // ê° ì£¼ë¬¸ ìƒí’ˆì˜ ìœ íš¨ì„± ê²€ì‚¬
                for (OrderProduct orderProduct : orderProducts) {
                        if (orderProduct.getProductId() <= 0) {
                    throw new InvalidFormatException("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒí’ˆì…ë‹ˆë‹¤.");
                }
                if (orderProduct.getColorId() <= 0) {
                    throw new InvalidFormatException("ìƒ‰ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                }
                if (orderProduct.getOrderQuantity() <= 0) {
                    throw new InvalidFormatException("ìˆ˜ëŸ‰ì€ 1ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                }
                if (orderProduct.getOrderProductPrice() <= 0) {
                    throw new InvalidFormatException("ìƒí’ˆ ê°€ê²©ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
                if (orderProduct.getOrderProductName() == null || orderProduct.getOrderProductName().trim().isEmpty()) {
                    throw new InvalidFormatException("ìƒí’ˆëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            }
        
            // ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„±: ë‚ ì§œì‹œê°„ + ì‚¬ìš©ìID
            LocalDateTime now = LocalDateTime.now();
            String dateTime = now.format(DateTimeFormatter.ofPattern("yyyyMMddHHmmss"));
            String orderNumber = dateTime + member.getUserId();
            
            // ì£¼ë¬¸ ì´ì•¡ ê³„ì‚°
            int totalOrderPrice = orderProducts.stream()
                    .mapToInt(op -> op.getOrderProductPrice() * op.getOrderQuantity())
                    .sum();
            
            // Order ê°ì²´ ìƒì„±
            Order order = new Order();
            order.setUserId(member.getUserId());
            order.setOrderNumber(orderNumber);
            order.setOrderStatus("ê²°ì œëŒ€ê¸°ì¤‘");
            order.setOrderPrice(totalOrderPrice);
            
            // orders í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ ì €ì¥
            paymentService.addOrderAndProduct(order, orderProducts);

            // ì‘ë‹µ ë°ì´í„° êµ¬ì„±
            Map<String, Object> responseData = new HashMap<>();
            responseData.put("orderNumber", orderNumber);
            
            ResponseDTO response = ResponseDTO.builder()
                    .success(true)
                    .message("ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
                    .data(responseData)
                    .timestamp(LocalDateTime.now())
                    .build();

        return ResponseEntity.ok(response);
}
```

#### ì‘ë‹µì„ ë°›ì€ í›„ ì£¼ë¬¸ ì •ë³´ ì…ë ¥ì°½ ëœë”ë§
- ì‘ë‹µì„ ë°›ìœ¼ë©´ ì•„ë˜ì²˜ëŸ¼ orderNumberë¥¼ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— ì‹¬ì–´ getìœ¼ë¡œ ë‹¤ì‹œ í˜ì´ì§€ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
```js
 if (result.success) {
          // ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì „ë‹¬
          const orderNumber = result.data.orderNumber;
          window.location.href = `/payment?orderNumber=${orderNumber}`;
```
- ê·¸ëŸ¬ë©´ ì•„ë˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°›ì•„ @RequestParam(value = "orderNumber")ë¡œ ê°’ì„ ë°›ì•„ ì¥ë°”êµ¬ë‹ˆë¥¼ ì¡°íšŒí•˜ê³  ìƒí’ˆëª©ë¡ì„ ì¡°íšŒí•˜ì—¬ í™”ë©´ì— ë„ìš¸ ê°’ë“¤ì„ ì¤€ë¹„í•œ ë‹¤ìŒì— ê²°ì œ í˜ì´ì§€ë¥¼ ë„ìš´ë‹¤.
```java
@GetMapping("/payment")
    public String paymentPage(@SessionAttribute("memberInfo") User member,
                                @RequestParam(value = "orderNumber", required = false) String orderNumber, 
                                Model model) throws Exception {

        // ì£¼ë¬¸ì ì •ë³´ ì¡°íšŒ
        User userInfo = paymentService.getUserInfo(member);

        // ì£¼ë¬¸ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ì¥ë°”êµ¬ë‹ˆë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (orderNumber == null || orderNumber.trim().isEmpty()) {
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
        Order order = paymentService.getOrderByNumber(orderNumber);
        if (order == null) {
            // ì£¼ë¬¸ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì¥ë°”êµ¬ë‹ˆë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
        OrderProduct orderProductInput = new OrderProduct();
        orderProductInput.setOrderId(order.getOrderId());
        List<OrderProduct> orderProducts = paymentService.getOrderProductsByOrderId(orderProductInput);  
        
        OrderSummaryVo orderSummary = new OrderSummaryVo(orderProducts);

        // ëª¨ë¸ì— ë°ì´í„° ì¶”ê°€
        model.addAttribute("userInfo", userInfo);
        model.addAttribute("orderProducts", orderProducts);
        model.addAttribute("orderSummary", orderSummary);
        
        return "payment/index"; // payment/index.htmlë¡œ ì´ë™
    }
```
- ì´ë ‡ê²Œ ë„ì›Œì§„ ê²°ì œ í˜ì´ì§€ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
- model ê°ì²´ë¥¼ í†µí•´ ê°’ì„ ë°›ì•„ ëœë”ë§í•˜ëŠ” ì²˜ë¦¬ë¥¼ í•˜ê³  ìˆë‹¤. 
```html
<main class="payment-wrapper">
    <h2 class="page-title">ê²°ì œí•˜ê¸°</h2>

    <div class="payment-inner">
        <!-- ì™¼ìª½ ì˜ì—­ -->
        <section class="left-area">            
            
            <!-- ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ -->
            <div class="order-items">
                <h3>ì£¼ë¬¸ ìƒí’ˆ ì •ë³´</h3>
                <ul class="item-list">
                    <li class="item" th:each="item : ${orderProducts}">
                        <div class="item-wrapper">
                            <div class="thumb">
                                <img th:src="@{${item.orderProductImg}}" th:alt="${item.orderProductName}">
                            </div>
                            <div class="info">
                                <p class="name" th:text="${item.orderProductName}"></p>
                                <p class="option">
                                    <span class="label">í•„ìˆ˜</span> 
                                    <span th:text="${item.colorName}"></span> - 
                                    <span th:text="${item.orderQuantity}"></span>ê°œ
                                </p>
                                <p class="price" th:text="${#numbers.formatDecimal(item.orderProductPrice * item.orderQuantity, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></p>
                            </div>
                        </div>
                    </li>
                </ul>                
                <div class="delivery-cost-row">
                    ë°°ì†¡ë¹„ 
                    <strong th:text="${orderSummary.deliverySum > 0 ? #numbers.formatDecimal(orderSummary.deliverySum, 0, 'COMMA', 0, 'POINT') + 'ì›' : 'ë¬´ë£Œ'}"></strong>
                </div>
            </div>           
            
            <!-- ì£¼ë¬¸ì ì •ë³´ -->
            <div class="orderer-info">
                <h3>ì£¼ë¬¸ì ì •ë³´</h3>
                
                <div class="viewer">
                    <p class="line"><span class="name" th:text="${userInfo.userName}"></span></p>
                    <p class="line"><span class="phone" th:text="${userInfo.userPhone}"></span></p>
                    <p class="line"><span class="email" th:text="${userInfo.userEmail}"></span></p>
                </div>
                
                <!-- ì£¼ë¬¸ì ì •ë³´ë¥¼ hidden í•„ë“œë¡œ ì €ì¥í•˜ì—¬ JavaScriptì—ì„œ ì‚¬ìš© -->
                <input type="hidden" id="ordererName" th:value="${userInfo.userName}">
                <input type="hidden" id="ordererPhone" th:value="${userInfo.userPhone}">
                <input type="hidden" id="ordererPostcode" th:value="${userInfo.userPostcode}">
                <input type="hidden" id="ordererAddress" th:value="${userInfo.userAddress}">
                <input type="hidden" id="ordererDetailAddress" th:value="${userInfo.userSpecificAddress}">
                
                <!-- ë°°ì†¡ë¹„ ì •ë³´ë¥¼ hidden í•„ë“œë¡œ ì €ì¥ -->
                <input type="hidden" id="deliveryPrice" th:value="${orderSummary.deliverySum}">
            </div>
            
            <!-- ë°°ì†¡ ì •ë³´ -->
            <div class="delivery-info">
                <h3>ë°°ì†¡ ì •ë³´</h3>
                <label class="inline">
                    <input type="checkbox" id="sameAsOrderer"> ì£¼ë¬¸ì ì •ë³´ì™€ ë™ì¼
                </label>

                <div class="two-col">
                    <input type="text" id="receiverName" placeholder="ìˆ˜ë ¹ì¸">
                    <input type="tel" id="receiverPhone" placeholder="ì—°ë½ì²˜">
                </div>  

                <div class="two-col address-row">
                    <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button class="my-btn small-btn white-btn" onclick="daumPostcode()">ì£¼ì†Œì°¾ê¸°</button>
                </div>                
                <input type="text" id="address" placeholder="ì£¼ì†Œ" value="" readonly onclick="daumPostcode()">
                <input type="text" id="detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ" value="">

                <label class="memo-label" for="deliveryMemo">ë°°ì†¡ë©”ëª¨</label>

                <select id="deliveryMemo">
                    <option>ë°°ì†¡ë©”ëª¨ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</option>
                    <option>ë°°ì†¡ ì „ì— ë¯¸ë¦¬ ì—°ë½ ë°”ëë‹ˆë‹¤.</option>
                    <option>ë¶€ì¬ì‹œ ê²½ë¹„ì‹¤ì— ë§¡ê²¨ì£¼ì„¸ìš”.</option>
                    <option>ë¶€ì¬ì‹œ ì „í™”ë‚˜ ë¬¸ìë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.</option>
                    <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
                </select>
                <input type="text" id="customMemo" placeholder="ë°°ì†¡ë©”ëª¨ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”." style="display: none;">
            </div>

            <!-- ì¶”ê°€ì •ë³´ ì…ë ¥ -->
            <div class="additional-info">
                <h3>ì¶”ê°€ì •ë³´ ì…ë ¥</h3>                
                <p class="notice">
                    <strong>ì œí’ˆ êµ¬ë§¤ë¥¼ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜â—</strong><br>
                    (1)ìˆ˜ì§‘ ë° ì´ìš© ëª©ì  - ì œí’ˆ ë°°ì†¡ ë° êµ¬ë§¤ ì„œë¹„ìŠ¤ ì œê³µ, ì£¼ë¬¸/ë°°ì†¡ ì •ë³´ ì•ˆë‚´, ê³ ì§€ì‚¬í•­ ì „ë‹¬. (2)ìˆ˜ì§‘ ë° ì´ìš© í•­ëª© - ì£¼ë¬¸ì ì •ë³´: ì„±ëª…/ì—°ë½ì²˜/ì´ë©”ì¼, ë°°ì†¡ ì •ë³´: ìˆ˜ë ¹ì¸ ì„±ëª…/ì—°ë½ì²˜/ì£¼ì†Œ. (3)ë³´ìœ  ë° ì´ìš©ê¸°ê°„ - ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì  ë‹¬ì„± í›„ ì¦‰ì‹œ íŒŒê¸°, íšŒì›ê°€ì… ê³ ê°ì˜ ê²½ìš° íšŒì›íƒˆí‡´ ì‹œê¹Œì§€. â€»ê·€í•˜ëŠ” ìœ„ì™€ ê°™ì´ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘ ë° ì´ìš©í•˜ëŠ” ê²ƒì„ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë™ì˜ë¥¼ ê±°ë¶€í•  ê²½ìš°, ì œí’ˆ ë°°ì†¡ ë° êµ¬ë§¤ ì„œë¹„ìŠ¤ ì œê³µì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>                <label class="inline">
                    <input type="checkbox" class="detail-agree" data-required="true"> <div>[í•„ìˆ˜] ë™ì˜</div>
                </label>
            </div>
        </section>

        <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
        <aside class="right-area">
            <div class="sticky-box" id="paySticky"> <!-- jsë¡œ footerë§Œë‚˜ë©´ sticky í•´ì œ -->                
                
                <!-- ì£¼ë¬¸ ìš”ì•½ -->
                <section class="summary">
                    <h3>ì£¼ë¬¸ ìš”ì•½</h3>                    
                    <ul>                        
                        <li><span>ìƒí’ˆê°€ê²©</span><strong th:text="${#numbers.formatDecimal(orderSummary.productSum, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></strong></li>
                        <li><span>ë°°ì†¡ë¹„</span><strong th:text="${orderSummary.deliverySum > 0 ? #numbers.formatDecimal(orderSummary.deliverySum, 0, 'COMMA', 0, 'POINT') + 'ì›' : 'ë¬´ë£Œ'}"></strong></li>
                        <li class="total"><span>ì´ ì£¼ë¬¸ê¸ˆì•¡</span><strong th:text="${#numbers.formatDecimal(orderSummary.finalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></strong></li>
                    </ul>
                </section>                
                  <!-- ê²°ì œìˆ˜ë‹¨ -->
                <section class="pay-method">
                    <h3>ê²°ì œìˆ˜ë‹¨</h3>
                    <label><input type="radio" name="paymentMethod" value="ì‹ ìš©ì¹´ë“œ" checked> ì‹ ìš©ì¹´ë“œ</label>
                    <label><input type="radio" name="paymentMethod" value="ê°€ìƒê³„ì¢Œ"> ê°€ìƒê³„ì¢Œ</label>
                    <label><input type="radio" name="paymentMethod" value="ì‹¤ì‹œê°„ê³„ì¢Œì´ì²´"> ì‹¤ì‹œê°„ê³„ì¢Œì´ì²´</label>
                </section>
                
                <!-- ë™ì˜ -->
                <section class="agreement">
                    <label class="inline">
                        <input type="checkbox" id="agreeAll"> ì „ì²´ ë™ì˜
                    </label>                    <label class="indent inline">
                        <span class="indent-symbol">ã„´</span>
                        <input type="checkbox" class="detail-agree" data-required="true"> êµ¬ë§¤ì¡°ê±´ í™•ì¸ ë° ê²°ì œì§„í–‰ ë™ì˜
                    </label>
                </section>                
                  <!-- ê²°ì œ ë²„íŠ¼ -->
                <button id="paymentButton" class="pay-btn my-btn big-btn black-btn">
                    <span th:text="${#numbers.formatDecimal(orderSummary.finalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì› ê²°ì œí•˜ê¸°'"></span>
                </button>
            </div>
        </aside>
    </div>
</main>
```

#### ê²°ì œí•˜ê¸° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œì˜ ì²˜ë¦¬
- ê²°ì œí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì£¼ë¬¸ì„œ í˜ì´ì§€ì˜ ê°’ë“¤ì„ formData ê°ì²´ì— ëª¨ì•„ì„œ post í˜¸ì¶œì„ ë³´ë‚¸ë‹¤.
- ê·¸ë¦¬ê³  ì‘ë‹µì„ ë°›ìœ¼ë©´ ì„±ê³µí–ˆë‹¤ëŠ” ì˜ë¯¸ì—ì„œ orderNumberì„ ì´ìš©í•´ ì£¼ë¬¸ì •ë³´ë¥¼ ë„ì›Œì£¼ëŠ” ê²°ì œ ì„±ê³µì°½ì„ ëœë”ë§í•œë‹¤.
```js
// FormData ìƒì„±
            const formData = new FormData();
            formData.append('orderNumber', orderNumber);
            formData.append('receiverName', receiverNameEl.value);
            formData.append('receiverPhone', receiverPhoneEl.value);
            formData.append('receiverPostcode', postcodeEl.value);
            formData.append('receiverAddress', addressEl.value);
            formData.append('receiverDetailAddress', detailAddressEl.value);
            formData.append('deliveryMemo', deliveryMemo);
            formData.append('paymentMethod', paymentMethod.value);
            formData.append('purchaseTerm', purchaseTerm);
            formData.append('deliveryPrice', deliveryPrice);
              // ê²°ì œ ì™„ë£Œ API í˜¸ì¶œ
            const response = await fetch('/api/payment/complete', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                // ì„±ê³µ í˜ì´ì§€ë¡œ ì´ë™ 
                window.location.href = `/payment/success?orderNumber=${orderNumber}`;
```
- formData ìš”ì²­ì„ ë°›ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
- ìš°ì„  ë°›ì€ ì •ë³´ë“¤ì„ ê¸°ì¡´ ì£¼ë¬¸ì„œì— ë§ˆì € ì—…ë°ì´íŠ¸ í•˜ê³  ìƒíƒœë¥¼ ê²°ì œëŒ€ê¸°ì¤‘ì—ì„œ ë°°ì†¡ì¤€ë¹„ì¤‘ìœ¼ë¡œ ë°”ê¾¼ë‹¤.
- ê·¸ë¦¬ê³  ê°™ì€ ìƒí’ˆì´ ì¥ë°”êµ¬ë‹ˆì— ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ë¬¸ì„œì—ì„œ ì°¾ì€ ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ê³¼ íšŒì› idë¥¼ ì´ìš©í•˜ì—¬ ì¥ë°”êµ¬ë‹ˆì— í˜¹ì‹œ ìˆëŠ” í•´ë‹¹ ìƒí’ˆì„ ì œê±°í•œë‹¤.
```java
// ë°°ì†¡ ì •ë³´ ë° ê²°ì œ ë°©ë²• ì—…ë°ì´íŠ¸ (ê²€ì¦ëœ ê°’ ì‚¬ìš©)
  order.setReceiverName(validReceiverName);
  order.setReceiverPhone(validReceiverPhone);
  order.setReceiverPostcode(validReceiverPostcode);
  order.setReceiverAddress(validReceiverAddress);
  order.setReceiverSpecificAddress(validReceiverDetailAddress);
  order.setReceiverMemo(deliveryMemo);
  order.setPurchaseMethod(paymentMethod);
  order.setPurchaseTerm(purchaseTerm);
  order.setDeliveryPrice(deliveryPrice);
  order.setOrderStatus("ë°°ì†¡ì¤€ë¹„ì¤‘");
  
  // ì£¼ë¬¸ ì •ë³´ ì—…ë°ì´íŠ¸
  paymentService.updateOrderForPayment(order);
  
  // ì£¼ë¬¸ ì™„ë£Œ í›„ í•´ë‹¹ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
  paymentService.removeOrderedItemsFromCart(orderNumber);
```

#### service ì½”ë“œ
- ì„œë¹„ìŠ¤ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```java
@Slf4j
@Service
@RequiredArgsConstructor
public class PaymentServiceImpl implements PaymentService {    private final UserMapper userMapper;
    private final OrderMapper orderMapper;
    private final OrderProductMapper orderProductMapper;
    private final ProductMapper productMapper;
    private final CartMapper cartMapper;

    /**
     * ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë©”ì†Œë“œ
     * @param user ì‚¬ìš©ì ì •ë³´ê°€ ë‹´ê¸´ User ê°ì²´
     * @return User ê°ì²´ - í•´ë‹¹ ì‚¬ìš©ìì˜ ì •ë³´
     * @throws Exception
     */
    @Override
    public User getUserInfo(User user) throws Exception {
        return userMapper.selectOne(user);
    }

    /**
     * ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒ
     * ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒ
     * 
     * @param orderNumber   - ì£¼ë¬¸ë²ˆí˜¸
     * @return Order        - ì¡°íšŒëœ ì£¼ë¬¸ ì •ë³´
     */
    @Override
    public Order getOrderByNumber(String orderNumber) throws Exception {
        Order input = new Order();
        input.setOrderNumber(orderNumber);
        
        Order output = orderMapper.selectByOrderNumber(input);

        // ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
        return output;
    }

    /**
     * ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ë¥¼ ì¶”ê°€í•˜ëŠ” ë©”ì†Œë“œ
     * @param orderProduct ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ê°€ ë‹´ê¸´ OrderProduct ê°ì²´
     * @throws Exception
     */    
    @Override
    public void addOrderAndProduct(Order order, List<OrderProduct> orderProducts) throws Exception {
        orderMapper.insert(order);

        Order output = orderMapper.selectByOrderNumber(order);  
    
        for (OrderProduct orderProduct : orderProducts) {
            orderProduct.setOrderId(output.getOrderId());
            
            // product_idë¡œë¶€í„° sub_category_idë¥¼ ì§ì ‘ ì¡°íšŒí•´ì„œ ì„¤ì •
            Product product = productMapper.getProductById(orderProduct.getProductId());

            if (product != null) {
                orderProduct.setSubCategoryId(product.getSubcategoryId());
                if (orderProduct.getOrderProductOrigin() == null) {
                    orderProduct.setOrderProductOrigin(product.getProductOrigin());
                }
            } else {
                throw new InternalServerErrorException("ìƒí’ˆ ID " + orderProduct.getProductId() + "ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
            
            orderProductMapper.insert(orderProduct);
        }
    }

    /**
     * ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ë¥¼ ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì¡°íšŒ
     * 
     * @param orderProductInput - ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ (orderId í¬í•¨)
     * @return List<OrderProduct> - ì¡°íšŒëœ ì£¼ë¬¸ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
     * @throws Exception - ì˜ˆì™¸ ë°œìƒ ì‹œ
     */
    @Override
    public List<OrderProduct> getOrderProductsByOrderId(OrderProduct orderProductInput) throws Exception {
        return orderProductMapper.selectOrderProductListByOrderId(orderProductInput);
    }    
    
    /**
     * ê²°ì œ ì™„ë£Œë¥¼ ìœ„í•œ ì£¼ë¬¸ ì •ë³´ ì—…ë°ì´íŠ¸
     * ë°°ì†¡ ì •ë³´, ê²°ì œ ë°©ë²•, ì£¼ë¬¸ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
     * 
     * @param order - ì—…ë°ì´íŠ¸í•  ì£¼ë¬¸ ì •ë³´
     * @throws Exception - ì˜ˆì™¸ ë°œìƒ ì‹œ
     */
    @Override
    public void updateOrderForPayment(Order order) throws Exception {
        // ì£¼ë¬¸ë²ˆí˜¸ë¡œ ê¸°ì¡´ ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ orderIdë¥¼ ì–»ìŒ
        Order existingOrder = orderMapper.selectByOrderNumber(order);
        if (existingOrder == null) {
            throw new InternalServerErrorException("ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // orderIdë¥¼ ì„¤ì •í•˜ì—¬ ì—…ë°ì´íŠ¸ ì‹¤í–‰
        order.setOrderId(existingOrder.getOrderId());
        
        // ê²°ì œ ì™„ë£Œë¥¼ ìœ„í•œ ëª¨ë“  ì •ë³´ë¥¼ í•œ ë²ˆì— ì—…ë°ì´íŠ¸
        int updated = orderMapper.updateOrderForPayment(order);
        
        if (updated == 0) {
            throw new InternalServerErrorException("ì£¼ë¬¸ ì •ë³´ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }    
    
    /**
     * ì£¼ë¬¸ ì™„ë£Œ í›„ í•´ë‹¹ ìƒí’ˆì„ ì‚¬ìš©ìì˜ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
     * ì£¼ë¬¸ëœ ìƒí’ˆê³¼ ìƒ‰ìƒì´ ì¼ì¹˜í•˜ëŠ” ì¥ë°”êµ¬ë‹ˆ í•­ëª©ì˜ is_deleteë¥¼ trueë¡œ ì„¤ì •
     * 
     * @param orderNumber - ì£¼ë¬¸ë²ˆí˜¸
     * @throws Exception - ì˜ˆì™¸ ë°œìƒ ì‹œ
     */
    @Override
    public void removeOrderedItemsFromCart(String orderNumber) throws Exception {
        
        // ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
        Order input = new Order();
        input.setOrderNumber(orderNumber);
        
        Order order = orderMapper.selectByOrderNumber(input);
        if (order == null) {
            throw new InternalServerErrorException("ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
        OrderProduct orderProductInput = new OrderProduct();
        orderProductInput.setOrderId(order.getOrderId());
        List<OrderProduct> orderProducts = orderProductMapper.selectOrderProductListByOrderId(orderProductInput);
        
        log.info("ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ - ìƒí’ˆ ê°œìˆ˜: {}", orderProducts.size());          // ê° ì£¼ë¬¸ ìƒí’ˆì— ëŒ€í•´ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±° -> ì—†ì–´ë„ ì˜¤ë¥˜ëŠ” ì•„ë‹˜
        for (OrderProduct orderProduct : orderProducts) {

            List<Integer> matchingProductIds = cartMapper.findProductIdsBySubCategoryNameAndColor(
                orderProduct.getSubCategoryId(), 
                orderProduct.getOrderProductName(),
                orderProduct.getColorId()
            );
            
            // ë§¤ì¹­ëœ ê° ìƒí’ˆì— ëŒ€í•´ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
            for (Integer productId : matchingProductIds) {
                int removedCount = cartMapper.removeOrderedItemFromCart(
                    order.getUserId(), 
                    productId, 
                    orderProduct.getColorId()
                );
            }
        }
    }
}
```

#### ì»¨íŠ¸ë¡¤ëŸ¬ ì „ì²´ ì½”ë“œ
```java
/**
     * ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ - ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì—ì„œ ì£¼ë¬¸ë²ˆí˜¸ í™•ì¸
     * @param orderNumber ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°›ì€ ì£¼ë¬¸ë²ˆí˜¸
     * @param model ëª¨ë¸ ê°ì²´
     * @return ê²°ì œ í˜ì´ì§€ ë˜ëŠ” ì¥ë°”êµ¬ë‹ˆë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
     * @throws Exception
     */    
    @GetMapping("/payment")
    public String paymentPage(@SessionAttribute("memberInfo") User member,
                                @RequestParam(value = "orderNumber", required = false) String orderNumber, 
                                Model model) throws Exception {

        // ì£¼ë¬¸ì ì •ë³´ ì¡°íšŒ
        User userInfo = paymentService.getUserInfo(member);

        // ì£¼ë¬¸ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ì¥ë°”êµ¬ë‹ˆë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (orderNumber == null || orderNumber.trim().isEmpty()) {
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
        Order order = paymentService.getOrderByNumber(orderNumber);
        if (order == null) {
            // ì£¼ë¬¸ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì¥ë°”êµ¬ë‹ˆë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
        OrderProduct orderProductInput = new OrderProduct();
        orderProductInput.setOrderId(order.getOrderId());
        List<OrderProduct> orderProducts = paymentService.getOrderProductsByOrderId(orderProductInput);  
        
        OrderSummaryVo orderSummary = new OrderSummaryVo(orderProducts);

        // ëª¨ë¸ì— ë°ì´í„° ì¶”ê°€
        model.addAttribute("userInfo", userInfo);
        model.addAttribute("orderProducts", orderProducts);
        model.addAttribute("orderSummary", orderSummary);
        
        return "payment/index"; // payment/index.htmlë¡œ ì´ë™
    }

    /**
     * ê²°ì œ ì„±ê³µ í˜ì´ì§€ë¡œ ì´ë™
     * @param orderNumber ì™„ë£Œëœ ì£¼ë¬¸ë²ˆí˜¸
     * @param model ëª¨ë¸ ê°ì²´
     * @return ê²°ì œ ì„±ê³µ í˜ì´ì§€
     * @throws Exception
     */
    @GetMapping("/payment/success")
    public String paymentSuccessPage(@SessionAttribute("memberInfo") User member,
                                    @RequestParam(value = "orderNumber", required = false) String orderNumber,
                                    Model model) throws Exception {
        
        // ì£¼ë¬¸ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (orderNumber == null || orderNumber.trim().isEmpty()) {
            return "redirect:/";
        }
        
        // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
        Order order = paymentService.getOrderByNumber(orderNumber);
        if (order == null) {
            // ì£¼ë¬¸ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            return "redirect:/";
        }
        
        // ì£¼ë¬¸ ì†Œìœ ì í™•ì¸
        if (order.getUserId() != member.getUserId()) {
            return "redirect:/";
        }
        
        // ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
        OrderProduct orderProductInput = new OrderProduct();
        orderProductInput.setOrderId(order.getOrderId());
        List<OrderProduct> orderProducts = paymentService.getOrderProductsByOrderId(orderProductInput);
        
        // ì£¼ë¬¸ ìš”ì•½ ì •ë³´ ìƒì„±
        OrderSummaryVo orderSummary = new OrderSummaryVo(orderProducts);
        
        // ëª¨ë¸ì— ë°ì´í„° ì¶”ê°€
        model.addAttribute("order", order);
        model.addAttribute("orderProducts", orderProducts);
        model.addAttribute("orderSummary", orderSummary);
        
        return "payment/success";
    }
}
```
```java
@RestController
@RequiredArgsConstructor
public class PaymentRestController {

        private final PaymentService paymentService;
        private final ValidationManager validationManager;    

        @PostMapping("/api/payment/prepare")
        public ResponseEntity<ResponseDTO> prepareOrder(@RequestBody List<OrderProduct> orderProducts,
                                                        @SessionAttribute("memberInfo") User member) throws Exception {
            // ì£¼ë¬¸ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ê²€ì¦
                if (orderProducts == null || orderProducts.isEmpty()) {
                        throw new InvalidFormatException("ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
                }
            // ê° ì£¼ë¬¸ ìƒí’ˆì˜ ìœ íš¨ì„± ê²€ì‚¬
                for (OrderProduct orderProduct : orderProducts) {
                        if (orderProduct.getProductId() <= 0) {
                    throw new InvalidFormatException("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒí’ˆì…ë‹ˆë‹¤.");
                }
                if (orderProduct.getColorId() <= 0) {
                    throw new InvalidFormatException("ìƒ‰ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                }
                if (orderProduct.getOrderQuantity() <= 0) {
                    throw new InvalidFormatException("ìˆ˜ëŸ‰ì€ 1ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                }
                if (orderProduct.getOrderProductPrice() <= 0) {
                    throw new InvalidFormatException("ìƒí’ˆ ê°€ê²©ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
                if (orderProduct.getOrderProductName() == null || orderProduct.getOrderProductName().trim().isEmpty()) {
                    throw new InvalidFormatException("ìƒí’ˆëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            }
        
            // ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„±: ë‚ ì§œì‹œê°„ + ì‚¬ìš©ìID
            LocalDateTime now = LocalDateTime.now();
            String dateTime = now.format(DateTimeFormatter.ofPattern("yyyyMMddHHmmss"));
            String orderNumber = dateTime + member.getUserId();
            
            // ì£¼ë¬¸ ì´ì•¡ ê³„ì‚°
            int totalOrderPrice = orderProducts.stream()
                    .mapToInt(op -> op.getOrderProductPrice() * op.getOrderQuantity())
                    .sum();
            
            // Order ê°ì²´ ìƒì„±
            Order order = new Order();
            order.setUserId(member.getUserId());
            order.setOrderNumber(orderNumber);
            order.setOrderStatus("ê²°ì œëŒ€ê¸°ì¤‘");
            order.setOrderPrice(totalOrderPrice);
            
            // orders í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ ì €ì¥
            paymentService.addOrderAndProduct(order, orderProducts);

            // ì‘ë‹µ ë°ì´í„° êµ¬ì„±
            Map<String, Object> responseData = new HashMap<>();
            responseData.put("orderNumber", orderNumber);
            
            ResponseDTO response = ResponseDTO.builder()
                    .success(true)
                    .message("ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
                    .data(responseData)
                    .timestamp(LocalDateTime.now())
                    .build();

        return ResponseEntity.ok(response);
}



        @PostMapping("/api/payment/complete")
        public ResponseEntity<ResponseDTO> completePayment(
                @RequestParam String orderNumber,
                @RequestParam String receiverName,
                @RequestParam String receiverPhone,
                @RequestParam String receiverPostcode,
                @RequestParam String receiverAddress,
                @RequestParam String receiverDetailAddress,
                @RequestParam(required = false) String deliveryMemo,
                @RequestParam String paymentMethod,
                @RequestParam boolean purchaseTerm,
                @RequestParam int deliveryPrice,
                @SessionAttribute("memberInfo") User member) throws Exception {
                
                
                String validReceiverName = validationManager.validateName(receiverName);
                String validReceiverPhone = validationManager.validatePhone(receiverPhone);
                String validReceiverPostcode = validationManager.validatePostcode(receiverPostcode);
                String validReceiverAddress = validationManager.validateAddress(receiverAddress);
                String validReceiverDetailAddress = validationManager.validateAddressDetail(receiverDetailAddress, receiverAddress);
                    // í•„ìˆ˜ ì•½ê´€ ë™ì˜ ê²€ì¦
                    if (!purchaseTerm) {
                        throw new InvalidFormatException("í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.");
                    }
                    
                    // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ ë° ì†Œìœ ì í™•ì¸
                    Order order = paymentService.getOrderByNumber(orderNumber);
                    if (order == null) {
                            throw new InternalServerErrorException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ë¬¸ì…ë‹ˆë‹¤.");
                    }
                    
                    if (order.getUserId() != member.getUserId()) {
                            throw new InternalServerErrorException("í•´ë‹¹ ì£¼ë¬¸ì— ëŒ€í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                    }
                    
                    // ì£¼ë¬¸ ìƒíƒœê°€ "ê²°ì œëŒ€ê¸°ì¤‘"ì¸ì§€ í™•ì¸
                    if (!"ê²°ì œëŒ€ê¸°ì¤‘".equals(order.getOrderStatus())) {
                            throw new InternalServerErrorException("ì´ë¯¸ ì²˜ë¦¬ëœ ì£¼ë¬¸ì…ë‹ˆë‹¤.");
                    }                
                    
                    // ë°°ì†¡ ì •ë³´ ë° ê²°ì œ ë°©ë²• ì—…ë°ì´íŠ¸ (ê²€ì¦ëœ ê°’ ì‚¬ìš©)
                    order.setReceiverName(validReceiverName);
                    order.setReceiverPhone(validReceiverPhone);
                    order.setReceiverPostcode(validReceiverPostcode);
                    order.setReceiverAddress(validReceiverAddress);
                    order.setReceiverSpecificAddress(validReceiverDetailAddress);
                    order.setReceiverMemo(deliveryMemo);
                    order.setPurchaseMethod(paymentMethod);
                    order.setPurchaseTerm(purchaseTerm);
                    order.setDeliveryPrice(deliveryPrice);
                    order.setOrderStatus("ë°°ì†¡ì¤€ë¹„ì¤‘");
                    
                    // ì£¼ë¬¸ ì •ë³´ ì—…ë°ì´íŠ¸
                    paymentService.updateOrderForPayment(order);
                    
                    // ì£¼ë¬¸ ì™„ë£Œ í›„ í•´ë‹¹ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
                    paymentService.removeOrderedItemsFromCart(orderNumber);
                    
                    // ì‘ë‹µ ë°ì´í„° êµ¬ì„±
                    Map<String, Object> responseData = new HashMap<>();
                    responseData.put("orderNumber", orderNumber);
                    
                    ResponseDTO response = ResponseDTO.builder()
                            .success(true)
                            .message("ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
                            .data(responseData)
                            .timestamp(LocalDateTime.now())
                            .build();

                    return ResponseEntity.ok(response);
        }
}
```





