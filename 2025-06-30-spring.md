# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡  í”„ë¡œì íŠ¸
### ğŸ“Œ 0-1. ì£¼ìš” ì—ëŸ¬ ì‚¬í•­
- pi/cart/${cartIdNow}Â (ìƒëŒ€ê²½ë¡œ) â†’ /cart í˜ì´ì§€ ê¸°ì¤€ì´ë©´ /cart/api/...ë¡œ ë¶™ì–´ 404ì—ëŸ¬ê°€ ë‚œë‹¤. í•˜ì—¬ ì„ í–‰ ìŠ¬ë˜ì‹œ ë¶™ì—¬Â /api/cart/${cartIdNow}ë¡œ ì§€ì •í•´ì•¼í•œë‹¤.
- response ìì²´ê°€ ì•ˆì˜¤ëŠ” ê²½ìš°ë¥¼ í•œë²ˆ ê±¸ëŸ¬ì¤˜ì•¼ í•œë‹¤.
- ì •ë³´ê°€ ì•ˆì˜¤ë©´ íŒŒì‹± ìì²´ë„ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
```js
const response = await fetch(`/api/cart/${cartIdNow}`); // @GetMapping("/cart/{cartId}")ìœ¼ë¡œ ë°±ì—”ë“œì—ì„œ ë°›ì„ ê²ƒ

      if (!response.ok) {
        alert('ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨');
        return;
      }
      
      const result = await response.json();

      if (!result.status) {
        alert('ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨');
        return;
      }
```
- ê·¸ëƒ¥ fetchë¥¼ try-catchë¡œ ë¬¶ëŠ”ê²Œ ë‚«ë‹¤.
- ë˜í•œ try ë¬¸ì— ë“¤ì–´ê°€ê¸°ì „ì— ë¯¸ë¦¬ ë°–ì— ì„ ì–¸í•´ë†“ê³  ê°€ì•¼ ë³€ìˆ˜ê°€ ì•„ì˜ˆ ì¡´ì¬í•˜ì§€ë„ ì•Šì„ ìˆ˜ ìˆëŠ” ìœ„í—˜ì„ ë°©ì§€í•œë‹¤.
- const result = await response.json(); ë¡œ ì•„ë˜ì„œ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì—
```js
let response;

      try {
        response = await fetch(`/api/cart/${cartIdNow}`); // @GetMapping("/cart/{cartId}")ìœ¼ë¡œ ë°±ì—”ë“œì—ì„œ ë°›ì„ ê²ƒ
      } catch (error) {
        console.error('ìƒí’ˆ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
        alert('ìƒí’ˆ ì •ë³´ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }

      const result = await response.json();

```
- ì¥ë°”êµ¬ë‹ˆì— í•œ idë‹¹ ê°™ì€ product_idê°€ ì—¬ëŸ¬ê°œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¨ì¼í–‰ ì¡°íšŒë‚˜ ë‹¤í–‰ ì¡°íšŒë¥¼ í• ë•Œ í•˜ë‚˜ì˜ product_idë§Œ ë½‘ì•„ì„œ ê·¸ idê°€ ëŒ€í‘œí•˜ê²Œ í•˜ëŠ” ë¡œì§ì„ ê¼­ ì¶”ê°€í•´ì•¼í•œë‹¤.
- ìš°ì„  ë‹¤í–‰ ì¡°íšŒë¶€í„° ìˆ˜ì •í•˜ì˜€ë‹¤.
- ìš°ì„  group byì‹œì— p.product_name, p.product_price, p.product_img ë“¤ì€ ì–´ì§œí”¼ í•œê°œë°–ì— ì—†ì„ ê²ƒì´ë¯€ë¡œ ë’¤ì— group byë¡œ ë‚˜ì—´í•´ë„ ë¬´ì‹œí•´ë„ ëœë‹¤.
- ì´ë ‡ê²Œ userid ë³„ë¡œ ë¬¶ê³  productid ë³„ë¡œ ë¬¶ìœ¼ë©´ í•œ ìœ ì €ì˜ ëª¨ë“  ì¥ë°”êµ¬ë‹ˆì—ì„œ ìƒí’ˆë³„ë¡œ ë¬¶ì´ê³  ê±°ê¸°ì„œ ìœ ì € ì•„ì´ë””ë§Œ ê³ ë¥´ë©´ ìƒí’ˆë³„ë¡œ ë¬¶ì¸ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. ì´ë•Œ í•œ ìƒí’ˆì´ í•œ í–‰ì´ ë˜ê³  ê·¸ë ‡ê²Œ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ë¦´ ìˆ˜ ìˆê²Œ ëœë‹¤.
- optionsì™€ allColorsëŠ” many=@Manyë¥¼ í†µí•´ ë‹¤ë¥¸ mapperì˜ select ê²°ê³¼ë¥¼ ê°€ì ¸ì™€ì„œ ëŒ€ì…í•œë‹¤.
```java
@Results(id="CartMap", value={
    /* ëŒ€í‘œí‚¤ Â· ê¸°ë³¸í•„ë“œ */
    @Result(column="cart_id", property="cartId"),      // MIN(cart_id)
    @Result(column="user_id", property="userId"),
    @Result(column="product_id", property="productId"),
    @Result(column="delivery_method", property="deliveryMethod"),
    @Result(column="delivery_price", property="deliveryPrice"),
    @Result(column="reg_date", property="regDate"),
    @Result(column="edit_date", property="editDate"),

    /* ìƒí’ˆ ì •ë³´ */
    @Result(column="product_name", property="productName"),
    @Result(column="product_price", property="productPrice"),
    @Result(column="product_img", property="productImg"),

    /* ì˜µì…˜ ì»¬ë ‰ì…˜ */
    @Result(property="options",
            column="{uid=user_id,pid=product_id}",
            many=@Many(select="selectOptionsByUserAndProduct")),

    /* íŒ”ë ˆíŠ¸ */
    @Result(property="allColors",
            column="product_id",
            many=@Many(select="selectAllColorsByProduct")),

    /* ì´ ìˆ˜ëŸ‰ */
    @Result(column="totalQty", property="totalQty")
    })
@Select("""
SELECT  MIN(c.cart_id) AS cart_id,
        c.user_id,
        c.product_id,
        MIN(c.delivery_method) AS delivery_method,
        MIN(c.delivery_price) AS delivery_price,
        MIN(c.reg_date) AS reg_date,
        MAX(c.edit_date) AS edit_date,
        p.product_name,
        p.product_price,
        p.product_img,
        SUM(c.product_quantity) AS totalQty
    FROM carts c
    JOIN products p ON p.product_id = c.product_id
    WHERE c.user_id = #{userId}
    GROUP BY c.user_id, c.product_id, p.product_name, p.product_price, p.product_img
    ORDER BY MIN(c.cart_id)
""")
@ResultMap("CartMap")
List<Cart> selectCartListByUserId(Cart param) throws Exception;   // param ì— userId ë§Œ ì„¸íŒ…í•´ì„œ í˜¸ì¶œ
```

### ğŸ“Œ 0-2. ì¥ë°”êµ¬ë‹ˆ ì»¨íŠ¸ë¡¤ëŸ¬
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í˜ì´ì§€ ìš”ì²­ì„ ë°›ì•˜ì„ë•Œ í•„ìš”í•œ ê²ƒì€ ìƒí’ˆì •ë³´ ì±„ì›Œë„£ê¸°, ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì±„ì›Œë„£ê¸°, ì „ì²´ í†µê³„ ì±„ì›Œë„£ê¸° ì´ë ‡ê²Œ í¬ê²Œ 3ê°€ì§€ ì¼ì„ ìˆ˜í–‰í•˜ë©´ ëœë‹¤. ì¤‘ìš”í•œ ê±´ ì¥ë°”êµ¬ë‹ˆ í…Œì´ë¸” êµ¬ì¡°ê°€ íšŒì› ì•„ì´ë”” í•˜ë‚˜ì— ë§¤ì¹­ë˜ëŠ” ìƒí’ˆë„ ì—¬ëŸ¬ê°œê³  ìƒí’ˆì— ë§¤ì¹­ë˜ëŠ” ìƒ‰ìƒ ì˜µì…˜ë„ ì—¬ëŸ¬ê°œì—¬ì„œ ë‚´ë¶€ì— ë¡œì§ì´ êµ‰ì¥íˆ ë³µì¡í•´ì§€ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì¡°ì‹¬í•´ì•¼í•œë‹¤.
- í˜ì´ì§€ ë¡œë”© ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìœ„ì—ì„œ ë§í•œ 3ê°€ì§€ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„¸ì…˜ì„ ê¸°ì¤€ìœ¼ë¡œ ì¶©ì‹¤í•˜ê²Œ í˜¸ì¶œí•˜ì—¬ ë¡œì§ì„ ì§„í–‰ì‹œì¼œì¤€ë‹¤.
- ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë„˜ê²¨ì¤˜ì•¼ í•˜ë¯€ë¡œ ë¡œê·¸ì¸í•˜ì§€ ì•Šìœ¼ë©´ ë°”ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì¼œì¤€ë‹¤.
```java
@GetMapping("/cart")
    public String cartPage(HttpSession session, Model model) {
        User user = (User) session.getAttribute("memberInfo");

        // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
        if (user == null) {
            return "redirect:/login"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        }

        int userId = user.getUserId();

        Wishlist wishlist = new Wishlist();
        wishlist.setUserId(userId);

        // ì „ì²´ ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ
        List<Cart> carts = null;

        try {
            carts = cartService.getCartList(userId);
        } catch (Exception e) {
            e.printStackTrace();
            return "error/500"; // ì—ëŸ¬ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        }

        // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì •ë³´ ì¡°íšŒ
        List<Wishlist> wishlistResult = null;

        try { 
            wishlistResult = wishlistService.getWishlistByUserId(wishlist);
        } catch (Exception e) {
            e.printStackTrace();
            return "error/500"; // ì—ëŸ¬ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        }

        // ì¥ë°”êµ¬ë‹ˆ ì „ì²´ í•©ì‚° ì •ë³´ ì¡°íšŒ
        CartSummaryDTO summary = null;
        
        try {
            summary = cartService.getSummary(carts);
        } catch (Exception e) {
            e.printStackTrace();
            return "error/500"; // ì—ëŸ¬ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        }

        model.addAttribute("carts", carts);
        model.addAttribute("summary", summary);
        model.addAttribute("wishlists", wishlistResult);

        return "cart/index";  
    }
```
- ëª¨ë‹¬ì„ ì—´ë•Œ íŠ¹ì • ìƒí’ˆ í•˜ë‚˜ì— ëŒ€í•œ ì •ë³´ë“¤ì„ ìš”ì²­ë°›ì•„ ì œê³µí•˜ëŠ” api ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì´ë‹¤.
- cart idë¥¼ ë°›ì•„ì„œ í•´ë‹¹ ì¹´íŠ¸ idì˜ ìœ ì €-ìƒí’ˆê³¼ ë™ì¼í•œ ì˜µì…˜ì„ ê°€ì ¸ì˜¨ë‹¤.
```java
    /**
     * ì¥ë°”êµ¬ë‹ˆì—ì„œ íŠ¹ì • ìƒí’ˆì˜ ì˜µì…˜ë“¤ì„ ì¡°íšŒ
     * - ìƒí’ˆ ì˜µì…˜ ë³€ê²½ ëª¨ë‹¬ì—ì„œ ì‚¬ìš©
     * @param cartId ì¥ë°”êµ¬ë‹ˆì—ì„œ ì¡°íšŒí•  cart_id
     * @return Map<String, Object> - í•´ë‹¹ cart_idì— ëŒ€í•œ Cart ê°ì²´
     */
    @GetMapping("/api/cart/{cartId}")
    @ResponseBody
    public Map<String, Object> getOneCartProduct(@PathVariable int cartId) {
        Map<String, Object> response = new LinkedHashMap<>();
        Cart cart = null;
        try {
            cart = cartService.getOneCartProduct(cartId);
        } catch (Exception e) {
            e.printStackTrace();
            response.put("status", false);
            response.put("timestamp", LocalDateTime.now().toString());
            return response; // ì„œë²„ ì—ëŸ¬
        }

        response.put("cart", cart);
        response.put("status", true);
        response.put("timestamp", LocalDateTime.now().toString());

        return response;
    }
```
- ìˆ˜ì •í•˜ê¸° ìœ„í•œ ì˜µì…˜ ì •ë³´ë“¤ì„ ê°€ì ¸ì™€ì„œ í•´ë‹¹ ì¥ë°”êµ¬ë‹ˆì˜ ëª¨ë“  ìƒí’ˆì„ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ë°›ì•„ì˜¨ ì˜µì…˜ë“¤ì„ ì±„ì›Œë„£ëŠ” ë¡œì§ì„ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ìˆ˜í–‰í•œë‹¤.
```java
    @PatchMapping("/api/cart/{cartId}")
    @ResponseBody
    public Map<String, Object> editOneItem(@PathVariable int cartId, @RequestBody List<CartOptionDTO> options) {
        Map<String, Object> response = new LinkedHashMap<>();
        
        try {
            cartService.editOneItem(cartId, options);
        } catch (Exception e) {
            e.printStackTrace();
            response.put("status", false);
            response.put("timestamp", LocalDateTime.now().toString());
            return response; // ì„œë²„ ì—ëŸ¬
        }

        response.put("status", true);
        response.put("timestamp", LocalDateTime.now().toString());
        return response;
    }
```
- ì„ íƒí•œ ìƒí’ˆë“¤ì„ ì „ë¶€ ì‚­ì œí•˜ëŠ” ì¦‰ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì§€ì›Œë²„ë¦¬ëŠ” ë¡œì§ì„ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ìˆ˜í–‰í•œë‹¤.
```java
    @DeleteMapping ("/api/cart")
    @ResponseBody
    public Map<String, Object> deleteCarts(@RequestBody List<Integer> ids) {
        Map<String, Object> response = new LinkedHashMap<>();
        try {
            cartService.deleteCarts(ids);
        } catch (Exception e) {
            e.printStackTrace();
            response.put("status", false);
            response.put("timestamp", LocalDateTime.now().toString());
            return response; // ì„œë²„ ì—ëŸ¬
        }

        response.put("status", true);
        response.put("timestamp", LocalDateTime.now().toString());
        return response;
    }
```

### ğŸ“Œ 0-3. ì¥ë°”êµ¬ë‹ˆ ë§¤í¼
- @Many êµ¬ë¬¸ì„ ì•„ì£¼ ìš”ê¸´í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° property="options" ìœ¼ë¡œ cart dto ë‚´ë¶€ options ë³€ìˆ˜ì— ìƒí’ˆì˜ ìƒ‰ìƒì˜µì…˜ê³¼ ìƒ‰ìƒì˜µì…˜ë³„ ìˆ˜ëŸ‰ì„ ë‹´ì•„ë‘ëŠ” ì—­í• ì„ í•œë‹¤.
- {uid=user_id,pid=product_id} : í˜„ì¬ í–‰ì—ì„œ user_idì™€ product_idì˜ ê°’ì„ ë½‘ì•„ì„œ ëª¨ì•„ {uid: user_id, pid: product_id} í˜•íƒœë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
- ì¦‰ í…Œì´ë¸”ì—ì„œ í–‰ì„ í•˜ë‚˜ì”© ì±„ìš°ë‹¤ê°€ optionsë¥¼ ì±„ì›Œë„£ì„ë•ŒëŠ” ë¨¼ì € ê·¸ í–‰ì˜ user_idê°’ê³¼ product_idê°’ìœ¼ë¡œ selectOptionsByUserAndProductí•¨ìˆ˜ì˜ ì…€ë ‰íŠ¸ ê°’ì„ ìˆ˜í–‰í•˜ì—¬ ì±„ìš´ë‹¤ëŠ” ê²ƒì´ë‹¤.
- ìœ„ì™€ ê°™ì€ ë¬¸ë²•ì„ many=@Many(select="selectAllColorsByProduct")ì´ëŸ° ì‹ìœ¼ë¡œ ì“´ë‹¤.
- @Manyì€ ê²°ê³¼ ê°’ì´ ì—¬ëŸ¬ê°œì—¬ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜ëœë‹¤ëŠ” ëœ»ì´ê³  @Oneìœ¼ë¡œ í•˜ë©´ í•œê°œë§Œ ë°˜í™˜í•  ìˆ˜ë„ ìˆë‹¤.
```java
    @Results(id="CartMap", value={
        /* ëŒ€í‘œí‚¤ Â· ê¸°ë³¸í•„ë“œ */
        @Result(column="cart_id", property="cartId"),      // MIN(cart_id)
        @Result(column="user_id", property="userId"),
        @Result(column="product_id", property="productId"),
        @Result(column="delivery_method", property="deliveryMethod"),
        @Result(column="delivery_price", property="deliveryPrice"),
        @Result(column="reg_date", property="regDate"),
        @Result(column="edit_date", property="editDate"),

        /* ìƒí’ˆ ì •ë³´ */
        @Result(column="product_name", property="productName"),
        @Result(column="product_price", property="productPrice"),
        @Result(column="product_img", property="productImg"),

        /* ì˜µì…˜ ì»¬ë ‰ì…˜ */
        @Result(property="options",
                column="{uid=user_id,pid=product_id}",
                many=@Many(select="selectOptionsByUserAndProduct")),

        /* íŒ”ë ˆíŠ¸ */
        @Result(property="allColors",
                column="product_id",
                many=@Many(select="selectAllColorsByProduct")),

        /* ì´ ìˆ˜ëŸ‰ */
        @Result(column="totalQty", property="totalQty")
        })
    @Select("""
    SELECT  MIN(c.cart_id) AS cart_id,
            c.user_id,
            c.product_id,
            MIN(c.delivery_method) AS delivery_method,
            MIN(c.delivery_price) AS delivery_price,
            MIN(c.reg_date) AS reg_date,
            MAX(c.edit_date) AS edit_date,
            MIN(p.product_name) AS product_name,     
            MIN(p.product_price) AS product_price,
            MIN(p.product_img) AS product_img,
            SUM(c.product_quantity) AS totalQty
        FROM carts c
        JOIN products p ON p.product_id = c.product_id
        WHERE c.user_id = #{userId}
        GROUP BY c.user_id, c.product_id
        ORDER BY MIN(c.cart_id)
    """)
    @ResultMap("CartMap")
    List<Cart> selectCartListByUserId(Cart param) throws Exception;   // param ì— userId ë§Œ ì„¸íŒ…í•´ì„œ í˜¸ì¶œ
```
- í•œ ìƒí’ˆì˜ ìƒ‰ìƒ ì˜µì…˜ì„ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œë¡œ jsì—ì„œ ë™ì ìœ¼ë¡œ íŒ”ë ˆíŠ¸ë¥¼ ì„¸íŒ…í•  ë•Œ ì‚¬ìš©í•œë‹¤.
```java
    @Results(id = "CartOptionMap", value = {
        @Result(column="color_id", property="colorId"),
        @Result(column="color_name", property="colorName"),
        @Result(column="optionQuantity", property="optionQuantity")
    })
    @Select("""
        SELECT c.color_id, cl.color_name, c.product_quantity as optionQuantity
            FROM carts c
            INNER JOIN colors cl ON c.color_id = cl.color_id
            WHERE c.user_id = #{uid}
            AND c.product_id = #{pid}
    """)
    List<CartOptionDTO> selectOptionsByUserAndProduct(@Param("uid") int userId, @Param("pid") int productId) throws Exception;
```
- í•´ë‹¹ ìƒí’ˆì˜ ì˜µì…˜ ê°œìˆ˜ë¥¼ ëª¨ë‘ í•©ì¹œ ì „ì²´ ê°œìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
```java
    @Select("""
        SELECT SUM(product_quantity) 
            FROM carts
            WHERE user_id = #{uid} AND product_id = #{pid}
    """)
    int selectTotalQtyByUserAndProduct(@Param("uid") int userId, @Param("pid") int productId) throws Exception;
```
- ìƒ‰ìƒì˜ ì½”ë“œê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ í•„ìš”í•œ ë§¤í¼ì´ë‹¤. ì´ëŠ” ìƒí’ˆì— í¬í•¨ë˜ëŠ” ìƒ‰ìƒì˜µì…˜ë“¤ì˜ ëª¨ë“  ì»¬ëŸ¬ê°’ì„ í‘œí˜„í•œë‹¤.
```java
    @Results(id = "ColorMap", value = {
        @Result(column="color_id", property="colorId"),
        @Result(column="color_name",property="colorName"),
        @Result(column="color_code",property="colorCode")
    })
    @Select("""
        SELECT cl.*
            FROM product_colors pc
            INNER JOIN colors cl ON pc.color_id = cl.color_id
            WHERE pc.product_id = #{productId}
    """)
    List<Color> selectAllColorsByProduct(int productId) throws Exception;
```
- ë‹¨ì¼ ì¡°íšŒë¥¼ êµ¬í˜„í•œë‹¤. minê³¼ maxë¡œ ë§ì€ ìƒí’ˆë“¤ ì¤‘ ëŒ€í‘œê°’ìœ¼ë¡œ ì¶”ë ¸ê³  CartMapì„ í†µí•´ í•„ìš”í•œ ì •ë³´ëŠ” optionsë¡œ ë„£ì–´ë‘ì—ˆë‹¤.
- ì›ë˜ cartidë¡œ ì¡°íšŒí–ˆë‹¤ê°€ ì¡°ì¸ì„ ìŠ¤ìŠ¤ë¡œí•œí…Œ ê±¸ê³  ë³„ ì´ìƒí•œ ì§“ì„ ë‹¤í•´ì•¼í•´ì„œ ì„œë¹„ìŠ¤ìª½ ë¡œì§ì—ì„œ í•œë²ˆ cartidë¡œ productidë¥¼ ê°€ì ¸ì™€ì„œ ë‹¨ì¼ ì¡°íšŒë¥¼ í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•˜ì˜€ë‹¤.
```java
    @Select("""
    SELECT  MIN(c.cart_id) AS cart_id,          
            c.user_id,
            c.product_id,
            MIN(c.delivery_method) AS delivery_method,
            MIN(c.delivery_price) AS delivery_price,
            MIN(c.reg_date) AS reg_date,
            MAX(c.edit_date) AS edit_date,
            MIN(p.product_name) AS product_name,     
            MIN(p.product_price) AS product_price,
            MIN(p.product_img) AS product_img,
            SUM(c.product_quantity) AS totalQty
        FROM carts c
        JOIN products p ON p.product_id = c.product_id
        WHERE c.user_id = #{userId}
        AND c.product_id = #{productId}
        GROUP BY c.user_id, c.product_id
    """)
    @ResultMap("CartMap")   
    Cart selectCartByUserAndProduct(@Param("userId") int userId, @Param("productId") int productId);
```
- ì•„ë˜ ë‘ ë¡œì§ì„ í†µí•´ ì¥ë°”êµ¬ë‹ˆì—ì„œ í•´ë‹¹ ìƒí’ˆ ì •ë³´ë¥¼ ì‹¹ë¹„ìš°ê³  ìƒˆë¡œìš´ ì •ë³´ë¡œ ì•„ì˜ˆ ì‹¹ ì±„ìš´ë‹¤. ì„œë¹„ìŠ¤ì—ì„œ ì•„ë˜í•¨ìˆ˜ë¥¼ ë°˜ë³µëŒë©´ì„œ ë°˜ë³µì ìœ¼ë¡œ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.
```java
    @Delete("""
        DELETE FROM carts
            WHERE user_id = #{userId}
            AND product_id = #{productId}
    """)
    int deleteByUserAndProduct(int userId, int productId) throws Exception;

    @Insert("""
        INSERT INTO carts(user_id, product_id, color_id,
                            product_quantity, delivery_method,
                            delivery_price, reg_date, edit_date)
        VALUES(#{userId}, #{productId}, #{colorId},
                #{productQuantity}, #{deliveryMethod},
                #{deliveryPrice}, NOW(), NOW())
    """)
    @Options(useGeneratedKeys = true, keyProperty = "cartId") 
    int insertCart(Cart cart) throws Exception;
```
- ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜ë³µëŒë©´ì„œ cart_idê°€ ê°™ì€ ëª¨ë“  í–‰ì„ ì‚­ì œí•œë‹¤.
```java
    /** cart_id IN (â€¦)Â ì‚­ì œ â€“ ì²´í¬ë°•ìŠ¤ ë‹¤ì¤‘ ì‚­ì œìš© */
    @Delete("""
        <script>
            DELETE FROM carts
            WHERE cart_id IN
            <foreach collection='ids' item='id' open='(' separator=',' close=')'>
            #{id}
            </foreach>
        </script>
    """)
    int deleteByIds(@Param("ids") List<Integer> cartIds);
```
- cartidë¥¼ í†µí•´ì„œ useridì™€ productid ë¥¼ ë¦¬í„´í•´ì£¼ëŠ” ë§¤í¼ì´ë‹¤. ì´ë¥¼ í†µí•´ ì¹´íŠ¸ì•„ì´ë””ë§Œ ì•Œì•„ë„ ê·¸ ì¹´íŠ¸ ì•„ì´ë””ì— í•´ë‹¹ë˜ëŠ” ìƒí’ˆê³¼ ê°™ì€ ëª¨ë“  ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.
```java
    @Select("""
        SELECT user_id, product_id
        FROM carts
        WHERE cart_id = #{cartId}
    """)
    Cart selectUserAndProductByCartId(int cartId) throws Exception;
```

