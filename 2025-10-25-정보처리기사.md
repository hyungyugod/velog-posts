# 📌 1. 타겟 타이핑과 SAM 변환(Single Abstract Method Conversion)

## 1-1. 핵심 개념 요약

람다식은 **함수형 인터페이스(Functional Interface)** — 즉, **추상 메서드가 하나뿐인 인터페이스**를 간단히 구현하기 위한 문법이다.  
컴파일러는 **타겟 타이핑(Target Typing)** 을 통해 문맥에서 인터페이스 타입을 추론하고,  
이를 **SAM 변환(Single Abstract Method Conversion)** 을 통해 실제 익명 객체로 변환한다.

---

## 1-2. 코드 예제

```java
interface F {
    int app(int n) throws Exception;
}

public class Main {
    public static int run(F f) {
        try {
            return f.app(3);
        } catch (Exception e) {
            return 7;
        }
    }

    public static void main(String[] args) {
        // 람다식으로 인터페이스 구현
        F f = (x) -> {
            if (x > 2) {
                throw new Exception();
            } else {
                return x * 2;
            }
        };

        // 두 번째 람다는 문맥에서 F로 추론됨 (타겟 타이핑)
        System.out.println(run(f) + run(n -> n + 9));
    }
}
```

---

## 1-3. 코드 동작 과정

1. **`interface F` 정의**

   ```java
   interface F {
       int app(int n) throws Exception;
   }
   ```
   - `app(int n)` 하나뿐이므로 함수형 인터페이스.
   - 람다식은 `app(int)`를 구현하는 형태로 자동 매핑된다.

2. **람다식으로 인터페이스 구현**

   ```java
   F f = (x) -> {
       if (x > 2) throw new Exception();
       else return x * 2;
   };
   ```
   실제로는 다음 코드와 같다:
   ```java
   F f = new F() {
       public int app(int x) throws Exception {
           if (x > 2) throw new Exception();
           else return x * 2;
       }
   };
   ```

3. **타겟 타이핑(Target Typing)**

   ```java
   run(n -> n + 9);
   ```
   - `run`의 매개변수 타입이 `F`이므로,  
     `n -> n + 9`는 자동으로 `F`의 구현체로 변환된다.
   - 즉, 아래와 동일한 코드:
     ```java
     run((F)(n -> n + 9));
     ```

4. **SAM 변환(Single Abstract Method Conversion)**  
   - 컴파일러가 `F`의 추상 메서드(`app`)을 구현하는 익명 객체를 생성한다.
   - 이 과정이 “람다가 인터페이스를 구현한다”의 실체이다.

---

## 1-4. 실행 결과

```text
19
```

- `run(f)` → `f.app(3)` 호출 시 `x=3`, `Exception` 발생 → `catch`로 가서 `7` 반환  
- `run(n -> n + 9)` → `app(3)` 실행 → `12` 반환  
- 최종 출력: `7 + 12 = 19`

---

## 1-5. 개념 비교 요약

| 개념 | 설명 | 예시 |
|------|------|------|
| **함수형 인터페이스** | 추상 메서드가 하나뿐인 인터페이스 | `Runnable`, `Callable`, `Comparator`, `F` |
| **SAM 변환** | 함수형 인터페이스를 람다로 구현하는 과정 | `(x) -> x + 1` |
| **타겟 타이핑** | 람다의 타입을 문맥에서 추론하는 과정 | `run(n -> n + 9)` 에서 `F`로 자동 추론 |

---

## 1-6. 비유로 이해하기

| 개념 | 비유 |
|------|------|
| 타겟 타이핑 | 대화 흐름으로 "누가 말하는지" 자동으로 알아차리는 것 |
| SAM 변환 | “한 가지 약속만 지키면 바로 계약 체결이 가능한 계약서” |

---

## 1-7. 핵심 정리 

람다식은 “타겟 타입이 함수형 인터페이스인 문맥”에서  
해당 인터페이스의 **추상 메서드를 구현하는 익명 객체**로 변환된다.  
즉, `n -> n + 9` 자체는 타입이 없지만, `run` 메서드의 파라미터가 `F`이기 때문에  
컴파일러가 **자동으로 `F`로 캐스팅**하여 실행시킬 수 있다.
