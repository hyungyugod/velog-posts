# ğŸ“Œ 0. ëŒ€í™”
### ğŸ“Œ 0-1. TCP/IP 4ê³„ì¸µ
- í”„ë¡ íŠ¸ì—ì„œ ë°±ì—”ë“œë¡œì˜ ì´ë™ ê²½ë¡œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```sql
ë¸Œë¼ìš°ì €(fetch) â†’ HTTP ìš”ì²­ â†’ TCP/IP í”„ë¡œí† ì½œì„ ê±°ì³ â†’ ì¸í„°ë„· â†’ ì„œë²„(Spring Boot)ë¡œ ë„ì°©
```
- httpì™€ tcp/ipì˜ ì°¨ì´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. ì¦‰ HTTPëŠ” "ë‚´ìš©"ì´ê³  TCP/IPëŠ” "ë‚´ìš©ì„ ìš´ë°˜í•˜ëŠ” íŠ¸ëŸ­ê³¼ ë„ë¡œ"ì´ë‹¤.

| êµ¬ë¶„ | HTTP                            | TCP/IP                        |
| -- | ------------------------------- | ----------------------------- |
| ì—­í•  | **ì›¹ì—ì„œ ì“°ëŠ” ì•½ì†(ê·œì¹™)**, "ë¬´ì—‡ì„ ë³´ë‚¼ì§€" ì •ì˜ | **ì¸í„°ë„· ì „ì†¡ì˜ ë¼ˆëŒ€**, "ì–´ë–»ê²Œ ë³´ë‚¼ì§€" ì •ì˜  |
| ì˜ˆì‹œ | GET, POST, PUT, DELETE ê°™ì€ ìš”ì²­ ë°©ì‹ | ë°ì´í„°ë¥¼ ìª¼ê°œì„œ ë³´ë‚´ê³ , ìˆœì„œ ë§ì¶°ì„œ ë‹¤ì‹œ ì¡°ë¦½    |
| ê³„ì¸µ | ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ                       | ì „ì†¡ ê³„ì¸µ & ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ ë“± í¬í•¨ (4ê³„ì¸µ ëª¨ë¸) |
| ì˜ˆ  | `fetch("/api")` â†’ HTTP GET ìš”ì²­   | ì´ HTTP ë°ì´í„°ë¥¼ íŒ¨í‚·ìœ¼ë¡œ ìª¼ê°œì„œ ì„œë²„ê¹Œì§€ ì „ì†¡  |

- ì•„ë˜ëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì¸í„°ë„·í†µì‹ ì˜ TCP/IP 4ê³„ì¸µ ëª¨ë¸ì´ë‹¤.

| ê³„ì¸µ | ì´ë¦„            | ì˜ˆì‹œ               | ì„¤ëª…                       |
| -- | ------------- | ---------------- | ------------------------ |
| 4  | ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ     | HTTP, HTTPS, FTP | ì‚¬ìš©ìê°€ ì“°ëŠ” ì›¹ ìš”ì²­ ê°™ì€ ê±°        |
| 3  | ì „ì†¡ ê³„ì¸µ         | TCP, UDP         | ë°ì´í„°ë¥¼ ìª¼ê°œê³ , ìˆœì„œë¥¼ ë§ì¶”ê³ , ì˜¤ë¥˜ ê²€ì‚¬ |
| 2  | ì¸í„°ë„· ê³„ì¸µ        | IP, ICMP         | ì£¼ì†Œ ì§€ì • (IP), ëª©ì ì§€ ì°¾ì•„ê°€ê¸°     |
| 1  | ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ | Ethernet, Wi-Fi  | ì‹¤ì œ ì¼€ì´ë¸”, ì™€ì´íŒŒì´, ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜    |

- ìœ„ì˜ ì „ì†¡ì€ ë‚´ ì»´í“¨í„° â†’ ê³µìœ ê¸°(Wi-Fi) â†’ í†µì‹ ì‚¬ â†’ ì¸í„°ë„· ë°±ë³¸ë§ â†’ ì„œë²„ê°€ ìˆëŠ” ë°ì´í„°ì„¼í„° ì´ëŸ°ì‹ìœ¼ë¡œë„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤. 
- ì™€ì´íŒŒì´ë¶€í„° ëª©ì ì§€ ê¹Œì§€ë¥¼ ì¢€ ë” ìì„¸íˆí•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```
ğŸ§‘ ë‚´ ì»´í“¨í„°
â†“
ğŸ“¶ Wi-Fi
â†“
ğŸ¢ KT í†µì‹ ì‚¬ (ISP)
â†“
ğŸŒ ì¸í„°ë„· ë°±ë³¸ë§ (ì „ ì„¸ê³„ë¥¼ ì‡ëŠ” ì´ˆê³ ì† íšŒì„ )
â†“
ğŸ“¦ ì¤‘ê°„ ë¼ìš°í„°ë“¤ (ê±°ì³ì•¼ í•  ê´€ë¬¸ë“¤)
â†“
ğŸ–¥ï¸ ëª©ì ì§€ ì„œë²„ (ì˜ˆ: AWSì˜ ì„œìš¸ ë°ì´í„°ì„¼í„°)
```

### ğŸ“Œ 0-2. ìŠ¤í”„ë§ì˜ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ í†°ìº£
- Spring BootëŠ” 2025ë…„ í˜„ì¬ ê¸°ë³¸ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¡œ 'Apache Tomcat'ì„ ì‚¬ìš©í•œë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ spring-boot-starter-web ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•ˆì— í†°ìº£ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.
```
spring-boot-starter-web
 â””â”€â”€ spring-boot-starter-tomcat
      â””â”€â”€ tomcat-embed-core
      â””â”€â”€ tomcat-embed-websocket
```

| ì—­í•                                     | ì„¤ëª…                                                              |
| ------------------------------------- | --------------------------------------------------------------- |
| 1. **HTTP ìš”ì²­ ìˆ˜ì‹ **                     | ë¸Œë¼ìš°ì €ë‚˜ í”„ë¡ íŠ¸ì—”ë“œê°€ ë³´ë‚¸ ìš”ì²­ì„ ë°›ëŠ”ë‹¤ (`GET`, `POST` ë“±)                       |
| 2. **HttpServletRequest/Response ìƒì„±** | ìš”ì²­ ì •ë³´ë¥¼ `HttpServletRequest`ë¡œ, ì‘ë‹µì€ `HttpServletResponse`ë¡œ ë§Œë“¤ì–´ ë„˜ê¹€ |
| 3. **ì„œë¸”ë¦¿ ì‹¤í–‰**                         | ìš”ì²­ URLì— ë§ëŠ” ì„œë¸”ë¦¿(=Springì˜ DispatcherServlet ë“±)ì„ ì°¾ì•„ì„œ ì‹¤í–‰ì‹œí‚´          |
| 4. **ì‘ë‹µ ë°˜í™˜**                          | ì„œë¸”ë¦¿ì´ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ ë°›ì•„ ë¸Œë¼ìš°ì €ë¡œ ë‹¤ì‹œ ì‘ë‹µìœ¼ë¡œ ì „ì†¡                                |
| 5. **Thread/Connection ê´€ë¦¬**           | ì—¬ëŸ¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìŠ¤ë ˆë“œ í’€, ì»¤ë„¥ì…˜ í’€ ë“± ê´€ë¦¬                                |

- ì „ì²´ ê²½ë¡œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```bash
ë¸Œë¼ìš°ì € â†’ http://localhost:8080/hello ìš”ì²­
         â†“
     [í†°ìº£ (Tomcat)]
         â†“
  HttpServletRequest ê°ì²´ ìƒì„±
         â†“
[DispatcherServlet (ìŠ¤í”„ë§ í•µì‹¬ ì„œë¸”ë¦¿)]
         â†“
    ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤ ë“± í˜¸ì¶œ
         â†“
   ê²°ê³¼ë¥¼ HttpServletResponseë¡œ ë°˜í™˜
         â†“
     [í†°ìº£] ì‘ë‹µ ì „ì†¡
         â†“
     ë¸Œë¼ìš°ì €ì—ê²Œ HTML or JSON ì‘ë‹µ
```

# ğŸ“Œ 1. log
- ìŠ¤í”„ë§ì´ ìë™ ì²˜ë¦¬í•˜ëŠ”ê²Œ ì›Œë‚™ ë§ì•„ì„œ ê°€ì¥ ë¨¼ì € ë¡œê·¸ë¥¼ ì„¸íŒ…í•˜ì—¬ ê¸°ë¡ì„ ì¶”ì í•  ìˆ˜ ìˆëŠ” ë°©ì•ˆì„ ë§ˆë ¨í•´ì•¼ í•œë‹¤.
- slf4jë¥¼ êµ¬í˜„í•˜ëŠ” logbackì„ springbootì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ì—¬ ì´ë¥¼ ì‚¬ìš©í•œë‹¤
- @Slf4jë¥¼ ë¶™ì—¬ë†“ìœ¼ë©´ Lombokì´ ì»´íŒŒì¼í•  ë•Œ í´ë˜ìŠ¤ì— ì½”ë“œë¥¼ "ëª°ë˜" ë„£ì–´ì¤€ë‹¤.
- ê°„ë‹¨í•œ ë¡œê·¸ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤. 
```java
@Slf4j
@Controller
public class HomeController {
    
    @GetMapping("/")
    public String getMethodName(Model model) {
        log.debug("ìŒí•˜í•˜");
        return "index";
    }
}
```
- ì´ëŠ” ìœ„ì˜ ë¡œê·¸ ì½”ë“œê°€ ë³€í™˜ëœ .class íŒŒì¼ì„ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
```java
@Controller
public class HomeController {
   @Generated
   private static final Logger log = LoggerFactory.getLogger(HomeController.class);

   public HomeController() {
   }

   @GetMapping({"/"})
   public String getMethodName(Model model) {
      log.debug("ìŒí•˜í•˜");
      return "index";
   }
}
```
- @GeneratedëŠ” í•´ë‹¹ í•„ë“œê°€ ì§ì ‘ ì…ë ¥í•œ ê²ƒì´ ì•„ë‹Œ ìƒì„±ëœ íŒŒì¼ì´ë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ìœ„ì—ì„œ lombokì´ ì»´íŒŒì¼ ì‹œì ì— ê°ì²´ë¥¼ ìƒì„±í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
- ê·¸ë¦¬ê³  í´ë˜ìŠ¤ì— ìƒì„±ìë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„±ìë¥¼ ì§ì ‘ ìƒì„±í•´ ì¤€ ëª¨ìŠµì´ë‹¤.
- {"/"}ì€ ì›ë˜ @GetMapping({"/", "/home", "/main"}) ì´ëŸ° ì‹ìœ¼ë¡œ ì—¬ëŸ¬ê°œë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìœ¼ë‚˜ ë‚˜ëŠ” ê·¸ëƒ¥ "/" ì´ë ‡ê²Œ ì…ë ¥í–ˆëŠ”ë° ì»´íŒŒì¼ëŸ¬ëŠ” ê·¸ëƒ¥ í†µì¼ì„±ìˆê²Œ ë°°ì—´ë¡œ í‘œí˜„í•´ë‘” ê²ƒì´ë‹¤.

### ğŸ“Œ 1-1. í´ë¼ì´ì–¸íŠ¸ ipì£¼ì†Œ í™•ì¸í•˜ê¸°
- ipv6 ì²´ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ìë°” ì—”ì§„ì—ê²Œ ipv4 ì²´ê³„ë¥¼ ì´ìš©í•´ë‹¬ë¼ê³  í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ì„¤ì •ì„ vscode ì„¤ì •ì— ì¶”ê°€í•œë‹¤.
- "spring-boot.ls.java.vmargs": ["-Djava.net.preferIPv4Stack=true"]
- HttpServletRequest: í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì € ë“±)ê°€ ë³´ë‚¸ HTTP ìš”ì²­ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´ì´ë‹¤. 
- "X-Forwarded-For" : í”„ë¡ì‹œ ì„œë²„ë‚˜ ë¡œë“œ ë°¸ëŸ°ì„œê°€ ìˆì„ ê²½ìš°, ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ì˜ IPê°€ ì´ í—¤ë”ì— ë‹´ê²¨ì„œ ì „ë‹¬ë¨
- í—¤ë” ì´ë¦„ë“¤ì€ ì•„ë˜ì™€ ê°™ì€ ê²ƒë“¤ì´ ìˆë‹¤.
- 
| í—¤ë” ì´ë¦„             | ì„¤ëª…                    |
| ----------------- | --------------------- |
| `Host`            | ìš”ì²­í•œ ë„ë©”ì¸               |
| `User-Agent`      | ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €/ë””ë°”ì´ìŠ¤ ì •ë³´     |
| `Accept`          | í´ë¼ì´ì–¸íŠ¸ê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ë°ì´í„° í˜•ì‹ |
| `Content-Type`    | ì„œë²„/í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” ë°ì´í„° í˜•ì‹  |
| `Authorization`   | ì¸ì¦ ì •ë³´ (í† í° ë“±)          |
| `X-Forwarded-For` | ì›ë˜ ì‚¬ìš©ì IP (í”„ë¡ì‹œ í™˜ê²½)    |

- ì‚¬ìš©ìë§ˆë‹¤ ipë¥¼ ë²¨ë¥˜ë¡œ ê°™ì€ í‚¤ ê°’(í—¤ë” ì´ë¦„)ì´ ë‹¤ë¥´ê³  ê·¸ë˜ì„œ ì–´ë–¤ í—¤ë”ì—ì„œ ì˜¨ê±´ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ì½”ë“œì´ë‹¤. ë§Œì•½ ê°’ì´ ëŒ€ì…ë˜ë©´ ip == nullì´ ì•„ë‹ˆê²Œ ë˜ì–´ ê·¸ ì•„ë˜ ì½”ë“œë“¤ì€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ë§Œì•½ ì•„ë¬´ê²ƒë„ í•´ë‹¹ë˜ì§€ ì•Šìœ¼ë©´ if (ip == null) ip = request.getRemoteAddr(); ë¥¼ í†µí•´ ë°”ë¡œ ì´ì „ ë„¤í¬ì›Œí¬ì˜ ipë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- ì›ë˜ ë°”ë¡œ ì´ì „ ipë¥¼ ê°€ì ¸ì˜¤ë©´ ëŒ€ë¶€ë¶„ ë§ëŠ”ë° ì•„ë˜ ë¯¸ë¦¬ ê²€ì‚¬í•˜ëŠ” ì˜ˆì‹œë“¤ì€ ì—¬ëŸ¬ ipë¥¼ ê±°ì³ì„œ ì „ë‹¬ë˜ëŠ” í”„ë¡ì‹œ ë°©ì‹ ê°™ì€ ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì „ì²˜ë¦¬ë¥¼ í•˜ëŠ” ê²ƒì´ë‹¤.
- ì˜ˆë¡œ X-Forwarded-Forì˜ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```
X-Forwarded-For: [í´ë¼ì´ì–¸íŠ¸ IP], [ì¤‘ê°„ í”„ë¡ì‹œ1 IP], [ì¤‘ê°„ í”„ë¡ì‹œ2 IP], ...
```
```java
@GetMapping("/")
    public String getMethodName(Model model, HttpServletRequest request) {
        String ip = request.getHeader("X-Forwarded-For");
        if (ip == null) ip = request.getHeader("Proxy-Client-IP");
        if (ip == null) ip = request.getHeader("WL-Proxy-Client-IP");
        if (ip == null) ip = request.getHeader("HTTP_CLIENT_IP");
        if (ip == null) ip = request.getHeader("HTTP_X_FORWARDED_FOR");
        if (ip == null) ip = request.getRemoteAddr();

        model.addAttribute("clientIp", ip);
        log.debug(">>> Client IP :" + ip);

        return "index";
    }
```

### ğŸ“Œ 1-2. UserAgent ì •ë³´ ê°€ì ¸ì˜¤ê¸°
- UserAgent: http ìš”ì²­ í—¤ë” ì¤‘ í•˜ë‚˜ë¡œ ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì—ê²Œ ìì‹ ì˜ ì •ë³´ë¥¼ ì„¤ëª…í•´ì£¼ëŠ” ë¶€ë¶„ì´ë‹¤.
- implementation 'com.github.ua-parser:uap-java:1.6.1' ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ dependencyì— ì¶”ê°€í•˜ì—¬ ì‚¬ìš©í•œë‹¤. ì´ëŠ” UserAgent ì •ë³´ì—ì„œ ë¸Œë¼ìš°ì €, os, ë””ë°”ì´ìŠ¤ ì •ë³´ë“¤ì„ ë¶„ë¦¬í•´ì„œ ë¶„ì„í•´ì¤€ë‹¤.
- ì•„ë˜ëŠ” í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ user-agentë¥¼ íŒŒì‹±í•˜ê³  ê²°ê³¼ë¥¼ í…œí”Œë¦¿ê³¼ ë¡œê·¸ì— ì €ì¥í•˜ëŠ” ê³¼ì •ì´ë‹¤. parserëŠ” íŒŒì‹± ê²°ê³¼ë¥¼ client í´ë˜ìŠ¤ì˜ ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤.
- ìœ„ì˜ ê³¼ì •ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ í´ë¼ì´ì–¸íŠ¸ ê°ì²´ì˜ ì†ì„±ê°’ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¸ ê³³ì˜ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.
- cmdì—ì„œ ipconfigë¡œ ë‚´ ì»´í“¨í„° ì£¼ì†Œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.
```java
// useragent ê°’ ì–»ê¸°
        String ua = request.getHeader("user-agent");
        model.addAttribute("ua", ua);
        log.debug(">>>> User-Agent: " + ua);

        Parser uaParser = new Parser();
        Client c = uaParser.parse(ua); // uaë¥¼ ë¶„ì„í•´ì„œ ì •ë¦¬í•´ë‘” ê°ì²´ëŠ” client ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤.

        model.addAttribute("uac", c.toString());
        log.debug(c.toString());

        // ë¸Œë¼ìš°ì € ì •ë³´ë¥¼ Model ê°ì²´ì— ì¶”ê°€
        model.addAttribute("browserFamily", c.userAgent.family);
        model.addAttribute("browserMajor", c.userAgent.major);
        model.addAttribute("browserMinor", c.userAgent.minor);

        log.debug("browserFamily : " + c.userAgent.family);
        log.debug("browserMajor : " + c.userAgent.major);
        log.debug("browserMinor : " + c.userAgent.minor);

        // OS ì •ë³´ë¥¼ Model ê°ì²´ì— ì¶”ê°€
        model.addAttribute("osFamily", c.os.family);
        model.addAttribute("osMajor", c.os.major);
        model.addAttribute("osMinor", c.os.minor);

        log.debug("osFamily : " + c.os.family);
        log.debug("osMajor : " + c.os.major);
        log.debug("osMinor : " + c.os.minor);

        // ë””ë°”ì´ìŠ¤ ì •ë³´ë¥¼ Model ê°ì²´ì— ì¶”ê°€
        model.addAttribute("deviceFamily", c.device.family);
        log.debug("deviceFamily : " + c.device.family);

        /** â˜… í†°ìº£ì´ ë°›ì€ ìš”ì²­(URL) í™•ì¸ â˜… */
        // í˜„ì¬ URL íšë“
        String url = request.getRequestURL().toString();

        // ì ‘ì† ë°©ì‹ ì¡°íšŒ (get ë“±ë“±)
        String methodName = request.getMethod();

        // URLì—ì„œ "?" ì´í›„ì— ì „ë‹¬ë˜ëŠ” GET íŒŒë¼ë¯¸í„° ë¬¸ìì—´ì„ ëª¨ë‘ ê°€ì ¸ì˜¨ë‹¤.
        String queryString = request.getQueryString();

        // ê°€ì ¸ì˜¨ ê°’ì´ ìˆë‹¤ë©´ URLê³¼ ê²°í•©í•˜ì—¬ ì™„ì „í•œ URLì„ êµ¬ì„±í•œë‹¤.
        if (queryString != null) {
            url = url + "?" + queryString;
        }

        model.addAttribute("method", methodName);
        model.addAttribute("url", url);

        log.debug(">>>>> Method : " + methodName);
        log.debug(">>>>> URL : " + url);
        
        return "index";
```

# ğŸ“Œ 2. Intercepter
- ì»¨íŠ¸ë¡¤ëŸ¬ì— ìš”ì²­ì´ ë“¤ì–´ê°€ê¸° ì „Â·í›„ì— ë¼ì–´ë“¤ì–´ì„œ ì²˜ë¦¬í•˜ëŠ” ìŠ¤í”„ë§ì˜ ê¸°ëŠ¥ì´ë‹¤.
- HandlerInterceptor ì¸í„°í˜ì´ìŠ¤ë¥¼ ë‚´ê°€ ì •ì˜í•œ intercepterí´ë˜ìŠ¤ê°€ êµ¬í˜„í•´ì•¼í•œë‹¤. ê·¸ëŸ¼ ëª‡ê°€ì§€ ë©”ì„œë“œë¥¼ ì •ì˜í•´ì•¼í•˜ëŠ”ë° ì´ëŠ” ì•„ë˜ ì‹¤í–‰ê³¼ì •ê³¼ ê°™ì´ ì‚´í´ë³´ë©´ ëœë‹¤.
```scss
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ì— HTTP ìš”ì²­ ì „ì†¡
â†“
[1] DispatcherServletì´ ìš”ì²­ì„ ë°›ìŒ
â†“
[2] preHandle() (Interceptor ì‘ë™ ì‹œì‘)
â†“
[3] ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ì‹¤í–‰
â†“
[4] postHandle() (ë·°ê°€ ë Œë”ë§ë˜ê¸° ì§ì „)
â†“
[5] ë·° ë Œë”ë§ (HTML ìƒì„±)
â†“
[6] afterCompletion() (ëª¨ë“  ì‘ì—… ì™„ë£Œ í›„ í˜¸ì¶œ)
â†“
HTTP ì‘ë‹µ ì „ì†¡ ì™„ë£Œ
```
- ë Œë”ë§ì€ ë°ì´í„°ë¥¼ â€œí™”ë©´ì— ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” í˜•íƒœâ€ë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ì´ë‹¤. ì¦‰ ê²°ê³¼ë¥¼ ë§Œë“œëŠ” ë‹¨ê³„ ì „ì²´ë¥¼ ì˜ë¯¸í•œë‹¤.

### ğŸ“Œ 2-1. ê¸°ë³¸ íŒ¨í‚¤ì§€ êµ¬ì„±
- í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì— ì¼ë°˜ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ì€ ì•„ë˜ì™€ ê°™ë‹¤.

| íŒ¨í‚¤ì§€             | ì—­í•                      | ì˜ˆì‹œ í´ë˜ìŠ¤                                        |
| --------------- | ---------------------- | --------------------------------------------- |
| `controllers`   | ìš”ì²­ ë°›ê³  ì‘ë‹µí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬        | `HomeController`, `UserController`            |
| `models`        | ë°ì´í„°ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´, DTO, ì—”í‹°í‹°  | `User`, `UserDto`, `LoginRequest`             |
| `services`      | í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ìƒí™” (ì¸í„°í˜ì´ìŠ¤) | `UserService`, `BoardService`                 |
| `services.impl` | ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´         | `UserServiceImpl`, `BoardServiceImpl`         |
| `helpers`       | ìœ í‹¸ë¦¬í‹°, ê³µí†µ ê¸°ëŠ¥            | `JwtUtil`, `DateHelper`, `FileUploader`       |
| `interceptors`  | ìš”ì²­ ê°€ë¡œì±„ì„œ ê²€ì‚¬í•˜ëŠ” í´ë˜ìŠ¤       | `LoginCheckInterceptor`, `LoggingInterceptor` |
| `schedulers`    | ìŠ¤ì¼€ì¤„ë§ ì‘ì—… (ë°°ì¹˜ ë“±)         | `EmailScheduler`, `AutoCleanupTask`           |

- ì¢€ ë” ì¶”ê°€í•˜ì—¬

| íŒ¨í‚¤ì§€ ì´ë¦„         | ê¸°ëŠ¥                                      |
| -------------- | --------------------------------------- |
| `repositories` | DB ì ‘ê·¼ ë ˆì´ì–´ (JPA Repository ë“±)            |
| `exceptions`   | ê³µí†µ ì˜ˆì™¸ ì²˜ë¦¬                                |
| `config`       | ì„¤ì • ê´€ë ¨ í´ë˜ìŠ¤ (WebConfig, SecurityConfig ë“±) |
| `enums`        | Enum í´ë˜ìŠ¤ ëª¨ìŒ                             |
| `advice`       | ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ (`@ControllerAdvice`)          |

- ì´ë ‡ê²Œê¹Œì§€ ì¶”ê°€í•œë‹¤.
- staticì— ë„£ëŠ” ë‘ê°œì˜ ê¸°ë³¸ íŒŒì¼ì„ ì•Œì•„ë‘ë©´ ì¢‹ì€ë° ìš°ì„  favicon.iconì€ ë¸Œë¼ìš°ì € íƒ­ ì˜†ì˜ ì´ë¯¸ì§€ë¥¼ ì˜ë¯¸í•˜ê³  robots.txtëŠ” **ê²€ìƒ‰ ì—”ì§„ ë¡œë´‡(í¬ë¡¤ëŸ¬)**í•œí…Œ "ì´ í˜ì´ì§€ëŠ” ë“¤ì–´ì™€ë„ ë¼", "ì—¬ê¸´ ë“¤ì–´ì˜¤ì§€ ë§ˆ"ë¼ê³  ì§€ì‹œí•˜ëŠ” ì—­í• ì„ í•œë‹¤.

### ğŸ“Œ 2-2. interceptor í´ë˜ìŠ¤
- @Component: @ComponentëŠ” ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ê°ì²´(ë¹ˆ)ë¥¼ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•˜ê²Œ í•´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë©° ì•„ë˜ ëª¨ë“  í´ë˜ìŠ¤ì˜ ìƒìœ„ í´ë˜ìŠ¤ì´ë‹¤.

| ì–´ë…¸í…Œì´ì…˜         | ì„¤ëª…               |
| ------------- | ---------------- |
| `@Component`  | ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸          |
| `@Controller` | ì›¹ ìš”ì²­ ë‹´ë‹¹ (MVCì˜ C) |
| `@Service`    | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹´ë‹¹       |
| `@Repository` | DB ì ‘ê·¼ ë¡œì§ ë‹´ë‹¹      |

- String referer = request.getHeader("referer"); ì—ì„œ refererëŠ” headerì˜ ì •ë³´ë¡œ í˜„ì¬ ìš”ì²­ì´ ì˜¤ê¸° ì§ì „ì— ì‚¬ìš©ìê°€ ë¨¸ë¬¼ë €ë˜ ì›¹í˜ì´ì§€ì˜ ì£¼ì†Œë¥¼ ì˜ë¯¸í•œë‹¤.
- ì´ë•Œ ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•´ì•¼ ì•„ë˜ ë¡œê·¸ë¥¼ ì°ëŠ”ê²Œ ì˜ë¯¸ê°€ ìˆëŠ”ë° í†°ìº£ì€ ì´ë¥¼ ì•Œì•„ì„œ ì²˜ë¦¬í•´ì¤€ë‹¤.
- ì‚¬ìš©ìë§ˆë‹¤ ì„¸ì…˜ì„ ë‚˜ëˆ„ëŠ”ë° ë¸Œë¼ìš°ì € - ì„œë²„ ë³„ë¡œ ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ë¸Œë¼ìš°ì €ëŠ” "ì‚¬ìš©ìë§ˆë‹¤ ë”°ë¡œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨"ì´ë‹¤. ë¸Œë¼ìš°ì €ë§ˆë‹¤ ìƒì„±í•´ ì œê³µí•´ì¤€ ì¿ í‚¤ë¡œ ì‚¬ìš©ìë¥¼ êµ¬ë³„í•˜ëŠ” ê²ƒì´ë‹¤.
1. í†°ìº£(ì„œë²„)ì€ ê·¸ ìš”ì²­ì„ ë³´ê³  ì„¸ì…˜ IDë¥¼ ìƒì„±í•œë‹¤.
2. ê·¸ IDë¥¼ ë¸Œë¼ìš°ì €í•œí…Œ Set-Cookie: JSESSIONID=abcd1234 ë¡œ ë³´ë‚¸ë‹¤.
3. ë¸Œë¼ìš°ì €ëŠ” ê·¸ê±¸ ìë™ìœ¼ë¡œ ì¿ í‚¤ì— ì €ì¥í•œë‹¤.
4. ì´í›„ ìš”ì²­ë§ˆë‹¤ JSESSIONID=abcd1234ë¥¼ ë‹¤ì‹œ ë³´ë‚´ì¤€ë‹¤.

```java
@Slf4j
@Component
public class MyInterceptor implements HandlerInterceptor {

    // ì‹œê°„ì´ ì°í ë•Œë§ˆë‹¤ ì €ì¥í•´ë‘˜ ì „ì—­ë³€ìˆ˜
    long startTime = 0;
    long endTime = 0;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
            throws Exception {
        log.info("---------- new client connect ------------");

        startTime = System.currentTimeMillis(); // í˜„ì¬ ì‹œê°„ì„ ê¸°ë¡ 

        // ì ‘ì†í•œ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ í™•ì¸
        String ua = request.getHeader("user-agent");
        Parser uaParser = new Parser();
        Client c = uaParser.parse(ua);

        String fmt = "[Client] %s, %s, %s %s, %s %s";

        String ipAddr = WebHelper.getInstance().getClientIp(request);
        String osVersion = c.os.major + (c.os.minor != null ? "." + c.os.minor : "");
        String uaVersion = c.userAgent.major + (c.userAgent.minor != null ? "." + c.userAgent.minor : "");
        String clientInfo = String.format(fmt, ipAddr, c.device.family, c.os.family, osVersion, c.userAgent.family, uaVersion);

        log.info(clientInfo);
        
        // í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•œ ëª¨ë“  íŒŒë¼ë¯¸í„° í™•ì¸í•˜ê¸°
        Map<String, String[]> params = request.getParameterMap(); // HTTP ìš”ì²­ì—ì„œ ì „ë‹¬ëœ íŒŒë¼ë¯¸í„°ë“¤ì„ í•œ ë²ˆì— ë‹¤ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ë°©ë²•

        for (String key : params.keySet()){
            String [] value = params.get(key);
            log.info(String.format("(param) <- %s = %s", key, String.join(" ,", value))); // ë°°ì—´ ë‚´ë¶€ë¥¼ ,ë¡œ ì´ì€ ë¬¸ìì—´ë¡œ ì¶œë ¥
        }

        // í´ë¼ì´ì–¸íŠ¸ê°€ ë¨¸ë¬¼ë €ë˜ ì´ì „ í˜ì´ì§€ í™•ì¸í•˜ê¸°
        String referer = request.getHeader("referer"); // ì§€ê¸ˆ ìš”ì²­ì´ ì˜¤ê¸° ì§ì „ì— ì‚¬ìš©ìê°€ ë¨¸ë¬¼ë €ë˜ ì›¹í˜ì´ì§€ì˜ ì£¼ì†Œë¥¼ ì˜ë¯¸í•œë‹¤.

        if (referer != null && endTime > 0){ // ì´ì „ì— ë°©ë¬¸í–ˆë˜ í˜ì´ì§€ê°€ ì¡´ì¬í•˜ê³  ì´ì „ì— ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‹¤í–‰í–ˆë‹¤ê°€ ì¢…ë£Œí•œ ì ì´ ìˆë‹¤ë©´
            log.info(String.format("- REFERER : time=%d, url=%s", startTime - endTime, referer)); 
        }

        return HandlerInterceptor.super.preHandle(request, response, handler); // returnì´ booleanì¸ë° ë§Œì•½ falseì´ë©´ controllerë„ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šê³  ìš”ì²­ì„ ì¤‘ë‹¨í•œë‹¤.
    }
    
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
            ModelAndView modelAndView) throws Exception {
        endTime = System.currentTimeMillis();
        log.info(String.format("running time: %d(ms)", endTime - startTime));
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)
            throws Exception {
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```
- ì‹¤í–‰ ì¤‘ ë°œìƒí•œ ì—ëŸ¬: Error resolving template [myview], template might not exist or might not be accessible by any of the configured Template Resolvers
- í•´ì„: í…œí”Œë¦¿ [myview]ì„(ë¥¼) í•´ì„(resolving)í•˜ëŠ” ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
ì´ í…œí”Œë¦¿ì€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜,
í˜„ì¬ ì„¤ì •ëœ í…œí”Œë¦¿ ë¦¬ì¡¸ë²„(Template Resolvers)ë“¤ì— ì˜í•´ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•„ì´ì½˜ì´ ì•ˆëœ¨ëŠ” ì—ëŸ¬: ë¸Œë¼ìš°ì €ì— ë¹ ë¥´ê²Œ ë¡œë”©í•˜ê¸° ìœ„í•œ ìºì‹œê°€ ìŒ“ì—¬ìˆì—ˆëŠ”ë° ì´ì „ì— ì˜¤ë¥˜ê°€ ë‚¬ì—ˆë˜ ì±„ë¡œ ìºì‹œê°€ ìˆì–´ì„œ ì•„ì´ì½˜ì´ ì•ˆë–´ì—ˆë‹¤. ctrl + f5ë¡œ ê°•ì œë¡œ ìºì‹œë¥¼ ë¹„ìš°ê³  ë‹¤ì‹œ ì‹¤í–‰í–ˆë”ë‹ˆ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆë‹¤. 

### ğŸ“Œ 2-3. WebConfig í´ë˜ìŠ¤
- WebConfigëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ ì¸í„°ì…‰í„°, ì •ì  ìì›, ë·° ë¦¬ì¡¸ë²„, CORS ë“± ì›¹ê³¼ ê´€ë ¨ëœ ì„¤ì •ì„ ì§ì ‘ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ì´ë‹¤.
- ì´ëŠ” @Configurationì„ ë¶™ì´ê³ , WebMvcConfigurerë¥¼ êµ¬í˜„í•´ì„œ ë§Œë“ ë‹¤
- @Configurationì€ ì´ í´ë˜ìŠ¤ëŠ” ìŠ¤í”„ë§ ì„¤ì • íŒŒì¼ì´ì•¼!â€ ë¼ê³  Springì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤. 
- ì´ëŠ” XML ì„¤ì • íŒŒì¼ì„ ìë°” ì½”ë“œë¡œ ëŒ€ì²´í•˜ëŠ” ë°©ì‹ì´ë‹¤.
- WebMvcConfigurerì€ ìŠ¤í”„ë§ MVCì—ì„œ ì œê³µí•˜ëŠ” ì›¹ ì„¤ì • ì¸í„°í˜ì´ìŠ¤ë¡œ ì›¹ ìš”ì²­ ì²˜ë¦¬ì˜ ë™ì‘ ë°©ì‹ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆë‹¤. ì¦‰, "ê¸°ë³¸ ë™ì‘ ê·¸ëŒ€ë¡œ ì“°ì§€ ì•Šê³ , ë‚´ ì…ë§›ëŒ€ë¡œ ë°”ê¾¸ê² ë‹¤!" í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
- ì•„ë˜ëŠ” ì½”ë“œì´ê³  êµ³ì´ í˜„ì¬ ì¸í„°ì…‰í„°ê°€ ë°œë™í•´ì„œ ë¡œê·¸ë¥¼ ì°ì§€ ì•Šì•„ë„ ë˜ëŠ” í•­ëª©ì„ ê°™ì´ ë“±ë¡í•´ë‘˜ ìˆ˜ ìˆë‹¤.
```java
@Override
    public void addInterceptors(InterceptorRegistry registry) {
        InterceptorRegistration ir = registry.addInterceptor(new MyInterceptor());
        ir.excludePathPatterns("/hello", "/world", "/error", "/robots.txt", "/favicon.ico", "/assets/**");
    }
```

### ğŸ“Œ 2-4. myview.html
- http://localhost:8080/myapp ì— ë§Œì•½ ë°°í¬ë˜ì–´ ìˆë‹¤ë©´ /byeëŠ” ì‹¤ì œë¡œëŠ” /myapp/byeê°€ ë¼ì•¼ ë§ëŠ” ê²½ë¡œì¸ë° "@{/bye}"ë§Œ í•´ë„ "/myapp/bye"ë¡œ ìë™ì²˜ë¦¬í•´ì¤€ë‹¤.
```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="nottranslate" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myview.</title>
</head>
<body>
    <h1>03-Interceptor</h1>
    <h2>ì—¬ê¸°ëŠ” <span th:text="${where}"></span>ì…ë‹ˆë‹¤.</h2>
    <ul>
        <li><a th:href="@{/}">Index</a></li>
        <li><a th:href="@{/hello}">hello</a></li>
        <li><a th:href="@{/hi}">hi</a></li>
        <li><a th:href="@{/bye}">bye</a></li>
    </ul>
</body>
</html>
```