# ðŸ“Œ 0. í¬ë¡¬ ìµìŠ¤í…ì…˜ ê´€ë ¨
### ðŸ“Œ 0-1. background
- í™•ìž¥ í”„ë¡œê·¸ëž¨ì´ ì„¤ì¹˜/ì—…ë°ì´íŠ¸ë  ë•Œ í•œ ë²ˆ í˜¸ì¶œë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•œë‹¤.
- ì´ íƒ€ì´ë°ì— ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ë¥¼ ë§Œë“¤ì–´ë‘ë©´, í¬ë¡¬ì´ ë©”ë‰´ í•­ëª©ì„ ê¸°ì–µí•œë‹¤.
- id: ì´ ë©”ë‰´ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ê³ ìœ  ì‹ë³„ìž.
- title: ì‹¤ì œ ìš°í´ë¦­ ë©”ë‰´ì— í‘œì‹œë  ë¬¸êµ¬.
- contexts: ["selection"]: í…ìŠ¤íŠ¸ê°€ ì„ íƒë˜ì–´ ìžˆì„ ë•Œë§Œ ì´ ë©”ë‰´ê°€ ëœ¨ê²Œ í•œë‹¤.
```js
chrome.runtime.onInstalled.addListener(() => {
    chrome.contextMenus.create({
        id: "cliplogger-save-selection",
        title: "ClipLogger: ì„ íƒ í…ìŠ¤íŠ¸ ì €ìž¥",
        contexts: ["selection"],
    });
});
```
- if (info.menuItemId !== "cliplogger-save-selection") return; í˜„ìž¬ ë“œëž˜ê·¸í•˜ê³  ì„ íƒí•œ ë©”ë‰´ê°€ ìœ„ì—ì„œ ë‚´ê°€ ë§Œë“  ë©”ë‰´ê°€ ì•„ë‹ ë•ŒëŠ” í´ë¦­ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
- payloadëŠ” ë“œëž˜ê·¸í•œ ì •ë³´ë¥¼ ì €ìž¥í•˜ëŠ” ê°ì²´ë¡œ ë°œìƒí•œ ì´ë²¤íŠ¸ ê°ì²´ì—ì„œ ì •ë³´ë“¤ì„ ê°€ì ¸ì™€ ì¼ì‹œì ìœ¼ë¡œ ì ìž¬í•œë‹¤.
- ì´í›„ ì´ payloadë¥¼ jsonìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ì„œë²„ë¡œ ë³´ë‚¸ë‹¤.
- ì„œë²„ì—ì„œ ëŒì•„ì˜¨ ì‘ë‹µì´ ì¡´ìž¬í•˜ë©´ ì´ë¥¼ js ê°ì²´ë¡œ íŒŒì‹±í•˜ì—¬ ì„±ê³µì—¬ë¶€ì— ëŒ€í•œ ì•Œë¦¼ì„ ë„ìš´ë‹¤. ë§Œì•½ ì‹¤íŒ¨í•˜ë©´ ì‹¤íŒ¨í–ˆë‹¤ê³  ì•Œë¦¼ì„ ë„ìš´ë‹¤.
```js
chrome.contextMenus.onClicked.addListener(async (info, tab) => {
    if (info.menuItemId !== "cliplogger-save-selection") return;

    const payload = {
        text: info.selectionText || "",
        url: info.pageUrl || tab?.url || "",
        title: tab?.title || "",
        ts: new Date().toISOString(),
    };

    try {
        const res = await fetch("http://127.0.0.1:54545/log", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
    });

    if (!res.ok) {
        notify({ title: "ClipLogger ì‹¤íŒ¨", message: `HTTP ${res.status}` });
        return;
    }

    const data = await res.json();
    
    notify({
        title: "ClipLogger ì €ìž¥ ì™„ë£Œ",
        message: `${data.path} (${data.format || "txt"})`,
    });

    } catch (e) {
        notify({ title: "ClipLogger ì—ëŸ¬", message: String(e) });
    } 
});
```
- ìœ„ì—ì„œ ì‚¬ìš©í•˜ê³  ìžˆëŠ” notify í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ”ë° ì´ëŠ” í¬ë¡¬ì˜ notificationsë¥¼ ì´ìš©í•œë‹¤.
- ì–´ë””ì„œë“  notify({ title: "ì„±ê³µ", message: "ì €ìž¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤" }) ë¼ê³  ì“°ë©´, â†’ í¬ë¡¬ ìš°ì¸¡ í•˜ë‹¨ì— íŒì—… ì•Œë¦¼ì´ ëœ¬ë‹¤.
```js
function notify({ title, message }) {
    chrome.notifications.create({
        type: "basic",
        iconUrl: "icon128.png", // ì—†ìœ¼ë©´ ìž„ì‹œë¡œ chrome ê¸°ë³¸ ì•„ì´ì½˜ ì‚¬ìš©ë¨
        title,
        message,
        priority: 1, // ìš°ì„ ìˆœìœ„ë¥¼ ì˜ë¯¸í•œë‹¤.
    }); 
}
```

### ðŸ“Œ 0-2. manifest
- ë§¤ë‹ˆíŽ˜ìŠ¤íŠ¸ì˜ ìŠ¤íŽ™ ë²„ì „. ì§€ê¸ˆì€ Manifest V3(MV3) ë¥¼ ì‚¬ìš©.
- MV3ì˜ íŠ¹ì§•: ë°±ê·¸ë¼ìš´ë“œ íŽ˜ì´ì§€ ëŒ€ì‹  ì„œë¹„ìŠ¤ ì›Œì»¤, ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ í•„ìš”í•  ë•Œë§Œ ê¹¨ì–´ë‚˜ëŠ” ìˆ˜ëª…ì£¼ê¸°.
- name ì—ì„œ ì •ì˜í•œ ì´ë¦„ëŒ€ë¡œ í™•ìž¥í”„ë¡œê·¸ëž¨ì˜ ì´ë¦„ì´ ëª©ë¡, í¬ë¡¬ì›¹ìŠ¤í† ì–´ ë“±ì—ì„œ ë³´ì¸ë‹¤.
- "description": "Save selected text with URL to a local log file." -> í™•ìž¥ í”„ë¡œê·¸ëž¨ì˜ ì§§ì€ ì„¤ëª…. ìŠ¤í† ì–´/í™•ìž¥ ìƒì„¸ì—ì„œ í‘œì‹œ
- "permissions": ["contextMenus", "notifications"] ì€ ì•„ëž˜ì™€ ê°™ë‹¤.
- "contextMenus": ìš°í´ë¦­ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìƒì„±/ì œì–´ ê¶Œí•œ.
- "notifications": chrome.notificationsë¡œ ì•Œë¦¼ì„ ë„ìš¸ ê¶Œí•œ.
- "host_permissions": ["http://127.0.0.1:54545/*", "http://localhost:54545/*"] : í˜¸ìŠ¤íŠ¸ ì ‘ê·¼ ê¶Œí•œ(CORS ëŒ€ìƒ ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸).
- 127.0.0.1 = ë‚´ ì»´í“¨í„° ìžì‹ ìœ¼ë¡œ ë£¨í”„ë°± ì£¼ì†Œë¼ê³  ë¶ˆë¦°ë‹¤. -> ê¸°ë³¸ì ìœ¼ë¡œ ë£¨í”„ë°± í†µì‹ ì€ ë°©í™”ë²½ì— ë§‰ížˆì§€ ì•ŠëŠ”ë‹¤.
- "background": {} -> ë‚´ í¬ë¡¬ í™•ìž¥í”„ë¡œê·¸ëž¨ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì´ë ‡ê²Œ ë™ìž‘í•œë‹¤ëŠ” ê²ƒì„ ì„¤ì •í•˜ëŠ” ë¸”ë¡ì´ë‹¤.
- "service_worker": "background.js" : background.jsë¥¼ ì„œë¹„ìŠ¤ ì›Œì»¤ ë°©ì‹ (í•„ìš”í• ë•Œë§Œ ìž ê¹ ì‹¤í–‰ëœë‹¤.)ìœ¼ë¡œ ê°€ë™í•œë‹¤ëŠ” ëœ»ì´ë‹¤.
- "type": "module" ì„ ì„¤ì •í•˜ë©´ ì´ë¥¼ ìžë°”ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆë¡œ ì‹¤í–‰í•˜ì—¬ importë‚˜ export ë“±ì˜ ë¬¸ë²•ì„ ìžìœ ë¡­ê²Œ ì‹¤í–‰í•˜ê²Œ ë‘”ë‹¤.
```json
{
  "manifest_version": 3,
  "name": "ClipLogger",
  "version": "0.2.0",
  "description": "Save selected text with URL to a local log file.",
  "permissions": ["contextMenus", "notifications"],
  "host_permissions": ["http://127.0.0.1:54545/*", "http://localhost:54545/*"],
  "background": {
    "service_worker": "background.js",
    "type": "module"
  }
}
```

# ðŸ“Œ 1. ë¡œê±° ì„œë²„
### ðŸ“Œ 1-1. ë¡œê±° ì„œë²„ ê¸°ë³¸ ì„¤ì •
- require: Node.jsì—ì„œ ë‹¤ë¥¸ íŒŒì¼ì´ë‚˜ ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ë¡œ importì™€ ê°™ì€ ì—­í• ì„ í•œë‹¤.
- require("http") â†’ Node.js ë‚´ë¶€ì— ë‚´ìž¥ëœ "http" ëª¨ë“ˆì„ ê°€ì ¸ì˜´. -> ì´ë ‡ê²Œ í•˜ë ¤í–ˆìœ¼ë‚˜ ì´ë³´ë‹¤ expressê°€ ë” ì¢‹ê¸° ë•Œë¬¸ì— ì•„ëž˜ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì˜€ë‹¤.
- ì•„ëž˜ëŠ” expressë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ë¥¼ êµ¬ì„±í•œ ì½”ë“œì´ë‹¤.
- ë˜í•œ ì‚¬ìš©í•  í¬íŠ¸ì™€ ê¸°ë³¸ ì €ìž¥ì–‘ì‹, ê·¸ë¦¬ê³  ë‚ ì§œê¸°ì¤€ì„ ì§€ì •í•˜ëŠ”ë° env íŒŒì¼ì— ì§€ì •í•´ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```js
const express = require("express");
const cors = require("cors");
const morgan = require("morgan");
const fs = require("fs");
const os = require("os");
const path = require("path");

const PORT = process.env.CLIPLOGGER_PORT || 54545;
const FORMAT = (process.env.CLIPLOGGER_FORMAT || "txt").toLowerCase(); // txt | md | jsonl
const TIME_ZONE = process.env.CLIPLOGGER_TZ || "Asia/Seoul";
```
- joindms ì—¬ëŸ¬ ê²½ë¡œ ì¡°ê°ì„ í•˜ë‚˜ì˜ ì˜¬ë°”ë¥¸ íŒŒì¼ ê²½ë¡œ ë¬¸ìžì—´ë¡œ í•©ì³ì£¼ëŠ” í•¨ìˆ˜ë¡œì„œ ìš´ì˜ì²´ì œ(OS)ì— ë§žëŠ” ê²½ë¡œ êµ¬ë¶„ìžë¥¼ ìžë™ìœ¼ë¡œ ì¨ì¤€ë‹¤.
- resolveDesktopBaseì€ ìœˆë„ìš° ë°”íƒ•í™”ë©´ì´ë˜ OneDriveê°€ í¬í•¨ëœ ë°”íƒ•í™”ë©´ì´ë˜ê°„ì— í•´ë‹¹ ì»´í“¨í„°ì˜ ë°”íƒ•í™”ë©´ ì•„ëž˜ ClipLoggerë¼ëŠ” í´ë”ì˜ ì£¼ì†Œë¥¼ ë°˜í™˜í•œë‹¤.
- ê·¸ë¦¬ê³  ì´ˆê¸°ì— ì´ë ‡ê²Œ ì„¤ì •ëœ ê°’ì„ ê·¸ í”„ë¡œê·¸ëž¨ì˜ BASE_DIRë¡œ ì‚¼ëŠ”ë‹¤.
- ensureDirSyncì€ í´ë”ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ë¡œì„œ í˜¸ì¶œë˜ë©´ ë‚´ë¶€ì— ìž¬ê·€ì ìœ¼ë¡œ í•´ë‹¹ ì£¼ì†Œì— ë§žëŠ” í´ë”ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ì´ë‹¤.
```js
function resolveDesktopBase() {
    if (process.env.CLIPLOGGER_BASE_DIR) return process.env.CLIPLOGGER_BASE_DIR;

    const home = os.homedir();
    const desktop1 = path.join(home, "Desktop");
    const desktop2 = path.join(home, "OneDrive", "Desktop"); // Windows OneDrive

    if (fs.existsSync(desktop1)) return path.join(desktop1, "ClipLogger");
    if (fs.existsSync(desktop2)) return path.join(desktop2, "ClipLogger");
    return path.join(home, "ClipLogger"); // fallback
}
const BASE_DIR = resolveDesktopBase();

function ensureDirSync(dir) {
    fs.mkdirSync(dir, { recursive: true });
}
```
- getDateParts ë‚ ì§œë¥¼ íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- ì£¼ì–´ì§„ íƒ€ìž„ìŠ¤í…œí”„ê°€ ìžˆìœ¼ë©´ ì´ë¥¼ ì—°ì›”ì¼ë¡œ ì¶”ì¶œí•œë‹¤. ë§Œì•½ ì£¼ì–´ì§„ íƒ€ìž„ìŠ¤íƒ¬í”„ê°€ ì—†ìœ¼ë©´ í˜„ìž¬ ì‹œê°ìœ¼ë¡œ ì¶”ì¶œí•œë‹¤.
- ë§Œì•½ ìž˜ëª»ëœ ë‚ ì§œë©´ ì¦‰ì‹œ í˜„ìž¬ì‹œê°ìœ¼ë¡œ ìž¬í˜¸ì¶œí•´ ì•ˆì „í•˜ê²Œ ë³µêµ¬í•œë‹¤.
- Intl.DateTimeFormatìœ¼ë¡œ íƒ€ìž„ì¡´ì„ ì ìš©í•œ ë‚ ì§œ í¬ë§·í„° ìƒì„±. -> ê²°êµ­ í¬ë©§ëœ íŒŒíŠ¸ë“¤ì„ { yyyy, mm, dd } ì´ë ‡ê²Œ êµ¬ì¡°í™”ëœ ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤.
```js
function getDateParts(tsIso) {
    // tsIsoê°€ invalidë©´ í˜„ìž¬ ì‹œê°
    const d = new Date(tsIso || Date.now());
    
    // ìž˜ëª»ëœ ë‚ ì§œì¼ ê²½ìš°
    if (isNaN(d.getTime())) return getDateParts(new Date().toISOString());

    // íƒ€ìž„ì¡´ ê¸°ì¤€ìœ¼ë¡œ ì—°-ì›”-ì¼ì„ ì•ˆì „ ì¶”ì¶œ
    const fmt = new Intl.DateTimeFormat("en-CA", {
        timeZone: TIME_ZONE,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
    });

    const [{ value: yyyy }, , { value: mm }, , { value: dd }] = fmt.formatToParts(d);
    return { yyyy, mm, dd };
}
```
- toLineí•¨ìˆ˜ëŠ” í¬ë©§ë³„ë¡œ ë¡œê·¸ë¥¼ ì§œë§žì¶”ëŠ” ì—­í• ì„ í•œë‹¤. 
- ë§ˆí¬ë‹¤ìš´, jsonl, txt ì¤‘ ì„ íƒëœ ê°’ìœ¼ë¡œ í¬ë©§í•˜ê³  ì´ í¬ë©§ëœ ë¬¸ìžì—´ì„ ë°˜í™˜í•œë‹¤.
```js
// í¬ë§·ë³„ ë¬¸ìžì—´ ìƒì„±
function toLine({ ts = "", title = "", url = "", text = "" }) {
    if (FORMAT === "md") {
        return `- **[${title || url}](${url})** \\
    _${ts}_

    > ${String(text || "").replace(/\n/g, "\n> ")}

    ---
    `;
    }
    if (FORMAT === "jsonl") {
        return JSON.stringify({ ts, title, url, text }) + "\n";
    }
    // txt ê¸°ë³¸
    return `[${ts}] ${title} ${url}
    ${text}
    -----
    `;
}
```
- resolveDailyFileëŠ” ë‚ ì§œë³„ë¡œ íŒŒì¼ê²½ë¡œë¥¼ ê³„ì‚°í•œë‹¤. getDatePartsì—ì„œ ë‚ ì§œë¡œ ê°€ì ¸ì™€ì„œ -ë¡œ ì—®ì–´ì„œ ë¬¶ê³  í´ë”ëª…ê³¼ í™•ìž¥ìžë©´ ê·¸ë¦¬ê³  ê·¸ë ‡ê²Œ ë§Œë“  íŒŒì¼ëª…ì„ ë°˜í™˜í•œë‹¤.
```js
// ë‚ ì§œë³„ íŒŒì¼ ê²½ë¡œ ê³„ì‚°: BASE/YYYY/MM/ClipLogger-YYYY-MM-DD.ext
function resolveDailyFile(tsIso) {
    const { yyyy, mm, dd } = getDateParts(tsIso);
    const dateStr = `${yyyy}-${mm}-${dd}`;
    const dir = path.join(BASE_DIR, yyyy, mm);
    const ext = FORMAT === "jsonl" ? "jsonl" : FORMAT === "md" ? "md" : "txt";
    const file = path.join(dir, `ClipLogger-${dateStr}.${ext}`);
    
    return { dir, file, dateStr };
}
```
- writeLogëŠ” payloadë¥¼ ê°€ì§€ê³  ë¡œê·¸ë¥¼ ì»´í“¨í„°ì— ì €ìž¥í•˜ê³  ì‘ë‹µê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
```js
// íŒŒì¼ append + ì‘ë‹µ
function writeLog(payload, res) {
    const ts = payload.ts || new Date().toISOString();
    const { dir, file } = resolveDailyFile(ts);

    ensureDirSync(dir);

    const line = toLine({ ...payload, ts });

    fs.appendFile(file, line, (err) => {
        if (err) {
            return res.status(500).json({ ok: false, error: err.message });
        }
        
        return res.status(200).json({
            ok: true,
            path: file,
            dir,
            base: BASE_DIR,
            format: FORMAT,
            tz: TIME_ZONE,
        });
    });
}
```

### ðŸ“Œ 1-2. ë¡œê±° ì„œë²„ ì„¤ì •
- const app = express(); ìœ¼ë¡œ expressë¥¼ í˜¸ì¶œí•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ ì•±ì„ ìƒì„±í•˜ê³  ì•žìœ¼ë¡œ ë¯¸ë“¤ì›¨ì–´, ë¼ìš°í„°, ì—ëŸ¬ í•¸ë“¤ë§, ì„œë²„ ì‹œìž‘ ë“±ì„ ì´ ê°ì²´ì— ë¶™ì—¬ì„œ êµ¬ì„±í•˜ê²Œ ëœë‹¤.
- app.use(cors()); ì´ë¥¼ í†µí•´ cors ë¯¸ë“¤ì›¨ì–´ë¥¼ ë“±ë¡í•œë‹¤.
- app.use(morgan("dev")); ë¥¼ í™œìš©í•˜ì—¬ HTTP ìš”ì²­ ë¡œê¹… ë¯¸ë“¤ì›¨ì–´ morganì„ dev í¬ë§·ìœ¼ë¡œ ë“±ë¡í•œë‹¤.
- app.use(express.json({ limit: "2mb" })) ë“¤ì–´ì˜¤ëŠ” application/json ë°”ë””ë¥¼ ìžë™ íŒŒì‹±í•´ req.bodyì— ë„£ì–´ì¤€ë‹¤. ì´ë•Œ ìš”ì²­ ë³¸ë¬¸ ìµœëŒ€ í¬ê¸°ë¥¼ 2MBë¡œ ì œí•œí•¨(ê³¼ë„í•œ íŽ˜ì´ë¡œë“œë¡œ ì¸í•œ ìžì› ë‚­ë¹„/DoSë¥¼ ì˜ˆë°©).
- GET /health í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•œë‹¤. ì„œë²„ê°€ ì‚´ì•„ ìžˆê³ , ì£¼ìš” ì„¤ì • ê°’(BASE_DIR, FORMAT, TIME_ZONE)ì„ í™•ì¸í•  ìˆ˜ ìžˆê²Œ JSONìœ¼ë¡œ ì‘ë‹µí•œë‹¤.
- POST /log ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•˜ì—¬ ë“¤ì–´ì˜¨ ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ì €ìž¥í•˜ëŠ” ê³¼ì •ì„ ìˆ˜í–‰í•˜ë„ë¡ í•œë‹¤.
- ë˜í•œ ë¼ìš°íŠ¸ ë’¤ì— ë‘ëŠ” ì¼ë°˜ ë¯¸ë“¤ì›¨ì–´ë¡œ, ìœ„ì—ì„œ ë§¤ì¹­ë˜ì§€ ì•Šì€ ëª¨ë“  ìš”ì²­ì„ 404ë¡œ ì²˜ë¦¬í•œë‹¤.
- ë˜í•œ ìœ„ ë¯¸ë“¤ì›¨ì–´/ë¼ìš°íŠ¸ì—ì„œ throwë˜ê±°ë‚˜ next(err)ë¡œ ì „ë‹¬ëœ ì˜ˆì™¸ë¥¼ í•œ ê³³ì—ì„œ ìž¡ì•„ 500ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” ë¡œì§ì„ ê°€ì§„ë‹¤.
- app.listen(PORT, () => { ë¥¼ í†µí•´ ì§€ì •ëœ PORTë¡œ ì„œë²„ë¥¼ ì‹œìž‘í•œë‹¤.
```js
// App & Middlewares
const app = express();

// CORS: ê¸°ë³¸ ì „ë¶€ í—ˆìš©(ë¡œì»¬ í™•ìž¥ë§Œ ë¶™ëŠ” êµ¬ì¡°ì´ë‹ˆ ì¶©ë¶„)
app.use(cors());

// Request logging (ê°œë°œ íŽ¸ì˜)
app.use(morgan("dev"));

// JSON Body parser (application/json)
app.use(express.json({ limit: "2mb" })); // í•„ìš”ì‹œ í¬ê¸° ì¡°ì ˆ

// Health check
app.get("/health", (req, res) => {
    res.json({
        ok: true,
        base: BASE_DIR,
        format: FORMAT,
        tz: TIME_ZONE,
        tip: "POST /log with {text,url,title,ts}",
    });
});

// Log endpoint
app.post("/log", (req, res) => {
    try {
        const payload = req.body || {};
        writeLog(
        {
            text: payload.text || "",
            url: payload.url || "",
            title: payload.title || "",
            ts: payload.ts || new Date().toISOString(),
        },
        res
        );
    } catch (e) {
        res.status(400).json({ ok: false, error: "Invalid JSON" });
    }
});

// 404
app.use((req, res) => {
    res.status(404).json({ ok: false, error: "Not found" });
});

// Global error handler (ì•ˆì „ë§)
app.use((err, req, res, next) => {
    console.error("Unhandled error:", err);
    res.status(500).json({ ok: false, error: "Internal Server Error" });
});

// Start
app.listen(PORT, () => {
    console.log(`ClipLogger (Express) listening on http://127.0.0.1:${PORT}`);
    console.log(`Base dir : ${BASE_DIR}`);
    console.log(`Format   : ${FORMAT}`);
    console.log(`TimeZone : ${TIME_ZONE}`);
});
```




