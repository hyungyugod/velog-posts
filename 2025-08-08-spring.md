# ğŸ“Œ 0. ìŠ¤í”„ë§ + ë¦¬ì•¡íŠ¸ ì—°ê³„ ë³´ìŠ¤ ì‚¬ì´íŠ¸ ë°©ë¬¸ììˆ˜ ì§‘ê³„
### ğŸ“Œ 0-1. í…Œì´ë¸”êµ¬ì¡°ì™€ ì§‘ê³„ ë°©ì‹
- ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë§¤ì¼ í•˜ë£¨ ë°©ë¬¸ìì˜ ipìˆ˜(ì¤‘ë³µ ì—†ì´)ë¥¼ ì¡°íšŒí•˜ì—¬ Visitor_statistic í…Œì´ë¸”ì— ë“±ë¡í•œë‹¤.
```java
@Data
@Builder
public class VisitorStatistic {
    private int visitorStatisticId; // ë°©ë¬¸ì í†µê³„ ID
    private int dailyVisitorSum; // ì¼ì¼ ë°©ë¬¸ì í•©ê³„
    private LocalDateTime regDate; // ë“±ë¡ ì‹œê°„
    private LocalDateTime editDate; // ìˆ˜ì • ì‹œê°„
}
```
- í”„ë¡ íŠ¸ì—ì„œ í†µê³„ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë©´ ì•„ë˜ ì²˜ëŸ¼ í˜„ì¬ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ ë°ì´í„°ë¥¼ ëª¨ì•„ DTOì— ë„£ì–´ì„œ ë°˜í™˜í•œë‹¤.
```java
@Data
@Builder
public class VisitorStatsDto {
    private Map<String, Integer> monthlyStats;  // ì§€ë‚œ 1ë…„ê°„ ì›”ë³„ í†µê³„ (ë…„-ì›” : ë°©ë¬¸ììˆ˜)
    private Map<String, Integer> yearlyStats;   // ìµœê·¼ 5ë…„ê°„ ì—°ë³„ í†µê³„ (ë…„ : ë°©ë¬¸ììˆ˜)
    private Map<String, Integer> dailyStats;    // ìµœê·¼ 7ì¼ê°„ ë‚ ì§œë³„ í†µê³„ (ì›”-ì¼ : ë°©ë¬¸ììˆ˜)
    private int totalVisitors;                  // ì´ ë°©ë¬¸ììˆ˜
}
```

### ğŸ“Œ 0-2. ì¼ë³„ ë°©ë¬¸ììˆ˜ -> ìµœê·¼ ì—°, ì›”, ì¼ë³„ ì¡°íšŒ ì„œë¹„ìŠ¤
- ìš°ì„  ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- LocalDateTimeì˜ isAfter ë©”ì„œë“œëŠ” ë„£ì€ ë‚ ì§œ ì´í›„ë¼ë©´ trueë¥¼ ë°˜í™˜í•œë‹¤. ì´ë¥¼ ì´ìš©í•´ oneYearAgo, fiveYearsAgo, sevenDaysAgoë¥¼ ëª¨ë‘ ì´ìš©í•˜ì—¬ ì „ì²´ ë°ì´í„°ë¥¼ ìˆœí™˜í•˜ë©´ì„œ í•´ë‹¹ ë‚ ì§œì— ë§ëŠ” ë°ì´í„°ë§Œ ìš°ì„  ê±°ë¥¸ë‹¤.
- ì´í›„ stringìœ¼ë¡œ í‚¤ê°’ì„ ì„¤ì •í•˜ê³  mapì— getOrDefaultë¥¼ í™œìš©í•˜ì—¬ ìƒˆë¡œìš´ í‚¤ê°’ì„ ë§Œë“¤ì–´ì„œ ë°©ë¬¸ììˆ˜ë¥¼ ëˆ„ì í•œë‹¤. ì´ë•Œ í‚¤ê°’ì€ ì˜ˆë¥¼ë“¤ì–´ 12ì›”ì´ë©´ 2025-12ì›”ì´ëœë‹¤.
- í‚¤í¬ì¸íŠ¸ëŠ” mapperì—ì„œ ë‚ ì§œë¥¼ ê³¼ê±°ì—ì„œ í˜„ì¬ ìˆœìœ¼ë¡œ ì¦‰ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ê°€ì ¸ì™€ì„œ LinkedHashMapìœ¼ë¡œ ìˆœì„œë¥¼ ìœ ì§€í•˜ì—¬ ë°ì´í„°ë¥¼ êº¼ë‚¼ë•Œ ê³¼ê±°ë¶€í„° êº¼ë‚´ì„œ í˜„ì¬ê°€ ë§¨ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì˜¤ê²Œ í•˜ëŠ”ë°ì— ìˆë‹¤.
```java
@Autowired
    private VisitorMapper visitorMapper;    
    
    @Override
    public VisitorStatsDto getVisitorStats() {
        // ì „ì²´ ë°©ë¬¸ì í†µê³„ ë°ì´í„° ì¡°íšŒ
        List<VisitorStatistic> allData = visitorMapper.getAllVisitorStatistics();
        int totalVisitors = visitorMapper.getTotalVisitorCount();
        
        // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§ ë‚ ì§œ ê³„ì‚°
        LocalDateTime now = LocalDateTime.now();
        LocalDateTime oneYearAgo = now.minusMonths(11);
        LocalDateTime fiveYearsAgo = now.minusYears(4);
        LocalDateTime sevenDaysAgo = now.minusDays(7);
        
        // í†µê³„ìš© Map ì´ˆê¸°í™”
        Map<String, Integer> monthlyStats = new LinkedHashMap<>();
        Map<String, Integer> yearlyStats = new LinkedHashMap<>();
        Map<String, Integer> dailyStats = new LinkedHashMap<>();
        
        // ì „ì²´ ë°ì´í„°ë¥¼ ìˆœíšŒí•˜ë©´ì„œ í†µê³„ ê³„ì‚°
        for (VisitorStatistic statistic : allData) {          
            LocalDateTime regDate = statistic.getRegDate();
            
            if (regDate != null) {
                // ì—°ë³„ í†µê³„ (ìµœê·¼ 5ë…„ ë°ì´í„°ë§Œ)
                if (regDate.isAfter(fiveYearsAgo)) {
                    String yearKey = String.valueOf(regDate.getYear());
                    yearlyStats.put(yearKey, yearlyStats.getOrDefault(yearKey, 0) + statistic.getDailyVisitorSum());
                }
                
                // ì›”ë³„ í†µê³„ (ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ)
                if (regDate.isAfter(oneYearAgo)) {
                    String monthKey = String.format("%d-%02d", regDate.getYear(), regDate.getMonthValue());
                    monthlyStats.put(monthKey, monthlyStats.getOrDefault(monthKey, 0) + statistic.getDailyVisitorSum());
                }
                
                // ë‚ ì§œë³„ í†µê³„ (ìµœê·¼ 7ì¼ ë°ì´í„°ë§Œ)
                if (regDate.isAfter(sevenDaysAgo)) {
                    String dayKey = String.format("%02d-%02d", regDate.getMonthValue(), regDate.getDayOfMonth());
                    dailyStats.put(dayKey, dailyStats.getOrDefault(dayKey, 0) + statistic.getDailyVisitorSum());
                }
            }        
        }
        
        // DTO ë¹Œë” íŒ¨í„´ìœ¼ë¡œ ìƒì„±
        return VisitorStatsDto.builder()
            .monthlyStats(monthlyStats)
            .yearlyStats(yearlyStats)
            .dailyStats(dailyStats)
            .totalVisitors(totalVisitors)
            .build();
    }
```
- mapperëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```java
@Mapper
public interface VisitorMapper {    
    
    @Insert("INSERT INTO visitor_statistic (daily_visitor_sum, reg_date, edit_date) " +
            "VALUES (#{dailyVisitorSum}, #{regDate}, #{editDate})")    
    int insertVisitorStatistic(VisitorStatistic visitorStatistic);    
    
    // ì „ì²´ ë°©ë¬¸ì í†µê³„ ë°ì´í„° ì¡°íšŒ (ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬: ê³¼ê±° -> í˜„ì¬)
    @Select("SELECT visitor_statistic_id, daily_visitor_sum, reg_date, edit_date FROM visitor_statistic ORDER BY reg_date ASC")
    List<VisitorStatistic> getAllVisitorStatistics();
    
    // ì˜¤ëŠ˜ ë‚ ì§œì˜ í†µê³„ê°€ ìˆëŠ”ì§€ í™•ì¸
    @Select("SELECT COUNT(*) FROM visitor_statistic WHERE DATE(reg_date) = CURDATE()")
    int getTodayStatisticCount();

      // ì˜¤ëŠ˜ ë‚ ì§œì˜ í†µê³„ ì—…ë°ì´íŠ¸
    @Update("UPDATE visitor_statistic SET daily_visitor_sum = daily_visitor_sum + #{increment}, edit_date = NOW() " +
            "WHERE DATE(reg_date) = CURDATE()")
    int updateTodayStatistic(int increment);
}
```

### ğŸ“Œ 0-3. ë°©ë¬¸ììˆ˜ í”„ë¡ íŠ¸ì—”ë“œ ì„¤ê³„
- ë¦¬ì•¡íŠ¸ì—ì„œ ì¤‘ìš”í•œ ì ì€ chartDataë¥¼ ë“œë¡­ë°•ìŠ¤ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ìŠ¤íƒ€ì¼ê³¼ data = item.yearlyStatsì²˜ëŸ¼ mapê¹Œì§€ itemìœ¼ë¡œ ë‹´ì•„ì„œ useMemoë¥¼ í†µí•´ ë¦¬í„´í•˜ëŠ” ê²ƒì´ë‹¤.
- ì´í›„ dataì— data={chartData.chartData}ë¡œ ë¯¸ë¦¬ ì •ë¦¬ëœ í‚¤, ê°’, ë””ìì¸ì„ í•œë²ˆì— ë„˜ê²¨ì„œ ê³µí†µ ë””ìì¸ ì²˜ë¦¬ì™€ ì˜µì…˜ì²˜ë¦¬ë§Œ ì¶”ê°€ë¡œ í•˜ê³  ë°©ë¬¸ìë¥¼ ë„ìš°ëŠ” ê²ƒì´ë‹¤.
- ë°ì´í„°ë¥¼ ë°›ëŠ” ê³¼ì •ì€ fetchí—¬í¼ì™€ reduxí—¬í¼ë¥¼ ì´ìš©í•´ chunkì™€ ì•¡ì…˜í•¨ìˆ˜ë“¤ì„ ë¯¸ë¦¬ ì„¤ì •í•´ë‘ê³  ë¯¸ë¦¬ ì§€ì •í•´ë‘” ìƒíƒœê°’ì— ë§ì¶°ì„œ ë°±ì—”ë“œì—ì„œ ë°ì´í„°ë¥¼ ë³´ë‚¸ë‹¤.
- ë“œë¡­ë‹¤ìš´ ì˜µì…˜ì€ ì¼ë°˜ context Apië¥¼ í†µí•´ ê´€ë¦¬í•˜ë©´ ëœë‹¤.
```js
import React, { memo, useCallback, useEffect, useMemo, useState } from "react";
import styled from "styled-components";
import { useDispatch, useSelector } from "react-redux";
import Spinner from "../components/Spinner";
import { getVisitorCount } from "../slices/VisitorCountSlice";

import {
  Chart,
  CategoryScale,
  LinearScale,
  Title,
  Tooltip,
  Legend,
  BarElement,
} from 'chart.js';

import { Bar } from 'react-chartjs-2';

// Chart.jsì—ì„œ importí•œ Chartì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ import ìš”ì†Œë“¤ì„ ë“±ë¡í•œë‹¤.
Chart.register(CategoryScale, LinearScale, Title, Tooltip, Legend, BarElement);

const VisitorCountChartContainer = styled.div`
  padding: 20px;
  flex: 1 1 calc(50% - 20px);
  min-height: 400px;
  height: 100%;
`;

const ChartContainer = styled.div`
  height: 300px;
  width: 100%;
`;

const ChartHeader = styled.div`
  display: flex;
  gap: 20px;
  align-items: center;
  margin-bottom: 20px;
`;

const ChartTitle = styled.h2`
  margin: 0;
`;

const StatsSelect = styled.select`
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background-color: white;
  font-size: 14px;
  cursor: pointer;

  &:focus {
    outline: none;
    border-color: #007bff;
  }
`;

const VisitorCountChart = memo(() => {
  const { loading, status, message, item } = useSelector((state) => state.VisitorCountSlice);
  
  const dispatch = useDispatch();
  
  // í†µê³„ íƒ€ì… ìƒíƒœ - ê¸°ë³¸ê°’ì„ dailyë¡œ ë³€ê²½
  const [statsType, setStatsType] = useState('daily');

  useEffect(() => {
    dispatch(getVisitorCount());
  }, [dispatch]);

  // ì„ íƒëœ í†µê³„ íƒ€ì…ì— ë”°ë¼ ì°¨íŠ¸ ë°ì´í„° ìƒì„±
  const chartData = useMemo(() => {
    if (!item) return null;

    let data, title, backgroundColor, borderColor;

    switch (statsType) {
      case 'daily':
        data = item.dailyStats;
        title = "ìµœê·¼ 7ì¼ ë°©ë¬¸ì í†µê³„";
        backgroundColor = "rgba(75, 192, 192, 0.5)";
        borderColor = "rgba(75, 192, 192, 1)";
        break;
      case 'monthly':
        data = item.monthlyStats;
        title = "ì›”ë³„ ë°©ë¬¸ì í†µê³„ (ìµœê·¼ 1ë…„)";
        backgroundColor = "rgba(54, 162, 235, 0.5)";
        borderColor = "rgba(54, 162, 235, 1)";
        break;
      case 'yearly':
        data = item.yearlyStats;
        title = "ì—°ë³„ ë°©ë¬¸ì í†µê³„";
        backgroundColor = "rgba(255, 99, 132, 0.5)";
        borderColor = "rgba(255, 99, 132, 1)";
        break;
      default:
        return null;
    }

    if (!data) return null;

    const keys = Object.keys(data);
    const values = Object.values(data);

    return {
      chartData: {
        labels: keys,
        datasets: [
          {
            label: "ë°©ë¬¸ì ìˆ˜",
            data: values,
            backgroundColor: backgroundColor,
            borderColor: borderColor,
            borderWidth: 1,
          },
        ],
      },
      title: title
    };
  }, [item, statsType]);

  const handleStatsTypeChange = useCallback((e) => {
    setStatsType(e.target.value);
  }, []);

  return (
    <VisitorCountChartContainer>
      <ChartHeader>
        <ChartTitle>ë°©ë¬¸ììˆ˜</ChartTitle>          
        <StatsSelect value={statsType} onChange={handleStatsTypeChange}>
          <option value="daily">ìµœê·¼ 7ì¼</option>
          <option value="monthly">ì›”ë³„</option>
          <option value="yearly">ì—°ë³„</option>
        </StatsSelect>
      </ChartHeader>
      <Spinner loading={loading} />

      {chartData && (
        <ChartContainer>
          <Bar
            data={chartData.chartData}
            options={{
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "bottom",
                },
                title: {
                  display: true,
                  text: chartData.title,
                  font: {
                    size: 18,
                    color: "#000",
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    stepSize: 1,
                  },
                },
              },
            }}
          />
        </ChartContainer>
      )}
    </VisitorCountChartContainer>
  );
});

export default VisitorCountChart;
```
- ì•„ë˜ëŠ” í”„ë¡ íŠ¸ì˜ ë°›ëŠ” ì²­í¬ì™€ ìŠ¬ë¼ì´ìŠ¤ ë“±ë¡ë¡œì§ì´ê³  ê·¸ ì•„ë˜ëŠ” ë°±ì—”ë“œì—ì„œ ìš”ì²­ì„ ë°›ëŠ” ë¡œì§ì´ë‹¤.
- ìš”ì²­ì€ ë¸Œë¼ìš°ì €ì—ì„œ í”„ë¡ íŠ¸ë¡œ localhost:3000ìœ¼ë¡œ ë³´ë‚´ì§€ë§Œ í”„ë¡ íŠ¸ì—ì„œ ì´ ìš”ì²­ì„ í”„ë¡ì‹œë¥¼ í†µí•´ localhost:8080ìœ¼ë¡œ í† ìŠ¤í•œë‹¤.
```js
import reduxHelper from '../helpers/ReduxHelper';

const API_URL = '/api/visitor/count';

export const getVisitorCount = reduxHelper.get("VisitorCountSlice/getVisitorCount", API_URL);

const VisitorCountSlice = reduxHelper.getDefaultSlice("VisitorCountSlice", [getVisitorCount]);

export default VisitorCountSlice.reducer;
```
```java
@RestController
@RequestMapping("/api/visitor")
@Slf4j
@RequiredArgsConstructor
public class VisitorRestController {

    private final VisitorService visitorService;
    private final RestHelper restHelper;

    @GetMapping("/count")
    public Map<String, Object> getVisitorCount() {
        VisitorStatsDto data = visitorService.getVisitorStats();
        return restHelper.sendJson(data);
    }
}
```