# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡ ì½”ë”© í”„ë¡œì íŠ¸
### ğŸ“Œ 0-1. application propiertiesì—ì„œ í•œê¸€ ì¸ì½”ë”©
- application.properties íŒŒì¼ì—ì„œ í•œê¸€ì„ ì‚¬ìš©í•  ë•ŒëŠ” ìœ ë‹ˆì½”ë“œë¡œ ì¸ì½”ë”©í•´ì•¼í•œë‹¤.
- application.properties íŒŒì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ISO-8859-1 ì¸ì½”ë”©ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
```java
payment.order.name=\ud074\ub860\ubcf4\uc2a4\uc0c1\ud488\uc8fc\ubb38
```

### ğŸ“Œ 0-2. ì•„ì„í¬íŠ¸ ê²°ì œì‹œ ë¯¼ê°ì •ë³´ëŠ” ë”°ë¡œ ë°±ì—”ë“œì—ì„œ ajaxë¡œ ë°›ì•„ì„œ ì‚¬ìš©í•˜ê¸°
- ê¸°ì¡´ì— ë°±ì—”ë“œë§Œ ê°€ì§€ê³  ìˆì–´ì•¼í•  ê°€ë§¹ì  í‚¤ ê°™ì€ ê²°ì œ ê´€ë ¨ ì •ë³´ë“¤ì„ htmlì— datasetìœ¼ë¡œ ë°›ì•„ë‘ê³  í´ë¦­ì´ë²¤íŠ¸ë¡œ ê°€ì ¸ë‹¤ ì“°ëŠ” ë°©ë²•ì„ ì‚¬ìš©í–ˆëŠ”ë° ì´ëŠ” ê°œë°œìë„êµ¬ì—ì„œ ì •ë³´ê°€ ì „ë¶€ ë…¸ì¶œë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.
- í•˜ì—¬ ì •ë³´ë¥¼ ìš”ì²­í•˜ëŠ” ajaxë¥¼ í•œë²ˆ ì¶”ê°€ë¡œ ìš”ì²­í•˜ì—¬ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§í•˜ì˜€ë‹¤.
- const configResponse = await fetch(`/api/payment/config?orderNumber=${orderNumber}&provider=${provider}`); ì´ë¥¼ í†µí•´ pgì‚¬ ì½”ë“œë„ ì¡°ê±´ ë¶„ê¸° í•˜ì§€ì•Šê³  ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¤ê³  ì—¬ê¸°ì„œ ë¯¼ê°ì •ë³´ë¥¼ ë°›ì•„ì˜¤ë¯€ë¡œì„œ í™”ë©´ì— í•´ë‹¹ ì •ë³´ë“¤ì„ ë…¸ì¶œì‹œí‚¤ì§€ ì•Šì•„ë„ ë˜ê²Œ ë˜ì—ˆë‹¤.
- configData.data.pgProviderì²˜ëŸ¼ ë°±ì—”ë“œì—ì„œ ajaxë¡œ ë°›ì•„ì˜¨ ì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.
- ì›ë˜ ëª¨ë“  ì‘ì—…ì„ ë°±ì—”ë“œì—ì„œ í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ ê²°ì œì°½ì„ ë„ìš°ëŠ” ì‘ì—…ì„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í•˜ëŠ”ê²Œ ë³´ì•ˆê´€ë ¨ ë¸Œë¼ìš°ì € ì •ì±…ì— ë§ë‹¤ê³ í•˜ì—¬ ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì„ íƒí•˜ì˜€ë‹¤.
```js
// í† ìŠ¤í˜ì´ ì—¬ë¶€ í™•ì¸
            const isTossPay = paymentMethod.value === 'í† ìŠ¤í˜ì´';
            const provider = isTossPay ? 'tosspay' : '';
            
            // ë°±ì—”ë“œì—ì„œ ê²°ì œ ì„¤ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const configResponse = await fetch(`/api/payment/config?provider=${provider}`);
            const configData = await configResponse.json();
            
            if (!configData.success) {
                alert(configData.message);
                return;
            }
            
            // ì•„ì„í¬íŠ¸ ì´ˆê¸°í™”
            const IMP = window.IMP;
            IMP.init(configData.data.iamportCode); // ë°±ì—”ë“œì—ì„œ ë°›ì€ ê°€ë§¹ì  ì‹ë³„ì½”ë“œ ì‚¬ìš©
            
            // ì´ ê²°ì œ ê¸ˆì•¡ ê°€ì ¸ì˜¤ê¸° (HTML data ì†ì„±ì—ì„œ)
            const totalAmount = parseInt(paymentButton.dataset.totalAmount);
            
            // ê²°ì œ ìš”ì²­
            IMP.request_pay({
                pg: configData.data.pgProvider, // ë°±ì—”ë“œì—ì„œ ë°›ì€ PG ì œê³µì ì‚¬ìš©
                pay_method: pgMethod,
                merchant_uid: orderNumber, // ì£¼ë¬¸ë²ˆí˜¸ë¥¼ merchant_uidë¡œ ì‚¬ìš©
                name: configData.data.orderName, // ë°±ì—”ë“œì—ì„œ ë°›ì€ ê²°ì œëª… ì‚¬ìš©
                amount: totalAmount, // HTML data ì†ì„±ì—ì„œ ê°€ì ¸ì˜¨ ì´ ê¸ˆì•¡ ì‚¬ìš©
                buyer_email: ordererEmailEl ? ordererEmailEl.value : '',
                buyer_name: receiverNameEl.value,
                buyer_tel: receiverPhoneEl.value,
                buyer_addr: addressEl.value + ' ' + detailAddressEl.value,
                buyer_postcode: postcodeEl.value
            }, async function(paymentResponse) {
                if (paymentResponse.success) {                 
                    // ì„œë²„ì— ê²°ì œ ì™„ë£Œ ì •ë³´ ì „ì†¡ 
                    await completePayment(orderNumber, deliveryMemo, paymentMethod.value, paymentResponse);
                } else {
                    // ê²°ì œ ì‹¤íŒ¨
                    alert('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\n' + paymentResponse.error_msg);
                }
            });        } catch (error) {
            alert('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
```
- ì•„ë˜ëŠ” ë¯¼ê°ì •ë³´ ê´€ë ¨í•œ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ì´ë‹¤.
- ì¡°ê±´ì— ë§ì¶°ì„œ ê²°ì œ ê´€ë ¨ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.
```java
/**
     * ê²°ì œ ì„¤ì • ì •ë³´ë¥¼ ì œê³µ
     * @param provider PG ì œê³µìê°€ í† ìŠ¤í˜ì´ì¸ì§€ ì•„ë‹Œì§€
     * @return ê²°ì œ ì„¤ì • ì •ë³´
     * @throws Exception
     */
    @GetMapping("/api/payment/config")
    public ResponseEntity<ResponseDTO> getPaymentConfig(
        @RequestParam(required = false) String provider) throws Exception {

            Map<String, Object> config = new HashMap<>();

            // ì•„ì„í¬íŠ¸ ì„¤ì • ì •ë³´
            config.put("iamportCode", iamportMerchantCode); // ì•„ì„í¬íŠ¸ ê°€ë§¹ì  ì½”ë“œ
            config.put("orderName", paymentOrderName); // ì£¼ë¬¸ ì´ë¦„            
            
            // PG ì œê³µì ì„¤ì •
            if ("tosspay".equals(provider)) {
                config.put("pgProvider", tossPayPgProvider);
            } else {
                config.put("pgProvider", defaultPgProvider);
            }
            
            config.put("success", true);

            ResponseDTO response = ResponseDTO.builder()
                    .success(true)
                    .data(config)
                    .timestamp(LocalDateTime.now())
                    .build();

            return ResponseEntity.ok(response);
        }
```
