# 📌 1. 데이터 전처리
### 1-1. 범주형 변수 축소
- 우선 빈도를 계산하여 확률화된 series를 반환한다.
- .map(freq)는 각 행의 weather 값에 대응되는 확률을 freq에서 찾아서 붙인다.
- 결과적으로 prob_columns는 원래 weather 컬럼과 같은 길이의 확률 열이 된다.
- mask(조건, 대체값)은 조건이 True인 위치를 대체값으로 치환한다.
- 테스트 케이스를 처리한 경우는
- np.where(조건, 참일 때 값, 거짓일 때 값) 구조이다.
- test_bike['weather'].isin([4])는 weather가 4인 경우만 True이다.
- True이면 'other', 아니면 원래 값을 유지한다.
- 즉, 테스트셋에서 값이 4인 것만 'other'로 치환한다.
```py
freq = train_bike['weather'].value_counts(normalize=True)
prob_columns = train_bike['weather'].map(freq)
train_bike['weather'] = train_bike['weather'].mask(prob_columns < 0.1, 'other')
test_bike['weather'] = np.where(test_bike['weather'].isin([4]), 'other', test_bike['weather'])
```

### 1-2. 변수변환 및 스케일링 (box-cox와 yeo-johnson 변환)
#### (1). 변환이란 무엇인가?

데이터 분석에서 **변환(transformation)**은 데이터의 분포를 바꿔서 모델링이 더 잘 되도록 만드는 과정이다.  
특히 **비대칭적인 분포(한쪽으로 치우친 모양)**나 **이분산성(값이 커질수록 분산도 커지는 문제)**이 있으면 회귀나 통계 모델의 가정(정규성, 등분산성)이 깨지기 때문에 이를 해결하기 위해 변환을 적용한다.

---

#### (2). Box-Cox 변환

##### 정의  
(단, 입력값 $x > 0$이어야 한다.)

- $λ ≠ 0$ 일 때:  
  $$T(x; λ) = \dfrac{x^{λ} - 1}{λ}$$

- $λ = 0$ 일 때:  
  $$T(x; 0) = \log(x)$$

##### 특징 및 의미
- **양수 데이터 전용**이다.  
- $λ$ 값에 따라 변환 강도가 달라진다.  
  - $λ = 1$: 거의 변화 없음  
  - $λ = 0.5$: 제곱근 변환  
  - $λ = 0$: 로그 변환  
  - $λ = -1$: 역수 변환  
- 데이터의 **꼬리를 줄이고(비대칭 완화)**, **분산을 안정화**하여 선형 회귀나 ANOVA 등에서 성능을 높일 수 있다.

---

#### (3). Yeo-Johnson 변환

##### 정의  
(입력값 $x$는 음수, 0, 양수 모두 가능하다.)

- $x ≥ 0$, $λ ≠ 0$:  
  $$T(x; λ) = \dfrac{(x + 1)^{λ} - 1}{λ}$$

- $x ≥ 0$, $λ = 0$:  
  $$T(x; 0) = \log(x + 1)$$

- $x < 0$, $λ ≠ 2$:  
  $$T(x; λ) = -\dfrac{(-x + 1)^{2 - λ} - 1}{2 - λ}$$

- $x < 0$, $λ = 2$:  
  $$T(x; 2) = -\log(-x + 1)$$

##### 특징 및 의미
- **음수나 0도 변환 가능**하다.  
- 데이터의 부호(양수/음수)에 따라 다른 식을 적용해 자연스럽게 변환한다.  
- Box-Cox보다 더 **범용적**이며, 실제 데이터 분석에서 자주 사용된다.

---

#### (4). λ(람다)의 의미

- 변환의 **강도와 형태를 조절하는 값**이다.  
- 모델이 더 잘 작동하도록 **최대우도추정(MLE)** 방법으로 자동으로 찾는 경우가 많다.  
- $λ$ 값의 선택에 따라 데이터의 분포가 달라진다.

---

#### (5). Box-Cox vs Yeo-Johnson 비교

| 항목 | Box-Cox | Yeo-Johnson |
|------|--------|--------------|
| 적용 가능한 값 | $x > 0$ (양수만) | $x$ 모든 실수 (음수 포함) |
| 변환 방식 | 단순 파워 변환 | 부호에 따라 다르게 적용 |
| 대표 사용 상황 | 양수 데이터만 있을 때 | 음수, 0 포함된 데이터 |
| 장점 | 간단하고 빠름 | 범용성 높고 안정적 |
| 단점 | 0 이하 값 변환 불가 | 수식이 조금 복잡함 |

---

#### (6). 언제 사용하는가?

- **Box-Cox**: 모든 데이터가 양수이고, 간단하고 빠르게(실시간 대용량 처리) 변환하고 싶을 때  
- **Yeo-Johnson**: 데이터에 음수나 0이 포함되어 있거나 보다 일반적인 상황에서  

---

#### (7). 직관적인 이해

- **Box-Cox**: 데이터가 오른쪽으로 쏠려 있을 때, 제곱·로그 등으로 살짝 눌러서 정규분포에 가깝게 만든다.  
- **Yeo-Johnson**: 데이터에 음수가 있어도 알아서 방향을 나눠 눌러주며, 전체적으로 더 자연스러운 모양을 만든다.

---

#### (8) 예시
- 람다값은 PowerTransformer 모델에서 **최대우도추정(MLE)** 방법으로 자동으로 찾는다.
```py
from sklearn.preprocessing import PowerTransformer
import warnings
import matplotlib.pyplot as plt
np.warnings = warnings

bike_data = pd.read_csv('https://raw.githubusercontent.com/YoungjinBD/data/main/bike_train.csv')
bike_data['count'].hist()
plt.show()

# 변환 후 확인
box_tr = PowerTransformer(method = 'box-cox') # yeo-johnson(요 존슨)이 default
bike_data['count'] = box_tr.fit_transform(bike_data[['count']])
bike_data['count'].hist()
plt.show()
```