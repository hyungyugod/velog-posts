# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡ ì½”ë”© í”„ë¡œì íŠ¸
### ğŸ“Œ 0-1. ë¡œê·¸ì¸ ì„¸ì…˜ ì¸í„°ì…‰í„° êµ¬í˜„
- HttpSession session = request.getSession(false); ëŠ” ë§Œì•½ì— ë‚´ë¶€ ê°’ì´ trueì´ë©´ ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±í•˜ê³  falseì´ë©´ ì—†ì„ ê²½ìš° nullì„ ë°˜í™˜í•œë‹¤.
- handlerëŠ” ìŠ¤í”„ë§ MVCì—ì„œ í˜„ì¬ ìš”ì²­ì„ ì²˜ë¦¬í•  ì»¨íŠ¸ë¡¤ëŸ¬, í•¸ë“¤ëŸ¬ ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤. 
- ì´ë•Œ ì´ í•¸ë“¤ëŸ¬ê°€ ë©”ì„œë“œ(ì¦‰, ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œ) í˜•íƒœë¡œ ë§µí•‘ëœ ê²½ìš°ì—ë§Œ HandlerMethod íƒ€ì…ì´ ë˜ë©° ì˜ˆë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ @GetMapping, @PostMapping ë“±ìœ¼ë¡œ ì •ì˜í•œ ë©”ì„œë“œë¡œ ì—°ê²°ëœ ìš”ì²­ì¸ ê²½ìš°ì— ê·¸ëŸ¬í•˜ë‹¤.
- HandlerMethod handlerMethod = (HandlerMethod) handler;ì—ì„œ ìœ„ì˜ ê²€ì‚¬ê°€ trueì¼ë•Œ í˜•ë³€í™˜í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë©”ì„œë“œ ì •ë³´ë¥¼ ë” ìƒì„¸í•˜ê²Œ ë‹¤ë£° ìˆ˜ ìˆê²Œ í•œë‹¤.
- handlerMethod.getBeanType() : ì´ ë©”ì„œë“œëŠ” ì´ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ)ê°€ ì†í•œ í´ë˜ìŠ¤(ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤) íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.
- isAnnotationPresent(RestController.class) : getBeanType()ìœ¼ë¡œ ë°›ì€ í´ë˜ìŠ¤ê°€ @RestController ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
- objectMapper.writeValueAsString(errorResponse); : ìë°”ê°ì²´ë¥¼ jsonìœ¼ë¡œ ë³€í™˜í•œë‹¤. responsebodyê°™ì€ê²Œ ì—†ì–´ì„œ ì´ê±¸ ì‚¬ìš©í•´ì•¼í•¨.
- response.getWriter().flush(); : ë²„í¼ì— ìŒ“ì—¬ìˆëŠ” ì¶œë ¥ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë‚´ë³´ë‚¸ë‹¤.
```java
@Component
@Slf4j
@RequiredArgsConstructor
public class LoginCheckInterceptor implements HandlerInterceptor {

    private final ObjectMapper objectMapper;

    @Override
    public boolean preHandle(HttpServletRequest request,
                                HttpServletResponse response,
                                Object handler) throws Exception {

        // ì„¸ì…˜ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸
        HttpSession session = request.getSession(false);
        if (session == null || session.getAttribute("memberInfo") == null) {

            // ì›ë˜ ìš”ì²­ ì£¼ì†Œ ì €ì¥ (ë¡œê·¸ì¸ í›„ ëŒì•„ê°ˆ url)
            String requestURI = request.getRequestURI();
            String queryString = request.getQueryString();
            String returnUrl = requestURI + (queryString != null && !queryString.isEmpty() ? "?" + queryString : "");

            // rest api ìš”ì²­ì¸ì§€ í™•ì¸ -> @RestController ë˜ëŠ” @ResponseBody ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
            boolean isRestApi = false;
            if (handler instanceof HandlerMethod) {
                HandlerMethod handlerMethod = (HandlerMethod) handler;
                if (handlerMethod.getBeanType().isAnnotationPresent(RestController.class)) {
                    isRestApi = true;
                }
            }

            // ë§Œì•½ rest api ìš”ì²­ì´ë¼ë©´ - ResponseDTO êµ¬ì¡°ë¡œ ë°˜í™˜í•œë‹¤.
            if (isRestApi) {
                response.setStatus(HttpStatus.UNAUTHORIZED.value());
                response.setContentType("application/json;charset=UTF-8");

                Map<String, Object> data = new HashMap<>();
                data.put("redirectUrl", "/login?returnUrl=" + URLEncoder.encode(returnUrl, "UTF-8"));

                ResponseDTO errorResponse = ResponseDTO.builder()
                        .status(HttpStatus.UNAUTHORIZED.value())
                        .success(false)
                        .message("ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.")
                        .error(HttpStatus.UNAUTHORIZED.getReasonPhrase())
                        .timestamp(LocalDateTime.now())
                        .data(data)
                        .build();

                String json = objectMapper.writeValueAsString(errorResponse);
                response.getWriter().write(json);
                response.getWriter().flush();
                return false;

            } else {
                // ë¸Œë¼ìš°ì €ê°€ ajaxë¡œ ìš”ì²­í•˜ì§€ ì•Šê³  ì§ì ‘ ì ‘ê·¼í•œ ê²½ìš°
                response.sendRedirect("/login?returnUrl=" + URLEncoder.encode(returnUrl, "UTF-8"));
                return false;
            }
        }

        // ë¡œê·¸ì¸ ì •ë³´ ìˆìœ¼ë©´ í†µê³¼
        return true;
    }
}
```
- mywebconfig ë‚´ë¶€ interceptorì„¤ì •
- .excludePathPatternsë¥¼ í†µí•´ì„œ ë¡œê·¸ì¸ì„ ì•ˆí•´ë„ ì ‘ì†ì„ í—ˆìš©í•  í˜ì´ì§€ë¥¼ ì§€ì •í•´ì¤€ë‹¤.
```java
@Override
    public void addInterceptors(InterceptorRegistry registry) {
        // ì§ì ‘ ì •ì˜í•œ MyInterceptorë¥¼ Springì— ë“±ë¡
        registry.addInterceptor(myInterceptor)
                .excludePathPatterns("/error", "/robots.txt", "/favicon.ico", "/assets/**");

        // ë¡œê·¸ì¸ ì²´í¬ ì¸í„°ì…‰í„° ë“±ë¡
        registry.addInterceptor(loginCheckInterceptor)
                .addPathPatterns("/**")
                .excludePathPatterns(
                    "/",
                    "/login/**",
                    "/api/login/**",
                    "/api/find-id",
                    "/api/find-pw/**",
                    "/api/reset-pw/**",
                    "/join/**",
                    "/api/join/**",
                    "/productsinfo/**",
                    "/headphones/**",
                    "/earbuds/**",
                    "/speakers/**",
                    "/soundbars/**",
                    "/professionals/**",
                    "/main-search/**",
                    "/notice/**",
                    "/store/**",
                    "/service_center/**",
                    "/introduction/**",
                    "/history/**",
                    "/bose_esg/**",
                    "/main/**",
                    "/assets/**",
                    "/css/**",
                    "/js/**",
                    "/images/**", 
                    "/products_images/**",
                    "/error/**",
                    "/favicon.ico",
                    "/robots.txt"
                );
    }
```

### ğŸ“Œ 0-2. ë…¼ë¦¬ì‚­ì œ -> ë¬¼ë¦¬ì‚­ì œ ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„
- ê¸°ì¡´ updateë¡œì§ì—ì„œ mapperë§Œ ìˆ˜ì •í•˜ë©´ ë¼ì„œ í¸ë¦¬í•˜ì˜€ë‹¤. 
- ë…¼ë¦¬ì‚­ì œëŠ” is_deleteê°™ì€ ì»¬ëŸ¼ì„ ë‘ê³  ì‹¤ì œ ë¬¼ë¦¬ì ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì´ë¥¼ is_deleteë¥¼ falseë¡œë§Œ ë§Œë“œëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.
- ì´ëŠ” ë¹ˆë²ˆí•œ ì‚­ì œê°€ ë²Œì–´ì§€ëŠ” ëŒ€ìƒì„ í•œë²ˆì— ìŠ¤ì¼€ì¤„ë§í•˜ì—¬ ì‚­ì œí•˜ë¯€ë¡œì„œ ì›ë˜ ë°œìƒí–ˆë˜ db ì €ì¥ì†Œ ì‚­ì œ ë¶€í•˜ë¥¼ ì¤„ì´ëŠ” íš¨ê³¼ë¥¼ ì¤€ë‹¤.
- ìš°ì„  mapperì— ê°ê° is_delete = TRUEì´ë©´ì„œ ì‚­ì œ ì¼ìê°€ ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ì„¤ì •í•  ì‹œê°„ ë³´ë‹¤ ì ì€ ì»¬ëŸ¼(ìˆ˜ì •í•œ ë‚ ì§œë¶€í„° ì¼ì • ì‹œê°„ì´ ì§€ë‚œ)ë“¤ë§Œ ì¼ê´„ì‚­ì œí•˜ëŠ” ë©”ì„œë“œë¥¼ ê°ê° ë§Œë“ ë‹¤.
```java
@Update("""
    DELETE FROM carts
    WHERE is_delete = TRUE
      AND edit_date < #{deleteBeforeDate}
""")
int cleanupDeletedCarts(@Param("deleteBeforeDate") String deleteBeforeDate);

@Update("""
    DELETE FROM wishlists
    WHERE is_delete = TRUE
      AND edit_date < #{deleteBeforeDate}
""")
int cleanupDeletedWishlists(@Param("deleteBeforeDate") String deleteBeforeDate);
```
- ì´í›„ ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ì‹œê°„ì„ ì„¤ì •í•˜ê³  í•´ë‹¹ mapperë“¤ì„ ìˆœì„œëŒ€ë¡œ í˜¸ì¶œí•œë‹¤.
- LocalDateTime threshold = LocalDateTime.now().minusMinutes(30); : í˜„ì¬ ì‹œê°„ - 30 ìœ¼ë¡œ ì ì–´ë„ 30ë¶„ì€ ì§€ë‚¬ìŒì„ ë³´ì¥í•´ì¤€ë‹¤.
- String deleteBeforeDate = threshold.format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")); : ì´ë¥¼ í†µí•´ dbì— ì €ì¥ëœ ì‹œê°„ í¬ë©§ì— ë§ì¶°ì¤€ë‹¤.
- @Scheduled(cron = "0 0,30 * * * *") ë¡œ "ì´ˆ ë¶„ ì‹œ ì¼ ì›” ìš”ì¼" ì´ë ‡ê²Œ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë° *ì€ ëª¨ë“  ê°’ìœ¼ë¡œ êµ³ì´ ì§€ì •í•˜ì§€ ì•Šì€ ëª¨ë“  ê°’ì„ ì˜ë¯¸í•œë‹¤. ì¦‰ *ì´ ì•„ë‹Œ ì§€ì •ëœ ì‹œê°„ë§Œ ë³´ë©´ ëœë‹¤. 
```java
@Slf4j
@Component
@RequiredArgsConstructor
public class CleanupScheduler {

    private final CartMapper cartMapper;
    private final WishlistMapper wishlistMapper;

    @Scheduled(cron = "0 0,30 * * * *")// ë§¤ ì‹œê°„ 0ë¶„, 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
    public void cleanupDeletedData() {

        LocalDateTime threshold = LocalDateTime.now().minusMinutes(30); // 30ë¶„ ì´ì „ì˜ ë°ì´í„° ì‚­ì œ
        String deleteBeforeDate = threshold.format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));

        int deletedCarts = cartMapper.cleanupDeletedCarts(deleteBeforeDate);
        int deletedWishlists = wishlistMapper.cleanupDeletedWishlists(deleteBeforeDate);

        log.info("[CleanupScheduler] 3ì‹œê°„ ê²½ê³¼ ë…¼ë¦¬ì‚­ì œ cart: {}ê±´, wishlist: {}ê±´ ë¬¼ë¦¬ì‚­ì œ ì™„ë£Œ (ê¸°ì¤€ì¼: {})",
                deletedCarts, deletedWishlists, deleteBeforeDate);
    }
}
```

### ğŸ“Œ 0-3. ë°±ê·¸ë¼ìš´ë“œ ì´ë¯¸ì§€ ì› ê°€ìš´ë°ë¡œ ì˜¤ê¸°
- background-position: center;ë¥¼ í†µí•´ background imageë¥¼ ê°€ìš´ë°ë¡œ ë°°ì¹˜í•  ìˆ˜ ìˆë‹¤.
```css
#profile-img {
    width: 120px;
    height: 120px;
    background-size: cover;
    background-position: center;
    border-radius: 50%;
    
    &:hover {
        cursor: pointer;
    }
}
```