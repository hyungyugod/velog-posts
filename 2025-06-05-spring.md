# ğŸ“Œ 0. ëŒ€í™”
### ğŸ“Œ 0-1. ìŠ¤í”„ë§ì˜ ì‹±ê¸€í„´
- ì¼ë°˜ ì‹±ê¸€í„´ì€ jvm í”„ë¡œê·¸ë¨ ì „ì²´ì— ë”± í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ê°€ì§€ëŠ” ë°˜ë©´ ìŠ¤í”„ë§ì˜ ì‹±ê¸€í„´ì€ ì»¨í…Œì´ë„ˆ 1ê°œ ë‹¹ í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- êµ¬ì²´ì ìœ¼ë¡œ IOC ì»¨í…Œì´ë„ˆë‹¹ ê°ì²´ í•˜ë‚˜ì¸ë° IOC ì»¨í…Œì´ë„ˆë€ Bean ê°ì²´ë“¤ì„ ìƒì„±í•˜ê³ , ê´€ë¦¬í•˜ê³ , í•„ìš”í•  ë•Œ ì£¼ì…í•´ì£¼ëŠ” ìŠ¤í”„ë§ì˜ í•µì‹¬ ë°•ìŠ¤ì™€ ê°™ë‹¤.
- ì»¨í…Œì´ë„ˆë€ ApplicationContext ë‚˜ WebApplicationContext ê°™ì€ ê²ƒì„ ë§í•˜ë©° ë³´í†µì˜ ì›¹ êµ¬ì¡°ì—ì„œëŠ” ì„œë²„ í•˜ë‚˜ì— ìŠ¤í”„ë§ ì›¹ ì»¨í…Œì´ë„ˆ(Servlet ê¸°ë°˜)ê°€ í•œ ê°œ ì˜¬ë¼ê°„ë‹¤. 
- ë§Œì•½ ë³µì¡í•œ ì›¹êµ¬ì¡° ì¦‰ í•˜ë‚˜ì˜ í° ì„œë¹„ìŠ¤ê°€ ì—¬ëŸ¬ê°œì˜ ì›¹ì–´í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤ë©´ ì˜ˆë¥¼ ë“¤ì–´ ë©”ì¸ì„œë¹„ìŠ¤, ê´€ë¦¬ì í˜ì´ì§€ ë“±ì„ ë”°ë¡œ ë°°í¬í•  ê²½ìš° ì–´í”Œë¦¬ì¼€ì´ì…˜ë§ˆë‹¤ ì»¨í…Œì´ë„ˆê°€ ë”°ë¡œ ë– ì„œ ê°ê°ì— ê°™ì€ ì´ë¦„ì˜ ë¹ˆì´ ìˆì–´ë„ ì„œë¡œ ë‹¤ë¥¸ ê°ì²´ê°€ ëœë‹¤.

### ğŸ“Œ 0-2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ 
- ì»¨í…Œì´ë„ˆë€ í•œë§ˆë””ë¡œ ê°ì²´ë¥¼ ë‹´ê³  ê´€ë¦¬í•˜ëŠ” ë°•ìŠ¤ì´ë‹¤.
- ê°œë°œìê°€ ë“±ë¡í•œ í´ë˜ìŠ¤(=ë¹ˆ, Bean)ë¥¼ ì§ì ‘ ìƒì„±(new)í•˜ì§€ ì•Šê³  ìŠ¤í”„ë§ì´ ëŒ€ì‹  ë§Œë“¤ì–´ì„œ, í•„ìš”í•œ ì‹œì ì— êº¼ë‚´ì„œ ì‚¬ìš©í•˜ê²Œ í•´ì£¼ëŠ” ì €ì¥ì†Œ+ê´€ë¦¬ì ì—­í• ì„ í•œë‹¤.

```plaintext
[ì„œë²„ ì‹œì‘]
    â””â”€â”€ ApplicationContext or WebApplicationContext ìƒì„±
          â””â”€â”€ @Component, @Bean ë“±ìœ¼ë¡œ ë“±ë¡ëœ ê°ì²´(ë¹ˆ) ìƒì„±
          â””â”€â”€ í•„ìš”í•œ ê°ì²´ ë¼ë¦¬ ì—°ê²°(DI)
          â””â”€â”€ ê°ì²´ ê´€ë¦¬ ë° ì´ë²¤íŠ¸, íŠ¸ëœì­ì…˜ ë“± ì²˜ë¦¬
```
```css
[ì›¹ ì„œë²„(í†°ìº£)]
   â””â”€ [ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ]
         â””â”€ [DispatcherServlet]   â† ëª¨ë“  HTTP ìš”ì²­ì„ ë°›ìŒ
               â””â”€ [ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ(WebApplicationContext)]
                       â””â”€ [ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë ˆí¬ì§€í† ë¦¬ ë“± ë¹ˆ]

```

| ì´ë¦„                    | ì–´ë”” ì†Œì†?      | ì£¼ìš” ì—­í•                        | ì˜ˆì‹œ/ì„¤ëª…                 |
| --------------------- | ----------- | --------------------------- | --------------------- |
| **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ**          | ì›¹ ì„œë²„(í†°ìº£ ë“±)  | ì„œë¸”ë¦¿ ì‹¤í–‰, ê´€ë¦¬, ìš”ì²­-ì‘ë‹µ           | ì›¹ ì—”ì§„, Java EE, Tomcat |
| **DispatcherServlet** | ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ | ëª¨ë“  ìš”ì²­ ë°›ì•„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë¶„ë°°(í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬) | ìŠ¤í”„ë§ MVCì˜ ì¤‘ì•™ ì„œë¸”ë¦¿       |
| **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ**          | ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬   | ë¹ˆ ê´€ë¦¬, DI, ìƒëª…ì£¼ê¸° ê´€ë¦¬           | ApplicationContext ë“±  |


- ë³´í†µ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” â€œì›¹ ì—”ì§„â€, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” â€œìë°” ê°ì²´ ê´€ë¦¬ìâ€ ì´ë‹¤. ì¦‰ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” â€œìë°” ê°ì²´ ê´€ë¦¬ìâ€ ì´ë‹¤.
- ApplicationContext: ìŠ¤í”„ë§ì˜ ê°€ì¥ ê¸°ë³¸ì ì¸ ì»¨í…Œì´ë„ˆ(=ë¹ˆ íŒ©í† ë¦¬ì˜ í™•ì¥í˜•)
- WebApplicationContext: ApplicationContextì˜ í•˜ìœ„ ì¸í„°í˜ì´ìŠ¤, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œë§Œ ì‚¬ìš©
- Spring Boot ì›¹ ì•± ì‹¤í–‰ â†’ í†°ìº£ì´ DispatcherServletì„ ë§Œë“¤ë©´ì„œ WebApplicationContextë¥¼ ìë™ìœ¼ë¡œ ìƒì„±
- ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ(Servlet Container) â†’ **ì„œë¸”ë¦¿(=ìë°” ì›¹ í”„ë¡œê·¸ë¨)**ì„ ì‹¤í–‰í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´(=ì‹¤í–‰ ì—”ì§„)
- ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸(ServletContext) â†’ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜(ì›¹ í”„ë¡œì íŠ¸) ë‹¨ìœ„ì˜ ì „ì—­ ì €ì¥ì†Œ, ë¦¬ì†ŒìŠ¤ ì ‘ê·¼, ì´ˆê¸°í™” íŒŒë¼ë¯¸í„°, ê³µìš© ë°ì´í„° ì €ì¥ ë“±
```scss
[ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ]   â† í†°ìº£(ë‚´ì¥/ì™¸ì¥)
   â””â”€ [ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸]  â† ì›¹ì•± í•˜ë‚˜ë§ˆë‹¤ 1ê°œ
        â””â”€ [ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ]  â† ApplicationContext(WebAppì´ë©´ WebApplicationContext)
            â””â”€ [ê°ì¢… ë¹ˆ(Bean)]
```

- @Beanê³¼ @Component ë“± ë¹ˆ ë“±ë¡ ë°©ì‹ì˜ ì°¨ì´

|    | @Component ê³„ì—´ | @Bean         |
| -- | ------------- | ------------- |
| ë°©ì‹ | ìë™ í´ë˜ìŠ¤ ìŠ¤ìº”     | ì§ì ‘ ë“±ë¡ (ìˆ˜ë™)    |
| ëŒ€ìƒ | í´ë˜ìŠ¤(íƒ€ì…)       | ì–´ë–¤ ê°ì²´ë“  ê°€ëŠ¥     |
| ìš©ë„ | ê´€ë¡€ì— ë§ëŠ” í´ë˜ìŠ¤ ê´€ë¦¬ | ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“± ê´€ë¦¬ |
| ì¥ì  | ì½”ë“œ ê°„ê²°, ìë™í™”    | ì„¸ë¶€ ì„¤ì •, ì œì–´ ìš©ì´  |

- ë³´í†µ beanì€ ë©”ì„œë“œì— ë¶™ì—¬ì„œ ê·¸ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.
- @Component, @Bean â†’ â€œë¹ˆ ë“±ë¡â€ ì´ê³  @Autowired â†’ â€œë¹ˆ ì£¼ì…(DI)â€(ì˜ì¡´ì„± ì£¼ì…)ì´ë‹¤.

| ì—­í•            | ì–´ë…¸í…Œì´ì…˜             | ì˜ë¯¸       | ì–¸ì œ?           |
| ------------ | ----------------- | -------- | ------------- |
| **ë¹ˆ ë“±ë¡**     | @Component, @Bean | ê°ì²´ ìƒì„±+ë“±ë¡ | ê°ì²´ë¥¼ â€œì»¨í…Œì´ë„ˆì—â€   |
| **ë¹ˆ ì£¼ì…(DI)** | @Autowired        | ë¹ˆì„ ë„£ì–´ì¤Œ   | ë“±ë¡ëœ ë¹ˆì„ â€œì‚¬ìš©ìì—â€ |

- ì•„ë˜ëŠ” í•œ ì„œë²„ì— ë¶€ëª¨ìì‹ ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì´ë‹¤.
- ì•„ë˜ì˜ ê²½ìš° ì™¸ì—ë„ ë³¸ ì„œë²„ë‘ í…ŒìŠ¤íŠ¸ ì„œë²„ë¥¼ ë™ì‹œì— ëŒë¦¬ëŠ” ê²½ìš°ì—ë„ ì´ë ‡ê²Œ ê°ì²´ê°€ ë”°ë¡œ í˜•ì„±ëœë‹¤.
```scss
[Root ApplicationContext]      â† ë¶€ëª¨ ì»¨í…Œì´ë„ˆ (ê³µí†µ ë¹ˆ ê´€ë¦¬)
      â”‚
      â””â”€â”€ [WebApplicationContext]   â† ìì‹ ì»¨í…Œì´ë„ˆ (ì›¹ ì „ìš© ë¹ˆ ê´€ë¦¬)
```
```java
// ë¶€ëª¨ ì»¨í…Œì´ë„ˆ(ë£¨íŠ¸)ì— ë“±ë¡ëœ ë¹ˆ
@Configuration
public class RootConfig {
    @Bean
    public MyService myService() {
        return new MyService("Root");
    }
}

// ìì‹ ì»¨í…Œì´ë„ˆ(ì›¹)ì— ë“±ë¡ëœ ë¹ˆ (ì´ë¦„ì´ ê°™ìŒ!)
@Configuration
public class WebConfig {
    @Bean
    public MyService myService() {
        return new MyService("Web");
    }
}

// ì´ëŸ´ ë•Œ ìì‹(Web) ì»¨í…Œì´ë„ˆì—ì„œ myServiceë¥¼ êº¼ë‚´ë©´? â†’ "Web"
// ë¶€ëª¨(Root) ì»¨í…Œì´ë„ˆì—ì„œ myServiceë¥¼ êº¼ë‚´ë©´? â†’ "Root"
```

### ğŸ“Œ 0-3. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë€
- í•œ ë§ˆë””ë¡œ ì¸í„°ë„·(ì›¹ ë¸Œë¼ìš°ì €)ì—ì„œ ì ‘ì†í•´ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ì´ë‹¤. ì¦‰ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì„œ ì ‘ì†í•˜ëŠ” ì„œë¹„ìŠ¤(ì‚¬ì´íŠ¸)ëŠ” ê±°ì˜ ë‹¤ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤.
- ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜: â†’ ì»´í“¨í„°ì— ì§ì ‘ ì„¤ì¹˜í•´ì„œ ì“°ëŠ” í”„ë¡œê·¸ë¨(ì˜ˆ: í¬í† ìƒµ, í•œê¸€ ë“±)
- ëª¨ë°”ì¼ ì•±: â†’ ìŠ¤ë§ˆíŠ¸í°ì— ì„¤ì¹˜í•˜ëŠ” ì•±
- ì—¬ëŸ¬ê°œì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. 
```scss
[ì „ì²´ ì„œë¹„ìŠ¤: ì˜ˆì‹œ ì‡¼í•‘ëª°]
â”œâ”€ [ë©”ì¸ ì‚¬ìš©ì ì›¹ ì•±] (www.shop.com)
â”œâ”€ [ê´€ë¦¬ì(Admin) ì›¹ ì•±] (admin.shop.com)
â”œâ”€ [íŒë§¤ì/íŒŒíŠ¸ë„ˆ ì›¹ ì•±] (partner.shop.com)
â”œâ”€ [API ì„œë²„] (api.shop.com)
â”œâ”€ [ë°°ì¹˜ ì „ìš© ë°±ì—”ë“œ]
```
- ë§Œì•½ ì™¸ì¥ í†°ìº£ì„ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê°œì˜ ì›¹ì•± WAR íŒŒì¼ì„ í•˜ë‚˜ì˜ í†°ìº£ì´ ê´€ë¦¬í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ ì„œë¸”ë¦¿ ì»¨íƒìŠ¤íŠ¸ëŠ” ì—¬ëŸ¬ ê°œê°€ ë  ìˆ˜ ìˆê³  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë„ ë§ˆì°¬ê°€ì§€ë‹¤.

### ğŸ“Œ 0-4. ìŠ¤í”„ë§ ìŠ¤ì½”í”„
- ê¸°ë³¸ ê°’ì¸ ì‹±ê¸€í„´ì„ ì¼ì¼íˆ ë³€ê²½í•´ì¤„ ìˆ˜ ìˆë‹¤.

| ìŠ¤ì½”í”„         | ì„¤ëª…                       | ì–´ë””ì„œ?  |
| ----------- | ------------------------ | ----- |
| singleton   | ì»¨í…Œì´ë„ˆë‹¹ **í•˜ë‚˜ë§Œ** ìƒì„± (ê¸°ë³¸ê°’)   | ëª¨ë“  í™˜ê²½ |
| prototype   | ìš”ì²­í•  ë•Œë§ˆë‹¤ **ìƒˆë¡œ ìƒì„±**        | ëª¨ë“  í™˜ê²½ |
| request     | **HTTP ìš”ì²­**ë§ˆë‹¤ ìƒˆ ê°ì²´ ìƒì„±    | ì›¹ í™˜ê²½  |
| session     | **ì„¸ì…˜**ë§ˆë‹¤ ìƒˆ ê°ì²´ ìƒì„±         | ì›¹ í™˜ê²½  |
| application | **ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸**(ì›¹ì•± ì „ì²´)ë§ˆë‹¤ í•˜ë‚˜ | ì›¹ í™˜ê²½  |
| websocket   | ì›¹ì†Œì¼“ ì—°ê²°ë§ˆë‹¤ í•˜ë‚˜              | ì›¹ì†Œì¼“   |

- ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```java
@Component
@Scope("singleton")   // ì‹±ê¸€í„´(ê¸°ë³¸ê°’, ìƒëµ ê°€ëŠ¥)
public class MySingletonBean {}

@Component
@Scope("prototype")   // ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆ ê°ì²´
public class MyPrototypeBean {}

@Component
@Scope("request")     // HTTP ìš”ì²­ë§ˆë‹¤ ìƒˆ ê°ì²´ (ì›¹ í™˜ê²½ì—ì„œë§Œ)
public class MyRequestBean {}

@Component
@Scope("session")     // ì„¸ì…˜ë§ˆë‹¤ ìƒˆ ê°ì²´ (ì›¹ í™˜ê²½ì—ì„œë§Œ)
public class MySessionBean {}
```

### ğŸ“Œ 0-5. gradle ì˜ì¡´ì„± ì¹´í…Œê³ ë¦¬
- ì£¼ì†Œì— actuator/healthì—ì„œ downì´ ë‚˜ì˜¤ë©´ ì„œë²„ì— ì¥ì• ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.
- actuator(ì•¡ì¸„ì—ì´í„°) ì˜ì–´ ëœ»

| í‚¤ì›Œë“œ                     | ì–´ë””ì„œ í•„ìš”?   | ë°°í¬íŒŒì¼(JAR/WAR)ì— í¬í•¨? | ëŒ€í‘œ ìš©ë„                    |
| ----------------------- | --------- | ------------------ | ------------------------ |
| implementation          | ë©”ì¸/í…ŒìŠ¤íŠ¸ ì½”ë“œ | O                  | ì›¹, DB, ì„œë¹„ìŠ¤ ë¡œì§ ë“± ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ |
| testImplementation      | í…ŒìŠ¤íŠ¸ ì½”ë“œë§Œ   | X                  | JUnit, Mockito ë“± í…ŒìŠ¤íŠ¸ ë„êµ¬  |
| compileOnly             | ì»´íŒŒì¼ì‹œë§Œ     | X                  | ë¡¬ë³µ ë“± ì»´íŒŒì¼ìš© ì½”ë“œ ìƒì„± ë„êµ¬       |
| annotationProcessor     | ì»´íŒŒì¼ì‹œë§Œ     | X                  | ë¡¬ë³µ, MapStruct ë“± ì–´ë…¸í…Œì´ì…˜ ì²˜ë¦¬ |
| developmentOnly         | ê°œë°œ í™˜ê²½ë§Œ    | X                  | DevTools ë“± ê°œë°œ í¸ì˜ ê¸°ëŠ¥      |
| runtimeOnly             | ì‹¤í–‰ì‹œë§Œ      | O                  | DB ë“œë¼ì´ë²„ ë“± êµ¬ë™ì‹œì—ë§Œ í•„ìš”í•œ ê²ƒ    |
| testRuntimeOnly         | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì‹œì—ë§Œ | X                  | í…ŒìŠ¤íŠ¸ìš© ì‹¤í–‰ ì—”ì§„(JUnit ë“±)      |
| testAnnotationProcessor | í…ŒìŠ¤íŠ¸ ì»´íŒŒì¼ì‹œë§Œ | X                  | í…ŒìŠ¤íŠ¸ì—ì„œ ë¡¬ë³µ ë“± ì• ë…¸í…Œì´ì…˜ ì²˜ë¦¬      |
| testCompileOnly         | í…ŒìŠ¤íŠ¸ ì»´íŒŒì¼ì‹œë§Œ | X                  | í…ŒìŠ¤íŠ¸ì—ì„œë§Œ ë¡¬ë³µ ë“± ì½”ë“œ ìƒì„± ë„êµ¬     |

### ğŸ“Œ 0-6. HikariCP (íˆì¹´ë¦¬ ì»¤ë„¥ì…˜ í’€)
- **â€œHikariCPâ€**ëŠ” ìë°”ì—ì„œ DB ì—°ê²°(Connection)ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” â€œì»¤ë„¥ì…˜ í’€(Connection Pool)â€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
- íˆì¹´ë¦¬ëŠ” ì¼ë³¸ì–´ë¡œ ë¹›ì´ë¼ëŠ” ëœ»ì´ë‹¤. ì´ëŠ” ë¹›ì²˜ëŸ¼ ë¹ ë¥´ë‹¤ëŠ” ì˜ë¯¸ë¡œ ìµœì†Œí•œì˜ ìì›ìœ¼ë¡œ ìµœëŒ€ì˜ ì„±ëŠ¥ì„ ë‚¸ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
- application.propertiesì—ì„œ DB ì •ë³´ë§Œ ì ìœ¼ë©´ â†’ HikariCPê°€ ìë™ìœ¼ë¡œ â€œì»¤ë„¥ì…˜ í’€â€ì„ ê´€ë¦¬í•´ì¤€ë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ SQL ìš”ì²­ -> HikariCPê°€ ë¯¸ë¦¬ DBì™€ ì—¬ëŸ¬ ê°œì˜ ì—°ê²°(Connection)ì„ ë§Œë“¤ì–´ ë‘  -> ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—°ê²°ì´ í•„ìš”í•  ë•Œ â€œí’€â€ì—ì„œ â€œì•ˆ ì“°ëŠ” ì»¤ë„¥ì…˜â€ í•˜ë‚˜ë¥¼ â€œë¹Œë ¤ê°â€ -> ì‘ì—…ì´ ëë‚˜ë©´ ë°˜ë‚©í•¨
- DB ì—°ê²°ì„ ê³„ì† â€œìƒì„±/í•´ì œâ€í•˜ì§€ ì•Šê³ , ë¯¸ë¦¬ ë§Œë“¤ì–´ë†“ê³  â€œë¹Œë ¤ì£¼ê³ , ë°˜ë‚©ë°›ê³ â€ë¥¼ ë°˜ë³µí•œë‹¤.
```scss
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Applicationâ”‚   (Spring, MyBatis, JPA, JDBC ë“±)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            HikariCP Pool              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [ Connection1 ]   â† ì‚¬ìš© ì¤‘           â”‚
â”‚  [ Connection2 ]   â† ì‚¬ìš© ì¤‘           â”‚
â”‚  [ Connection3 ]   â† "ë°˜ë‚©ë¨"(ëŒ€ê¸°)    â”‚
â”‚  [ Connection4 ]   â† "ë°˜ë‚©ë¨"(ëŒ€ê¸°)    â”‚
â”‚  [ Connection5 ]   â† "ë°˜ë‚©ë¨"(ëŒ€ê¸°)    â”‚
â”‚          ...                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Database Server  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- spring-boot-starter-jdbc ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ìë™ í¬í•¨ë˜ì–´ ìˆëŠ” com.zaxxer:HikariCP ì´ë¼ëŠ” ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
- êµ¬ì²´ì ìœ¼ë¡œ HikariCPëŠ” ì´ˆê¸°í™” ì‹œì ì— ë¯¸ë¦¬ DB ì—°ê²°(ì»¤ë„¥ì…˜) ê°ì²´ë¥¼ ì—¬ëŸ¬ ê°œ ë§Œë“¤ì–´ë‘”ë‹¤. (ê¸°ë³¸ê°’ 10ê°œ, ì„¤ì •ì— ë”°ë¼ ì¡°ì ˆ ê°€ëŠ¥)
- ì´ â€œì»¤ë„¥ì…˜ í’€â€ì€ â€œìë°” ì»¬ë ‰ì…˜(Queue, ConcurrentBag)â€ ê°™ì€ ìë£Œêµ¬ì¡°ë¡œ ê´€ë¦¬í•œë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB ì‘ì—…ì´ í•„ìš”í•  ë•Œ HikariDataSource.getConnection()ì„ í˜¸ì¶œí•œë‹¤.
- ì´í›„ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ëª¨ì•„ë‘” Queue/Bag ìë£Œêµ¬ì¡°ì—ì„œ â€œëŒ€ê¸° ì¤‘â€ì¸ ì»¤ë„¥ì…˜ popí•œë‹¤.
- ì´í›„ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œ í›„ì— Queue/Bag ìë£Œêµ¬ì¡°ì— push
```css
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Application   â”‚â—€â”€â”€â”€â”€â”€â”€â–¶ â”‚ HikariCP Pool           â”‚â—€â”€â”€ DB ì—°ê²°
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ [conn1][conn2][conn3]   â”‚
           â–²  ë¹Œë ¤ê°         â”‚ [conn4]...[connN]       â”‚
           â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€ ë°˜ë‚© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ì •í™•íˆëŠ” ë‚´ë¶€ ìë£Œêµ¬ì¡°ë¡œ ConcurrentBagì„ ì‚¬ìš©í•˜ëŠ”ë° ì´ëŠ” HikariCPì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³ ì„±ëŠ¥ ë™ì‹œì„± ì»¬ë ‰ì…˜(ì§ì ‘ êµ¬í˜„)ì´ë©° ì½”ë“œê°€ ë³µì¡í•˜ì§€ë§Œ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- íˆì¹´ë¦¬ê°€ ì—°ê²°ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë“œë¼ì´ë²„ í´ë˜ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ë¡œ ì˜¬ë ¤ì„œ ë“±ë¡í•´ì•¼í•œë‹¤. ì´ ë“œë¼ì´ë²„ í´ë˜ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì–´ì•¼ JDBC URLì„ í†µí•´ DBì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤.
```java
Class.forName("org.mariadb.jdbc.Driver");
```

# ğŸ“Œ 1. ë°ì´í„° ë² ì´ìŠ¤ ì—°ë™
- mybatis ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” mapperì™€ insert ë“±ì„ ì‚¬ìš©í•˜ì—¬ ì†ì‰½ê²Œ sqlë¬¸ìœ¼ë¡œ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì—ëŸ¬: jdbc, mariadb ë“œë¼ì´ë²„ ë¡œë“œì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ë° ì•„ë˜ ë‘ì¤„ì´ ë¬¸ì œì´ë‹¤. mariadbë¡œ í• ê±°ë©´ íšŒì‚¬ ì´ë¦„ì´ orgì—¬ì„œ org.ìœ¼ë¡œ ì‹œì‘í•´ì£¼ì–´ì•¼ í•œë‹¤.
- ê·¸ë¦¬ê³  mariadb ì˜ì¡´ì„±ì„ ì„¤ì¹˜í–ˆìœ¼ë©´ application.propertiesì—ë„ mariadbë¡œ ë§ì¶°ì£¼ì–´ì•¼ í•œë‹¤.
- ë˜ ì¤‘ê°„ì— cjê°€ ë“¤ì–´ê°„ ê²½ìš°ì—ë„ mysqlì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì£¼ì†Œì´ë‹¤.
- í¬íŠ¸ë²ˆí˜¸ ë“± db ë²ˆí˜¸ë„ ì˜ ë§ì¶°ì£¼ì–´ì•¼ í•œë‹¤.
```
spring.datasource.url=jdbc:mariadb://127.0.0.1:3306/myschool?characterEncoding=UTF8
spring.datasource.driver-class-name=org.mariadb.cj.jdbc.Driver
```

### ğŸ“Œ 1-1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì—ì„œ autowiredê°€ ì‘ë™í•˜ëŠ” ì´ìœ 
```scss
[ì‹¤ì œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ]
  â”œâ”€ @Service, @Repository, @Controller, ... (ë¹ˆ)
  â””â”€ (í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì—†ìŒ!)

[í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ]  â† í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œì—ë§Œ ì„ì‹œ ìƒì„±!
  â”œâ”€ ì‹¤ì œ ë¹ˆë“¤ (DI ëŒ€ìƒ)
  â””â”€ [í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤]  â† ì—¬ê¸°ì— DIë§Œ í•´ì¤Œ, ë¹ˆì€ ì•„ë‹˜
```
- ìŠ¤í”„ë§ì—ì„œ ë§ˆì´ë°”í‹°ìŠ¤ì˜ @Mapperë„ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡ í•´ì¤€ë‹¤.
- ì´ë•Œ **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì˜ í”„ë¡ì‹œ ë¹ˆ(@Mapper)**ì€ ë‚´ë¶€ì ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¡œ ë“±ë¡ë˜ê¸° ë•Œë¬¸ì— BEANS ëª©ë¡ì— ì˜ ì•ˆ ëœ¨ê±°ë‚˜, ì§€ì›ì´ ë¯¸í¡í•  ìˆ˜ ìˆë‹¤.
- ëŸ°íƒ€ì„ì— í”„ë¡ì‹œ ê°ì²´ê°€ ìƒì„±ë˜ì–´ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ê¸° ë•Œë¬¸ì— ì •ì  ë¶„ì„ì„ í•˜ëŠ” vs codeì˜ íˆ´ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.
- ì¦‰ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì´ê¸°ì— ì§ì ‘ ê°ì²´ ìƒì„±ì´ ì•ˆë˜ê³  í”„ë¡ì‹œ(ëŒ€ë¦¬ì¸)ê°€ ëŸ°íƒ€ì„ì— ê°ì²´ë¥¼ ëŒ€ì‹  ìƒì„±í•´ì£¼ëŠ” ê²ƒì´ë‹¤. ì•„ë˜ ì½”ë“œë¡œ ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```java
@Autowired
      ApplicationContext ctx;

      @Test
      void testBean() {
            Object mapper = ctx.getBean(DepartmentMapper.class);
            System.out.println(mapper); // ì‹¤ì œ í”„ë¡ì‹œ ê°ì²´ ì •ë³´ ì¶œë ¥ë¨!
      }
```
- ê¼­ ê° ë©”ì„œë“œì— @Testë¥¼ ë¶™ì—¬ì£¼ì–´ì•¼ Test ë©”ì„œë“œë¡œ ì¸ì‹í•œë‹¤.
- ìŠ¤í”„ë§ì„ ëŒê³  ìˆìœ¼ë©´ í…ŒìŠ¤íŠ¸í•˜ê³  ë¡œê·¸ê°€ ë°”ë¡œ ì•ˆì°í ìˆ˜ ìˆë‹¤.
```java
@Slf4j
@SpringBootTest
public class DepartmentMapperTest {

    @Autowired
    private DepartmentMapper departmentMapper;

    @Test
    @DisplayName("í•™ê³¼ ì¶”ê°€ í…ŒìŠ¤íŠ¸")
    void insertDepartment() {
        // => import kr.hossam.models.Department;
        Department input = new Department();
        input.setDname("ìƒˆë¡œìš´í•™ê³¼");
        input.setLoc("B-1");
        input.setPhone("010-1234-1234");
        input.setEmail("megastudy@hello.com");
        input.setEstablished(2020);
        input.setHomepage("https://megastudy.com");

        int output = departmentMapper.insert(input);

        log.debug("ì €ì¥ëœ ë°ì´í„°ì˜ ìˆ˜: " + output);
        log.debug("ìƒì„±ëœ Primary Key: " + input.getId());
    }

    @Test
    @DisplayName("í•™ê³¼ ìˆ˜ì • í…ŒìŠ¤íŠ¸")
    void updateDepartment() {
        Department input = new Department();
        input.setId(511);           // âœ… WHEREì ˆì— ì‚¬ìš©í•  PKê°’ë„ í•¨ê»˜ ì„¤ì •í•´ì•¼ í•¨
        input.setDname("ìˆ˜ì •ëœí•™ê³¼");
        input.setLoc("B-2");
        input.setPhone("010-1234-1234");
        input.setEmail("megastudy@hello.com");
        input.setEstablished(2020);
        input.setHomepage("https://megastudy.com");

        int output = departmentMapper.update(input);
        log.debug("ìˆ˜ì •ëœ ë°ì´í„°ì˜ ìˆ˜: " + output);
    }

    @Test
    @DisplayName("í•™ê³¼ ì‚­ì œ í…ŒìŠ¤íŠ¸")
    void deleteDepartment() {
        Department input = new Department();
        input.setId(511);           // âœ… WHEREì ˆì— ì‚¬ìš©í•  PKê°’ë§Œ ì¤€ë¹„
        int output = departmentMapper.delete(input);
        log.debug("ì‚­ì œëœ ë°ì´í„°ì˜ ìˆ˜: " + output);
    }

    @Test
    @DisplayName("í•˜ë‚˜ì˜ í•™ê³¼ ì¡°íšŒ í…ŒìŠ¤íŠ¸")
    void selectOneDepartment() {
        Department input = new Department();
        input.setId(101);           // âœ… WHEREì ˆì— ì‚¬ìš©í•  PKê°’ë§Œ ì¤€ë¹„
        Department output = departmentMapper.selectOne(input);
        log.debug("ì¡°íšŒê²°ê³¼: " + output.toString());
    }

    @Test
    @DisplayName("í•™ê³¼ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸")
    void selectListDepartment() {
        Department input = new Department();
        //input.setDname("");        // âœ… LIKE ê²€ìƒ‰ì— ì‚¬ìš©í•  í‚¤ì›Œë“œ
        //input.setLoc("");          // âœ… LIKE ê²€ìƒ‰ì— ì‚¬ìš©í•  í‚¤ì›Œë“œ
        List<Department> output = departmentMapper.selectList(input);
        log.debug("ì¡°íšŒê²°ê³¼: " + output.toString());
    }

    @Test
    @DisplayName("í•™ê³¼ ëª©ë¡ ì¹´ìš´íŠ¸ í…ŒìŠ¤íŠ¸")
    void selectCountDepartment() {
        Department input = new Department();
        //input.setDname("");        // âœ… LIKE ê²€ìƒ‰ì— ì‚¬ìš©í•  í‚¤ì›Œë“œ
        //input.setLoc("");          // âœ… LIKE ê²€ìƒ‰ì— ì‚¬ìš©í•  í‚¤ì›Œë“œ
        int output = departmentMapper.selectCount(input);
        log.debug("ì¡°íšŒëœ ë°ì´í„° ìˆ˜: " + output);
    }

    @Autowired
    ApplicationContext ctx;

    @Test
    void testBean() {
        Object mapper = ctx.getBean(DepartmentMapper.class);
        log.debug(mapper.toString()); // ì‹¤ì œ í”„ë¡ì‹œ ê°ì²´ ì •ë³´ ì¶œë ¥
    }
}
```

### ğŸ“Œ 1-2. log4jdbc-log4j2 ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ JDBC ë“œë¼ì´ë²„ë¥¼ ê°ì‹¸ì„œ, ì‹¤í–‰ë˜ëŠ” SQL, íŒŒë¼ë¯¸í„°, ì‹¤í–‰ì‹œê°„ ë“±ì„ ë¡œê·¸ë¡œ ë³´ì—¬ì£¼ê²Œ ëœë‹¤.
- â†’ log4jdbcê°€ SQL ê°ì‹œìš© í”„ë¡ì‹œ ë“œë¼ì´ë²„ ì—­í• 
- spylogdelegator.name: ì–´ë–¤ ë¡œê¹… ì‹œìŠ¤í…œìœ¼ë¡œ ë¡œê·¸ë¥¼ ë³´ë‚¼ì§€ ê²°ì • (ì—¬ê¸°ì„  slf4j)
- maxlinelength=0: ì¿¼ë¦¬ í•œ ì¤„ ì „ì²´ë¥¼ ë¡œê·¸ë¡œ ì¶œë ¥(ê¸¸ì´ ì œí•œ ì—†ìŒ)
- drivers: ì‹¤ì œë¡œ ê°ì‹œí•  â€œì§„ì§œ DB ë“œë¼ì´ë²„â€ ì§€ì • (ì—¬ê¸°ì„  org.mariadb.jdbc.Driver)
```properties
log4jdbc.spylogdelegator.name=net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator
log4jdbc.dump.sql.maxlinelength=0
log4jdbc.auto.load.popular.drivers=false
log4jdbc.drivers=org.mariadb.jdbc.Driver
```
- ì•„ë˜ì™€ ê°™ì€ í”„ë¡ì‹œ êµ¬ì¡°ë¡œ ì‘ë™í•œë‹¤.
```java
// ì§„ì§œ ê°ì²´ (RealObject)
class MariaDbDriver {
    Connection connect(String url) { ... }
    ResultSet executeQuery(String sql) { ... }
    // ... ê¸°íƒ€ ë©”ì„œë“œ
}

// í”„ë¡ì‹œ ê°ì²´ (Proxy)
class Log4JdbcDriverProxy {
    MariaDbDriver realDriver = new MariaDbDriver();

    Connection connect(String url) {
        // í”„ë¡ì‹œê°€ ì¤‘ê°„ì—ì„œ ê°ì‹œ!
        print("[LOG] connect() called: " + url)
        Connection conn = realDriver.connect(url)
        return conn
    }

    ResultSet executeQuery(String sql) {
        print("[LOG] SQL ì‹¤í–‰: " + sql)
        long start = now()
        ResultSet rs = realDriver.executeQuery(sql)
        long end = now()
        print("[LOG] ì‹¤í–‰ ì‹œê°„: " + (end - start) + "ms")
        return rs
    }
}
```