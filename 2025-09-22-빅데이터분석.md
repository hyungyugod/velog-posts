# 📌 0. 공공 데이터 분석 세팅
### 📌 0-1. 공공데이터
- https://www.data.go.kr/index.do에서 공공 데이터를 받아올 수 있다.
- 지자체나 준 공공기관 같은 모든 데이터를 위 사이트에서 사용한다.

### 📌 0-2. 한글 깨짐 방지
- 코드에 있는 !는 “지금 파이썬이 아니라 터미널 명령어를 실행해!”라는 뜻이다. (py환경에서 사용하면 에러가 나지만 코랩환경에서 써서 괜찮은 것 같다.)
- sudo: 관리자 권한으로 실행(리눅스/우분투 계열).
- apt-get install: 우분투의 패키지 설치 명령.
- -y: “모든 질문에 Yes”를 자동으로 선택 → 중간에 멈추지 않게.
- fonts-nanum: 나눔 계열 폰트 묶음 패키지
- fc-cache: Fontconfig(폰트 검색 시스템)의 캐시를 새로 만듦.
- -f(force): 강제로 갱신.
- -v(verbose): 진행 내용을 자세히 출력.
- 새 폰트를 시스템이 “알아보게” 하는 단계
- rm: 삭제.
- -r: 디렉터리 안을 재귀적으로 싹 지움.
- -f: 묻지 말고 강제 삭제.
- 경로 ~/.cache/matplotlib: Matplotlib이 내부적으로 쓰는 캐시 폴더.
- 폰트를 바꿨는데도 그래프에서 예전 폰트가 나올 때, 이 캐시를 지워 새 설정을 확실히 반영하게 한다.
```py
### 📌# Colab 한글 깨질 경우,

!sudo apt-get install -y fonts-nanum   # NanumBarunGothic
!sudo fc-cache -fv
!rm ~/.cache/matplotlib -rf

# 런타임에서 "런타임다시시작" 할 것
```
- plt.rc는 Matplotlib의 런타임 설정(rc) 을 바꾸는 함수이다.
- 'font' 그룹의 family를 'NanumBarunGothic'으로 지정 → 이후 그려지는 모든 그래프의 기본 글꼴이 바뀐다.
```py
# 한글 폰트 지정
plt.rc('font', family='NanumBarunGothic')
```

### 📌 0-3. warnings 세팅
- warnings 모듈: 파이썬의 경고 시스템을 제어한다.
- filterwarnings(action='ignore'): 모든 경고를 화면에 표시하지 않게 만든다.
- 장점: 노트북 출력이 깨끗해짐.
- 단점: 중요한 힌트도 안 보여서 문제 원인을 놓칠 수 있음.
```py
import warnings
warnings.filterwarnings(action='ignore')
```

### 📌 0-4. 표시구간 조정
- pd.set_option → 판다스의 출력/동작 관련 설정을 바꿀 수 있는 함수.
- 'display.max_columns' → 데이터프레임 출력 시 한 화면에 최대 몇 개의 열(column) 을 보여줄지 정하는 옵션.
- 100 → 기본은 보통 20 정도인데, 여기서는 최대 100개 열까지 표시하겠다는 뜻.
- 효과: 열이 많은 데이터프레임(예: 50~80개 열)이 있을 때, 옆에 ...로 생략하지 않고 전부 다 보이게 해줌.
- 'display.max_rows' → 이번엔 행(row) 출력 제한.
- 100 → 데이터프레임을 출력할 때 최대 100행까지 보여준다는 뜻. 기본값은 보통 10행 정도만 나오고 중간에 ...로 생략되는데, 이걸 늘린 것
```py
# pandas에서 컬럼 또는 행 표시구간 조정 예:
pd.set_option('display.max_columns', 100)
pd.set_option('display.max_rows',100)
```

# 📌 1. 공공데이터 탐색
### 📌 1-1. 데이터탐색은 우선 범위를 좁혀두고
- 서울 사업장에 대한 데이터를 다룰때 이디야를 찾고 싶으면 전체 데이터에서 이디야를 찾는 것보다 카페 중에서 이디야를 찾는 것이 합리적이다. 
- 하여 head나 info같은 명령어로 칼럼을 파악하여 필요한 종류의 업종만 찾으면 된다.
```py
# 범위를 좁혀두고 데이터 탐색하기
shop_coffee = shop[shop["상권업종소분류명"] == '카페']
```

### 📌 1-2. 이름이 포함된 데이터 찾기
- 해당 칼럼의 데이터 타입은 object이므로 우선 str로 만든 뒤에 str객체의 함수를 사용하여 분류해낸다.
```py
shop_coffee[shop_coffee["상호명"] == "이디야"]
shop_coffee[shop_coffee["상호명"].str.startswith("이디야")]
shop_coffee[shop_coffee["상호명"].str.endswith("이디야")]
shop_coffee[shop_coffee["상호명"].str.contains("이디야")]
```

### 📌 1-3. 피벗테이블로 통계내기
- 아래는 각 카페를 시군구명 기준으로 group by하면서 상가업소번호 개수를 count한 집계 결과를 나타낸 피벗테이블을 보이는 코드이다.
```py
shop_coffee_idy = shop_coffee[shop_coffee["상호명"].str.startswith("이디야")]
shop_coffee_mega = shop_coffee[shop_coffee["상호명"].str.startswith("메가커피")]

# pivot_table()을 이용해서ㅡ 어느 시군구에 매장이 많고 적은지 확인:
pd.pivot_table(shop_coffee_mega, index = "시군구명", values="상가업소번호", aggfunc="count")
pd.pivot_table(shop_coffee_idy, index = "시군구명", values="상가업소번호", aggfunc="count")
```
- sort_values를 활용하여 series의 value를 기준으로 정렬을 할 수 있다. 
- 기본값은 오름차순이다.
- ascending값을 False로 명시적으로 줌으로서 내림차순으로 정렬할 수 있다.
```py
pd.pivot_table(shop_coffee_idy, index = "시군구명", values="상가업소번호", aggfunc="count").sort_values(by="상가업소번호", ascending=False)
```

# 📌 2. folium 데이터 시각화
### 📌 2-1. 지도에 위치데이터 시각화하기 일반
- 현업에서는 보통 태블로라는 전문 시각화 툴을 사용한다.
- folium이라는 데이터 시각화 툴을 사용한다.
- folium.Map에 위도, 경도를 입력하면 해당 위치가 중앙이되는 지도를 보여준다.
- folium.Marker([37.609666,127.051622]).add_to(map1) : Marker에 위도,경도를 주고 점을 찍을 위치를 add_to로 제공하면 해당 지도에 해당 위도경도에 마커를 찍는다.
```py
import folium
# 1) 표시할 지도 만들기 (위도/경도) -> 위도 경도 정보가 이미 있음
map1 = folium.Map([37.609666,127.051622])
# 2) 1) 지도에다 마킹표시
folium.Marker([37.609666,127.051622]).add_to(map1)
```

### 📌 2-2. 지도위에 여러 위치를 표시하기
- 카페 데이터셋을 가져와서 모든 카페의 위치를 지도하고 싶을때는 for문과 loc를 통해 정확한 위도값과 경도값을 데이터셋의 인덱스를 돌면서 입력한다. 
- 해당 위도경도로 folium.Marker([a,b]).add_to(map2) 이 명령을 실행한다.
```py
# 2) 1) 지도에다 마킹표시
shop_coffee_idy[["위도","경도"]].loc[2512,"위도"] #37.5933276477628

for i in shop_coffee_idy.index:
  a = shop_coffee_idy[["위도","경도"]].loc[i,"위도"]
  b = shop_coffee_idy[["위도","경도"]].loc[i,"경도"]

  folium.Marker([a,b]).add_to(map2)
```
### 📌 2-3. MarkerCluster를 활용하여 좀 더 보기좋게 마킹하기
- 기존에는 너무 많은 데이터가 지도위에 밀집하여 찍혀있어 보기 불편했다.
- 이를 개선하기 위해 중간에 채같은 것으로(새로운 효과를 적용하여) 한번 걸러서 깔끔하게 정리하여 표시할 수 있도록 한다.
- MarkerCluster는 줌에 따라 모여있는 부분은 원에 모여있는 숫자로 퉁쳐서 보여주고 확대하면 점점 마커가 나타나는 역할을 한다.
```py
from folium.plugins import MarkerCluster

mcluster = MarkerCluster()

# 1)
map3 = folium.Map([37.548490,126.994028])
mc = mcluster.add_to(map3)

for i in shop_coffee_idy.index:
  a = shop_coffee_idy.loc[i,"위도"]
  b = shop_coffee_idy.loc[i,"경도"]

  folium.Marker([a,b]).add_to(mc)
```
- 마커에 툴팁과 팝업 정보도 추가할 수 있다 아래와 같이 반복문 돌때 데이터를 뽑아내고 Marker함수에 매개변수를 추가해주면 된다.
```py
mc = mcluster.add_to(map3)

for i in shop_coffee_idy.index:
  a = shop_coffee_idy.loc[i,"위도"]
  b = shop_coffee_idy.loc[i,"경도"]
  c = shop_coffee_idy.loc[i,"시군구명"]
  d = shop_coffee_idy.loc[i,"상호명"]

  folium.Marker([a,b], 
                tooltip=c,
                popup=d).add_to(mc)
```

### 📌 2-4. HeatMap으로 시각화하기
- min_opacity는 최소 투명도로 히트맵이 얼마나 투명할지를 설정해준다.
```py
from folium.plugins import HeatMap

map4 = folium.Map([37.548490,126.994028])

HeatMap(shop_coffee_idy[["위도","경도"]], 
        min_opacity=0.2).add_to(map4)
```
