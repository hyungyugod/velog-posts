# ğŸ“Œ 0. ëŒ€í™”
### ğŸ“Œ 0-1. í˜ì´ì§€ ì´ë™ ì„ íƒ
```java
// ì´ì „ í˜ì´ì§€, ì´í›„ í˜ì´ì§€ëŠ” ì´ì „, ì´í›„ê°€ ì—†ìœ¼ë©´ ëª¨ë‘ ê°’ì„ 0ìœ¼ë¡œ ë§Œë“¦
        prevPage = (startPage > groupCount) ? startPage - 1 : 0;
        nextPage = (endPage < totalPage) ? endPage + 1 : 0;

        offset = (nowPage - 1) * listCount; // limit ê°’ ì„¤ì •í•  ë•Œ ì‹œì‘ê°’ì€ 0ì—ì„œ ì‹œì‘
```
- ì´ê±¸ í˜ì´ì§€ ë‹¨ìœ„ë¡œ ë„˜ê¸°ë ¤ë©´ ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ ë˜ëŠ”ë°
```java
prevPage = (nowPage > groupCount) ? nowPage - 1 : 0;
        nextPage = (nowPage < totalPage) ? nowPage + 1 : 0;
```
- ì´ëŸ¬ë©´ í˜ì´ì§€ê°€ ë§ì•„ì¡Œì„ë•Œ ì›Œí”„í•˜ê¸° í˜ë“¤ì–´ì„œ ê·¸ëƒ¥ ìœ„ì²˜ëŸ¼ í•˜ëŠ”ê²Œ ë‚«ê±°ë‚˜ ë²„íŠ¼ì„ ì–‘ìª½ì— ê° ë‘ê°œì”© í•˜ëŠ”ê²Œ ë‚˜ì„ ê²ƒ ê°™ë‹¤.
- ì•„ë˜ êµ¬ì¡°ë¡œ íŒë‹¨
```html
<ul class="pagination">
    <!-- ì´ì „ í˜ì´ì§€ ê·¸ë£¹ ì´ë™ ë²„íŠ¼ -->
    <li th:if="${pageHelper.prevPage > 0}"> 
        <a th:href="@{/professor(keyword=${keyword}, page=${pageHelper.prevPage})}">â—€</a>
    </li>
    <li th:unless="${pageHelper.prevPage > 0}"><a>â—€</a></li>

    <!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ -->
    <li th:each="i : ${#numbers.sequence(pageHelper.startPage, pageHelper.endPage)}">
        <a th:if="${i == pageHelper.nowPage}" class="active" th:text="${i}" ></a>
        <a th:unless="${i == pageHelper.nowPage}" th:text="${i}"
            th:href="@{/professor(keyword=${keyword}, page=${i})}" ></a>
    </li>

    <!-- ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ ì´ë™ ë²„íŠ¼ -->
    <li th:if="${pageHelper.nextPage > 0}">
        <a th:href="@{/professor(keyword=${keyword}, page=${pageHelper.nextPage})}">â–¶</a>
    </li>
    <li th:unless="${pageHelper.nextPage > 0}"><a>â–¶</a></li>
</ul>
```
- ê·¸ë˜ì„œ ê·¸ë£¹ì´ ì ì„ë• ê·¸ëƒ¥ ë²„íŠ¼ì´ í´ë¦­ì´ ì•ˆë˜ëŠ”ê²Œ ë§ë‹¤.
- í—·ê°ˆë ¤ì„œ cssì™€ í´ë˜ìŠ¤ ì¶”ê°€í•¨ -> ì•„ë¬´ ê²ƒë„ ì—†ì„ë•Œì˜ aíƒœê·¸ì— class btn2ë¥¼ ì£¼ê³ 
```css
.btn2 {
    &:hover {
        color: #0c1ea8;
        cursor: pointer;
    }
}
```
- ì´ë ‡ê²Œ í•˜ë‹ˆê¹Œ ì‘ë™ì€ í•˜ëŠ”ë° ë‹¤ìŒ ê·¸ë£¹ì´ ì—†ë‹¤ëŠ” ê±°ë¥¼ ì˜ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œë¨.

# ğŸ“Œ 1. professor

### ğŸ“Œ 1-1. professorì— ì†Œì†í•™ê³¼ id ëŒ€ì‹  ì†Œì† í•™ê³¼ëª… í‘œì‹œ
- ì•„ë˜ ì²˜ëŸ¼ í…Œì´ë¸”ì— ì†Œì†í•™ê³¼ ë²ˆí˜¸ë¡œ departmentì˜ ì •ë³´ë¥¼ join ì‹œí‚¨ë‹¤.
- ì´ë•Œ ì•„ë˜ ì¹´ë©œ-ìŠ¤ë„¤ì´í¬ í‘œê¸°ë²• ë§µí•‘ì´ mybatis.configuration.map-underscore-to-camel-case=trueì„ application propertiesì— ë„£ìœ¼ë©´ êµ³ì´ mapì„ ì“°ì§€ ì•Šì•„ë„ ìë™í™”ëœë‹¤.
```java
@Select("SELECT p.id, name, user_id, position, sal, hiredate, comm, p.email, p.phone, photo_url, status, department_id FROM professors AS p " 
            + "join departments as d on p.department_id = d.id "
            + "WHERE p.id = #{id}")
            @Results(id = "resultMap", value = {
            @Result(property = "id", column = "id"),
            @Result(property = "name", column = "name"),
            @Result(property = "userId", column = "user_id"),
            @Result(property = "position", column = "position"),
            @Result(property = "sal", column = "sal"),
            @Result(property = "hiredate", column = "hiredate"),
            @Result(property = "comm", column = "comm"),
            @Result(property = "email", column = "email"),
            @Result(property = "phone", column = "phone"),
            @Result(property = "photoUrl", column = "photo_url"),
            @Result(property = "status", column = "status"),
            @Result(property = "departmentId", column = "department_id"),
            @Result(property = "dname", column = "dname")
        })
```
- ì•„ë˜ mapperì—ì„œ í™”ë©´ì— ì¶œë ¥í•  ì†ì„±ë“¤ì„ dtoì— ë„£ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— joinì„ í•˜ì—¬ department_id ëŒ€ì‹ ì— d.dnameì„ ë„£ì–´ì¤€ë‹¤.
```java
@Select("<script>"+
        "SELECT p.id, name, user_id, position, sal, hiredate, comm, p.email, p.phone, photo_url, status, d.dname FROM professors AS p " 
        + "join departments AS d on p.department_id = d.id "
        + "<where>" 
        + " <if test=\"name != null and name != ''\"> name like concat('%', #{name}, '%')</if> " 
        + "<if test=\"userId != null and userId != ''\">or user_id like concat('%', #{userId}, '%')</if> "
        +"</where> "
        + "order by p.id desc "
        + "<if test='listCount > 0'>limit #{offset}, #{listCount}</if>"
        + "</script>")
    public List<Professor> selectList(Professor input);
```

### ğŸ“Œ 1-2. êµìˆ˜ ì‚¬ì´íŠ¸ì— í•™ê³¼ ë“œë¡­ë‹¤ìš´ ì¶”ê°€í•˜ê¸°
- ê¸°ì¡´ì˜ í¼ ì•ˆì— í•´ë‹¹ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë“œë¡­ë‹¤ìš´ì„ ë§Œë“ ë‹¤. ë¦¬ìŠ¤íŠ¸ì˜ Department ê°ì²´ë“¤ì˜ ê°’ì„ dë¡œ ë°›ì•„ì„œ í…ìŠ¤íŠ¸ë¥¼ í‘œê¸°í•˜ê³  ê°’ì„ ì•„ì´ë””ë¡œ ì§€ì •í•´ë‘”ë‹¤.
- í˜„ì¬ ì„ íƒë˜ì–´ th:value="${d.id}"ì— ì˜í•´ ë§¤ê²¨ì ¸ìˆë˜ ê°’ì„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë³´ë‚´ëŠ”ë° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ê±°ì³ì„œ indexë¡œ ì™”ì„ ë•Œ ë°©ê¸ˆ ì„ íƒí•œ ê°’ì€ departmentIdë¡œ ì €ì¥ë˜ì–´ ë“¤ì–´ì˜¨ë‹¤.
- ì´ë•Œ ë°©ê¸ˆ ì„ íƒí•´ì„œ ë“¤ì–´ì˜¨ ê°’ê³¼ ê°™ì€ idë¥¼ ê°€ì§„ optionì—ëŠ” selected ì†ì„±ì„ ë¶€ì—¬í•œë‹¤.
```html
<select name="department_id">
    <option value="" th:selected="${departmentId == 0}">ì „ì²´í•™ê³¼</option>
    <option th:each="d:${departmentList}" th:value="${d.id}" th:text="${d.dname}" th:selected="${departmentId == d.id}"></option>
</select>
```
- ì•„ë˜ëŠ” í˜ì´ì§€ ì´ë™ ë²„íŠ¼ í˜ì´ì§€ë¥¼ ì´ë™í•´ë„ í˜„ì¬ ì„¤ì •ë˜ì–´ ìˆë˜ department_id ê°’ì„ ìœ ì§€í•´ì•¼ í•˜ë¯€ë¡œ ì´ë ‡ê²Œ ì‘ì„±í•œë‹¤. (ìƒíƒœì´ë™)
```html
<li th:if="${pageHelper.prevPage > 0}"> 
    <a th:href="@{/professor(keyword=${keyword}, department_id=${department_id} page=${pageHelper.prevPage})}">â—€</a>
</li>
```
- trimì˜ ì–´ì›ì€ ê°€ì§€ëŸ°íˆ í•˜ë‹¤, ì •ëˆí•˜ë‹¤, ë‹¤ë“¬ë‹¤ë¼ëŠ” ëœ»ì´ë‹¤.
- MyBatisì—ì„œ <trim> íƒœê·¸ëŠ” SQL ë™ì  ìƒì„±ì—ì„œ â€œë¶ˆí•„ìš”í•œ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬(AND, OR ë“±)â€ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” íƒœê·¸ì´ë‹¤.
- trimì„ í†µí•´ ì²˜ìŒê³¼ ëì— ê´„í˜¸ë¥¼ ê°ê° ë¶™ì´ê³  andë‚˜ orì´ ìˆìœ¼ë©´ ì‚­ì œí•œë‹¤.
- prefixOverrides="AND |OR" : ì¡°ê±´ë¬¸ ë¸”ë¡ì˜ ë§¨ ì•ì´ AND ë˜ëŠ” ORì´ë©´ ì§€ìš´ë‹¤.
- ì•„ë˜ and department_id = #{departmentId}ì™€ ì—°ì‚°ìˆœì„œë¥¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì´ì™€ ê°™ì€ ë°©ì‹ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.
```java
+ "<where>" 
    + "<trim prefix='(' suffix=')' prefixOverrides='AND |OR'> "
        + " <if test=\"name != null and name != ''\"> name like concat('%', #{name}, '%')</if> " 
        + "<if test=\"userId != null and userId != ''\">or user_id like concat('%', #{userId}, '%')</if> "
    + "</trim> "
    + "<if test='departmentId != 0'>AND department_id = #{departmentId}</if>"
+"</where> "
```
- ì•„ë˜ëŠ” ì „ì²´ index ì½”ë“œì´ë‹¤.
```html
<body>
    <header th:replace="fragments/header :: my-header"></header>

    <h1>êµìˆ˜ëª©ë¡</h1>

    <div class="search-controller">
        <form id="my-form" th:action="@{/professor}" method="get">
            <input type="search" name="keyword" id="my-search" placeholder="êµìˆ˜ì´ë¦„ or ì•„ì´ë”” ê²€ìƒ‰" th:value="${keyword}">

            <select name="department_id">
                <option value="" th:selected="${departmentId == 0}">ì „ì²´í•™ê³¼</option>
                <option th:each="d:${departmentList}" th:value="${d.id}" th:text="${d.dname}" th:selected="${departmentId == d.id}"></option>
            </select>
        
            <button type="submit" class="mybutton green">ê²€ìƒ‰</button>
        </form>
        <div class="buttons">
            <a th:href="@{/professor/add}" class="mybutton blue">êµìˆ˜ì •ë³´ ì¶”ê°€</a>
        </div>
    </div>

    <table class="my-table">
        <thead>
            <tr>
                <th>ì‚¬ì§„</th>
                <th>ë²ˆí˜¸</th>
                <th>ì´ë¦„</th>
                <th>ì•„ì´ë””</th>
                <th>ì§ê¸‰</th>
                <th>ì…ì‚¬ì¼</th>
                <th>ê¸‰ì—¬(ë§Œì›)</th>
                <th>ì´ë©”ì¼</th>
                <th>ì—°ë½ì²˜</th>
                <th>ìƒíƒœ</th>
                <th>ì†Œì†í•™ê³¼</th>
                <th>-</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="professor : ${professors}">
                <td>
                    <img th:src="${professor.photoUrl}" alt="êµìˆ˜ ì´ë¯¸ì§€" class="photo" >
                </td>
                <td th:text="${professor.id}"></td>
                <td>
                    <a th:href="@{/professor/view/{id}(id=${professor.id})}" th:text="${professor.name}"></a>
                </td>
                <td th:text="${professor.userId}"></td>
                <td th:text="${professor.position}"></td>
                <td th:text="${#strings.substring(professor.hiredate, 0, 10)}"></td>
                <td th:text="${professor.sal}"></td>
                <td>
                    <a th:href="'mailto:' + ${professor.email}" th:text="${professor.email}"></a>
                </td>
                <td>
                    <a th:href="'tel:' + ${professor.phone}" th:text="${professor.phone}"></a>
                </td>
                <td th:text="${professor.status}"></td>
                <td th:text="${professor.dname}"></td>
                <td>
                    <a th:href="@{/professor/edit/{id}(id=${professor.id})}">ìˆ˜ì •</a>
                    <a th:href="@{/professor/delete/{id}(id=${professor.id})}">ì‚­ì œ</a>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
<ul class="pagination">
    <!-- ì´ì „ í˜ì´ì§€ ê·¸ë£¹ ì´ë™ ë²„íŠ¼ -->
    <li th:if="${pageHelper.prevPage > 0}"> 
        <a th:href="@{/professor(keyword=${keyword}, department_id=${departmentId}, page=${pageHelper.prevPage})}">â—€</a>
    </li>
    <li th:unless="${pageHelper.prevPage > 0}"><a class="btn2">â—€</a></li>

    <!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ -->
    <li th:each="i : ${#numbers.sequence(pageHelper.startPage, pageHelper.endPage)}">
        <a th:if="${i == pageHelper.nowPage}" class="active" th:text="${i}" ></a>
        <a th:unless="${i == pageHelper.nowPage}" th:text="${i}"
            th:href="@{/professor(keyword=${keyword}, department_id=${departmentId}, page=${i})}" ></a>
    </li>

    <!-- ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ ì´ë™ ë²„íŠ¼ -->
    <li th:if="${pageHelper.nextPage > 0}">
        <a th:href="@{/professor(keyword=${keyword}, department_id=${departmentId}, page=${pageHelper.nextPage})}">â–¶</a>
    </li>
    <li  th:unless="${pageHelper.nextPage > 0}"><a class="btn2">â–¶</a></li>
</ul>

    <script>
        document.querySelectorAll("img").forEach(v => {
            v.addEventListener("error", e => e.currentTarget.src = "/assets/img/noimage.jpg");
        });
    </script>
</body>
</html>
```
- controllerëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```java
@Controller
public class ProfessorController {
    
    @Autowired
    private ProfessorService professorService;

    @Autowired
    private DepartmentService departmentService;

    @Autowired
    private WebHelper wepHelper;

    @GetMapping("/professor")
    public String index(Model model,
                        @RequestParam(value = "keyword" , required = false) String keyword,
                        @RequestParam(value = "department_id", required=false, defaultValue = "0") int departmentId,
                        @RequestParam(value = "page", defaultValue = "1") int nowPage) {

        int totalCount = 0;
        int listCount = 10;
        int groupCount = 5;

        PageHelper pageHelper = null;

        Professor ProfessorSearchParam = new Professor();
        ProfessorSearchParam.setName(keyword);
        ProfessorSearchParam.setUserId(keyword);
        ProfessorSearchParam.setDepartmentId(departmentId);

        List<Professor> output = null;
        List<Department> departmentList = null;

        try {
            totalCount = professorService.getCount(ProfessorSearchParam);
            pageHelper = new PageHelper(nowPage, totalCount, listCount, groupCount);

            Professor.setOffset(pageHelper.getOffset());
            Professor.setListCount(listCount);

            output = professorService.getList(ProfessorSearchParam);
            
            departmentList = departmentService.getList(null);

        } catch (Exception e) {
            wepHelper.serverError(e);
        }

        model.addAttribute("professors", output);
        model.addAttribute("keyword", keyword);
        model.addAttribute("pageHelper", pageHelper);
        model.addAttribute("departmentList", departmentList);
        model.addAttribute("departmentId", departmentId);

        return "professor/index";
    }
}
```


