# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡ ì½”ë”© í”„ë¡œì íŠ¸
### ğŸ“Œ 0-1. í† ìŠ¤í˜ì´ ê²°ì œ êµ¬í˜„ ï¼‹ ê²°ì œ í†µí•© êµ¬í˜„
- ê²°ì œ ë²„íŠ¼ì€ ì•„ë˜ì™€ ê°™ì´ ë‘ê°€ì§€ ì¢…ë¥˜ê°€ ìˆê³  ì´ ë‘ê°€ì§€ ì¢…ë¥˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ì£¼ë¬¸í•˜ë©´ í•´ë‹¹ ë²„íŠ¼ì— ê±¸ë ¤ìˆëŠ” js ì´ë²¤íŠ¸ì— ì˜í•´ ê²°ì œ ì ˆì°¨ê°€ ì‹œì‘ëœë‹¤.
```html
<div class="order-total-btn-row">
    <button id="btnOrder" class="cart-order-btn">ì£¼ë¬¸í•˜ê¸°</button>
    <button id="btnTossPayOrder" class="cart-toss-btn">
        <img src="/assets/img/payment/toss.png" alt="Toss Pay" class="toss-icon">
        Toss Pay ê²°ì œ
    </button>
    <a th:href="@{/main}" class="cart-continue-link">ê³„ì† ì‡¼í•‘í•˜ê¸°</a>
</div>
```
- í”„ë¡ íŠ¸ì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ì´ í™”ë©´ì— ë„ì›Œì§„ ì£¼ë¬¸í•  ìƒí’ˆì˜ ì •ë³´ë¥¼ ëª¨ì•„ì„œ ë°±ì—”ë“œë¡œ ajax ìš”ì²­ì„ ìš°ì„ í•˜ê²Œ ëœë‹¤.
- ìœ„ê°€ ì¼ë°˜ ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼, ì•„ë˜ê°€ í† ìŠ¤í˜ì´ ì „ìš© ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ì´ë‹¤.
- ì´ë•Œ ì¼ë°˜ ê²°ì œëŠ” ê·¸ëƒ¥ /api/payment/prepareë¡œ ë³´ë‚´ê³  í† ìŠ¤í˜ì´ì˜ ê²½ìš° /api/payment/prepare?paymentMethod=tosspay ë¡œ ê²°ì œ ìˆ˜ë‹¨ì„ ê°™ì´ í¬í•¨í•´ì„œ ë³´ë‚¸ë‹¤.
- ì´ë•Œ urlì— í•œê¸€ì´ ìˆìœ¼ë©´ ì¸ì½”ë”© ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•œê¸€ ëŒ€ì‹  ì˜ì–´ tosspayë¥¼ ì‚¬ìš©í•œë‹¤.
```js
// AJAXë¡œ ê²°ì œ ì¤€ë¹„ API í˜¸ì¶œ - ìƒì„¸ ì •ë³´ì™€ í•¨ê»˜ ì „ì†¡
const response = await fetch('/api/payment/prepare', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify(selectedOrderItems)
});

// AJAXë¡œ í† ìŠ¤í˜ì´ ê²°ì œ ì¤€ë¹„ API í˜¸ì¶œ - í†µí•© ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
const response = await fetch('/api/payment/prepare?paymentMethod=tosspay', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify(selectedOrderItems)
});
```
- ìš°ì„  ì¼ë°˜ ê²°ì œ ì£¼ë¬¸ì„œ ì–‘ì‹ì€ ì‹ ìš©ì¹´ë“œê°€ ëŒ€í‘œí•œë‹¤. -> ì£¼ë¬¸ì„œ ë„ì›Œì§ˆë•Œ ì²´í¬ë˜ì–´ìˆëŠ” ê¸°ë³¸ê°’ì´ë¯€ë¡œ
- ë§Œì•½ tosspayê°€ ë¶™ì–´ì„œ ì˜¤ë©´ ì´ëŠ” ë‚´ë¶€ enumì— ë§ê²Œ if (paymentMethod.equals("tosspay")) paymentMethod = "í† ìŠ¤í˜ì´"ë¥¼ í†µí•´ í† ìŠ¤í˜ì´ë¡œ ê²°ì œ ë°©ë²•ì„ ì €ì¥í•œë‹¤.
- ì—¬ê¸°ì„œ preparePayment ë©”ì„œë“œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì§€ê¸ˆ ì£¼ë¬¸í•˜ê² ë‹¤ê³  ìš”ì²­í•œ ìƒí’ˆêµ¬ì„±ê³¼ ë™ì¼í•œ ìƒí’ˆ êµ¬ì„±ì„ ê°€ì§„ ì£¼ë¬¸ì„œê°€ ê²°ì œ ëŒ€ê¸°ì¤‘ì¸ ìƒíƒœë¡œ ì¡´ì¬í•˜ë©´ í•´ë‹¹ ì£¼ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
- ì´ë•Œ ìƒˆë¡œ ì œê³µë˜ëŠ” ê²°ì œ ë°©ë²•ì— ë”°ë¼ í•´ë‹¹ ì£¼ë¬¸ì„œì˜ ë²„ì „ì„ í† ìŠ¤í˜ì´ ë²„ì „ìœ¼ë¡œ í• ì§€ ì•„ë‹ˆë©´ ê¸°ë³¸ ê²°ì œ ë²„ì „ìœ¼ë¡œ í• ì§€ë§Œ ê²°ì •í•œë‹¤.
- ê·¸ë¦¬ê³  ì´ì œ ëª¨ë“  ì •ë³´ëŠ” dbì— ì„ì‹œ ì €ì¥ëœ ì£¼ë¬¸ì„œì— ìˆìœ¼ë¯€ë¡œ ì´í›„ ì£¼ë¬¸ì„œì— ëŒ€í•œ ëª¨ë“  ì •ë³´ëŠ” ì£¼ë¬¸ë²ˆí˜¸ê°€ ëŒ€í‘œí•˜ê²Œ ëœë‹¤. í•˜ì—¬ ë‹¤ì‹œ ì‘ë‹µì„ ë³´ë‚¼ë•ŒëŠ” ì£¼ë¬¸ë²ˆí˜¸ë§Œ ë‹¤ì‹œ ë³´ë‚¸ë‹¤.
```java
@PostMapping("/api/payment/prepare")
    public ResponseEntity<ResponseDTO> prepareOrder(@RequestBody List<OrderProduct> orderProducts,
                                                    @RequestParam(value = "paymentMethod", required = false, defaultValue = "ì‹ ìš©ì¹´ë“œ") String paymentMethod,
                                                    @SessionAttribute("memberInfo") User member) throws Exception {
        validationManager.validateOrderProducts(orderProducts);

        if (paymentMethod.equals("tosspay")) paymentMethod = "í† ìŠ¤í˜ì´"; // í•œê¸€ëª…ìœ¼ë¡œ ë³€ê²½ -> urlì— í•œê¸€ì´ ìˆìœ¼ë©´ ì¸ì½”ë”© ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„± ìˆìŒ

        Order order = paymentService.preparePayment(member.getUserId(), orderProducts, paymentMethod);
        
        Map<String, Object> responseData = new HashMap<>();
        responseData.put("orderNumber", order.getOrderNumber());

        ResponseDTO response = ResponseDTO.builder()
                .success(true)
                .data(responseData)
                .timestamp(LocalDateTime.now())
                .build();
        return ResponseEntity.ok(response);
    }
```
- í•´ë‹¹ ìš”ì²­ì—ì„œ ìƒˆë¡œ ìƒì„±ëœ ì£¼ë¬¸ì„œì˜ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë°›ìœ¼ë©´ ì´ë¥¼ ê°€ì§€ê³  ë‹¤ì‹œ /payment?orderNumber=${orderNumber}ë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ì´ëŠ” í•´ë‹¹ ì£¼ë¬¸ì„œë¥¼ ì‹¤ì œë¡œ ë¡œë”©í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.
```js
if (result.success) {
          const orderNumber = result.data.orderNumber;
          window.location.href = `/payment?orderNumber=${orderNumber}`;
        }
```
- ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì£¼ë¬¸ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  í™”ë©´ êµ¬ì„±ì— í•„ìš”í•œ íšŒì›ì •ë³´, ì£¼ë¬¸ í†µê³„ì •ë³´ë¥¼ ìƒì„±í•˜ì—¬ modelì— ë‹´ëŠ”ë‹¤.
- ì—¬ê¸°ì„œ ì£¼ë¬¸ì„œì— ì €ì¥ëœ ê²°ì œ ë°©ë²•ì´ í† ìŠ¤í˜ì´ëƒ ì•„ë‹ˆëƒì— ë”°ë¼ì„œ istosspayë¼ëŠ” ë³€ìˆ˜ë„ ë”°ë¡œ ì¡°ì •í•˜ëŠ”ë° ì´ ë³€ìˆ˜ì— ë”°ë¼ ê²°ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ì´ í† ìŠ¤í˜ì´ìŠ¤íƒ€ì¼, ì¼ë°˜ ìŠ¤íƒ€ì¼ ì¤‘ í•˜ë‚˜ë¡œ ë°”ë€ë‹¤.
- ë˜ pg ì‚¬ ì •ë³´ë¥¼ ê²°ì œ ë°©ë²•ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë³´ë‚´ë¯€ë¡œì„œ ê²°ì œ ë²„íŠ¼ì— ë‹¤ë¥¸ dataê°€ ë“¤ì–´ê°€ê²Œ ë˜ê³  ì´ë¡œì¨ ê²°ì œ ë²„íŠ¼ê³¼ ì—°ê²°ëœ í´ë¦­ì´ë²¤íŠ¸ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” pgì‚¬ê°€ ë‹¬ë¼ì§€ê²Œ ëœë‹¤. 
- í•˜ì—¬ ê¸°ë³¸ ì •ë³´ +  paymentConfig(ì•„ì„í¬íŠ¸ ì—°ë™ ê´€ë ¨ëœ ì •ë³´, pgì‚¬ ì½”ë“œ í¬í•¨) + í† ìŠ¤í˜ì´ ìœ ë¬´ë¡œ ë‚˜ëˆ ì„œ ë³´ë‚´ê²Œ ëœë‹¤.
- ë¬¼ë¡  istosspayë¥¼ ë¯¸ë¦¬ ê³„ì‚°í•˜ì§€ ì•Šê³  viewì—ì„œ ê³„ì‚°í•´ì„œ ë„£ì–´ë„ ë˜ì§€ë§Œ ë§¤ë²ˆ getë©”ì„œë“œë¥¼ ì‹¤í–‰í•´ì„œ íŒë‹¨í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ ê²°ì •í•´ì„œ ì£¼ëŠ” ê²ƒì´ë‹¤.
```java
@GetMapping("/payment")
    @Transactional(readOnly = true)
    public String paymentPage(@SessionAttribute("memberInfo") User member,
                                @RequestParam(value = "orderNumber", required = false) String orderNumber,
                                Model model) throws Exception {

        // ì„¸ì…˜ ì •ë³´ë¥¼ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜´
        User userInfo = paymentService.getUserInfo(member);

        if (orderNumber == null || orderNumber.trim().isEmpty()) {
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ ë²ˆí˜¸ë¡œ ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒ
        Order order = paymentService.getOrderByNumber(orderNumber);

        if (order == null) {
            return "redirect:/cart";
        }
        
        if (order.getUserId() != member.getUserId()) {
            return "redirect:/cart";
        }
        
        if (!"ê²°ì œëŒ€ê¸°ì¤‘".equals(order.getOrderStatus())) {
            return "redirect:/cart";
        }
        
        // ì£¼ë¬¸ 'ìƒí’ˆ' ì •ë³´ë¥¼ ì¡°íšŒ
        OrderProduct orderProductInput = new OrderProduct();
        orderProductInput.setOrderId(order.getOrderId());
        List<OrderProduct> orderProducts = paymentService.getOrderProductsByOrderId(orderProductInput);  

        // ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ì£¼ë¬¸ ìš”ì•½ ì •ë³´ ìƒì„±
        OrderSummaryVo orderSummary = new OrderSummaryVo(orderProducts); 
    
        // ê²°ì œ ë°©ë²•ì— ë”°ë¼ PG ì œê³µìë¥¼ ì„¤ì • -> ë˜ ì´ì—ë”°ë¼ ê²°ì œí•˜ê¸° ë²„íŠ¼ ì¢…ë¥˜ë„ ë³€ê²½
        boolean isTossPay = "í† ìŠ¤í˜ì´".equals(order.getPurchaseMethod());
        String pgProvider = isTossPay ? tossPayPgProvider : defaultPgProvider;
        
        PaymentConfigDto paymentConfig = new PaymentConfigDto(
            iamportMerchantCode, 
            pgProvider, 
            orderName
        );
        
        model.addAttribute("userInfo", userInfo);
        model.addAttribute("orderProducts", orderProducts);
        model.addAttribute("orderSummary", orderSummary);
        model.addAttribute("paymentConfig", paymentConfig);
        model.addAttribute("isTossPay", isTossPay);
        
        return "payment/index"; 
    }
```
- ì•„ë˜ëŠ” ì£¼ë¬¸ì„œ viewì´ë‹¤.
```html
<main class="payment-wrapper">
    <h2 class="page-title">ê²°ì œí•˜ê¸°</h2>

    <div class="payment-inner">
        <!-- ì™¼ìª½ ì˜ì—­ -->
        <section class="left-area">            
            
            <!-- ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ -->
            <div class="order-items">
                <h3>ì£¼ë¬¸ ìƒí’ˆ ì •ë³´</h3>
                <ul class="item-list">
                    <li class="item" th:each="item : ${orderProducts}">                        
                        <div class="item-wrapper">
                            <div class="thumb" th:onclick="|window.location.href='/productsinfo/${item.productId}'|">
                                <img th:src="@{${item.orderProductImg}}" th:alt="${item.orderProductName}">
                            </div>
                            <div class="info">
                                <p class="name" th:text="${item.orderProductName}" th:onclick="|window.location.href='/productsinfo/${item.productId}'|"></p>
                                <p class="option">
                                    <span class="label">í•„ìˆ˜</span> 
                                    <span th:text="${item.colorName}"></span> - 
                                    <span th:text="${item.orderQuantity}"></span>ê°œ
                                </p>
                                <p class="price" th:text="${#numbers.formatDecimal(item.orderProductPrice * item.orderQuantity, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></p>
                            </div>
                        </div>
                    </li>
                </ul>                
                <div class="delivery-cost-row">
                    ë°°ì†¡ë¹„ 
                    <strong th:text="${orderSummary.deliverySum > 0 ? #numbers.formatDecimal(orderSummary.deliverySum, 0, 'COMMA', 0, 'POINT') + 'ì›' : 'ë¬´ë£Œ'}"></strong>
                </div>
            </div>           
            
            <!-- ì£¼ë¬¸ì ì •ë³´ -->
            <div class="orderer-info">
                <h3>ì£¼ë¬¸ì ì •ë³´</h3>
                
                <div class="viewer">
                    <p class="line"><span class="name" th:text="${userInfo.userName}"></span></p>
                    <p class="line"><span class="phone" th:text="${userInfo.userPhone}"></span></p>
                    <p class="line"><span class="email" th:text="${userInfo.userEmail}"></span></p>
                </div>
                
                <!-- ì£¼ë¬¸ì ì •ë³´ë¥¼ hidden í•„ë“œë¡œ ì €ì¥í•˜ì—¬ JavaScriptì—ì„œ ì‚¬ìš© -->
                <input type="hidden" id="ordererName" th:value="${userInfo.userName}">
                <input type="hidden" id="ordererPhone" th:value="${userInfo.userPhone}">
                <input type="hidden" id="ordererEmail" th:value="${userInfo.userEmail}">
                <input type="hidden" id="ordererPostcode" th:value="${userInfo.userPostcode}">
                <input type="hidden" id="ordererAddress" th:value="${userInfo.userAddress}">
                <input type="hidden" id="ordererDetailAddress" th:value="${userInfo.userSpecificAddress}">
                
                <!-- ë°°ì†¡ë¹„ ì •ë³´ë¥¼ hidden í•„ë“œë¡œ ì €ì¥ -->
                <input type="hidden" id="deliveryPrice" th:value="${orderSummary.deliverySum}">
            </div>
            
            <!-- ë°°ì†¡ ì •ë³´ -->
            <div class="delivery-info">
                <h3>ë°°ì†¡ ì •ë³´</h3>
                <label class="inline">
                    <input type="checkbox" id="sameAsOrderer"> ì£¼ë¬¸ì ì •ë³´ì™€ ë™ì¼
                </label>

                <div class="two-col">
                    <input type="text" id="receiverName" placeholder="ìˆ˜ë ¹ì¸">
                    <input type="tel" id="receiverPhone" placeholder="ì—°ë½ì²˜">
                </div>  

                <div class="two-col address-row">
                    <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button class="my-btn small-btn white-btn" onclick="daumPostcode()">ì£¼ì†Œì°¾ê¸°</button>
                </div>                
                <input type="text" id="address" placeholder="ì£¼ì†Œ" value="" readonly onclick="daumPostcode()">
                <input type="text" id="detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ" value="">

                <label class="memo-label" for="deliveryMemo">ë°°ì†¡ë©”ëª¨</label>                
                <select id="deliveryMemo">
                    <option value="">ë°°ì†¡ë©”ëª¨ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</option>
                    <option>ë°°ì†¡ ì „ì— ë¯¸ë¦¬ ì—°ë½ ë°”ëë‹ˆë‹¤.</option>
                    <option>ë¶€ì¬ì‹œ ê²½ë¹„ì‹¤ì— ë§¡ê²¨ì£¼ì„¸ìš”.</option>
                    <option>ë¶€ì¬ì‹œ ì „í™”ë‚˜ ë¬¸ìë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.</option>
                    <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
                </select>
                <input type="text" id="customMemo" placeholder="ë°°ì†¡ë©”ëª¨ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”." style="display: none;">
            </div>

            <!-- ì¶”ê°€ì •ë³´ ì…ë ¥ -->
            <div class="additional-info">
                <h3>ì¶”ê°€ì •ë³´ ì…ë ¥</h3>                
                <p class="notice">
                    <strong>ì œí’ˆ êµ¬ë§¤ë¥¼ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜â—</strong><br>
                    (1)ìˆ˜ì§‘ ë° ì´ìš© ëª©ì  - ì œí’ˆ ë°°ì†¡ ë° êµ¬ë§¤ ì„œë¹„ìŠ¤ ì œê³µ, ì£¼ë¬¸/ë°°ì†¡ ì •ë³´ ì•ˆë‚´, ê³ ì§€ì‚¬í•­ ì „ë‹¬. (2)ìˆ˜ì§‘ ë° ì´ìš© í•­ëª© - ì£¼ë¬¸ì ì •ë³´: ì„±ëª…/ì—°ë½ì²˜/ì´ë©”ì¼, ë°°ì†¡ ì •ë³´: ìˆ˜ë ¹ì¸ ì„±ëª…/ì—°ë½ì²˜/ì£¼ì†Œ. (3)ë³´ìœ  ë° ì´ìš©ê¸°ê°„ - ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì  ë‹¬ì„± í›„ ì¦‰ì‹œ íŒŒê¸°, íšŒì›ê°€ì… ê³ ê°ì˜ ê²½ìš° íšŒì›íƒˆí‡´ ì‹œê¹Œì§€. â€»ê·€í•˜ëŠ” ìœ„ì™€ ê°™ì´ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘ ë° ì´ìš©í•˜ëŠ” ê²ƒì„ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë™ì˜ë¥¼ ê±°ë¶€í•  ê²½ìš°, ì œí’ˆ ë°°ì†¡ ë° êµ¬ë§¤ ì„œë¹„ìŠ¤ ì œê³µì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>                <label class="inline">
                    <input type="checkbox" class="detail-agree" data-required="true"> <div>[í•„ìˆ˜] ë™ì˜</div>
                </label>
            </div>
        </section>

        <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
        <aside class="right-area">
            <div class="sticky-box" id="paySticky"> <!-- jsë¡œ footerë§Œë‚˜ë©´ sticky í•´ì œ -->                
                
                <!-- ì£¼ë¬¸ ìš”ì•½ -->
                <section class="summary">
                    <h3>ì£¼ë¬¸ ìš”ì•½</h3>                    
                    <ul>                        
                        <li><span>ìƒí’ˆê°€ê²©</span><strong th:text="${#numbers.formatDecimal(orderSummary.productSum, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></strong></li>
                        <li><span>ë°°ì†¡ë¹„</span><strong th:text="${orderSummary.deliverySum > 0 ? #numbers.formatDecimal(orderSummary.deliverySum, 0, 'COMMA', 0, 'POINT') + 'ì›' : 'ë¬´ë£Œ'}"></strong></li>
                        <li class="total"><span>ì´ ì£¼ë¬¸ê¸ˆì•¡</span><strong th:text="${#numbers.formatDecimal(orderSummary.finalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></strong></li>
                    </ul>
                </section>  

                <!-- ê²°ì œìˆ˜ë‹¨ -->
                <section class="pay-method">
                    <h3>ê²°ì œìˆ˜ë‹¨</h3>
                    <label th:if="${!isTossPay}"><input type="radio" name="paymentMethod" value="ì‹ ìš©ì¹´ë“œ" checked> ì‹ ìš©ì¹´ë“œ</label>
                    <label th:if="${!isTossPay}"><input type="radio" name="paymentMethod" value="ê°€ìƒê³„ì¢Œ"> ê°€ìƒê³„ì¢Œ</label>
                    <label th:if="${!isTossPay}"><input type="radio" name="paymentMethod" value="ì‹¤ì‹œê°„ê³„ì¢Œì´ì²´"> ì‹¤ì‹œê°„ê³„ì¢Œì´ì²´</label>
                    <label th:if="${isTossPay}"><input type="radio" name="paymentMethod" value="í† ìŠ¤í˜ì´" checked> í† ìŠ¤í˜ì´</label>
                </section>
                
                <!-- ë™ì˜ -->
                <section class="agreement">
                    <label class="inline">
                        <input type="checkbox" id="agreeAll"> ì „ì²´ ë™ì˜
                    </label>                    
                    <label class="indent inline">
                        <span class="indent-symbol">ã„´</span>
                        <input type="checkbox" class="detail-agree" data-required="true"> êµ¬ë§¤ì¡°ê±´ í™•ì¸ ë° ê²°ì œì§„í–‰ ë™ì˜
                    </label>
                </section> 

                <!-- ê²°ì œ ë²„íŠ¼ -->
                <button id="paymentButton" 
                        th:class="${isTossPay ? 'pay-btn my-btn big-btn toss-btn' : 'pay-btn my-btn big-btn black-btn'}"
                        th:data-amount="${orderSummary.finalPrice}"
                        th:data-iamport-code="${paymentConfig.iamportMerchantCode}"
                        th:data-pg-provider="${paymentConfig.pgProvider}"
                        th:data-order-name="${paymentConfig.orderName}">
                    <span th:if="${!isTossPay}" th:text="${#numbers.formatDecimal(orderSummary.finalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì› ê²°ì œí•˜ê¸°'"></span>                    
                    <span th:if="${isTossPay}">
                        <img th:src="@{/assets/img/payment/toss.png}" alt="í† ìŠ¤í˜ì´" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                        <span th:text="${#numbers.formatDecimal(orderSummary.finalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì› í† ìŠ¤í˜ì´ë¡œ ê²°ì œí•˜ê¸°'"></span>
                    </span>
                </button>
            </div>
        </aside>
    </div>
</main>
```
- ì´ì œ ì—¬ê¸°ì„œ ê²°ì œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ jsì—ì„œ pgì‚¬ë¡œ ê²°ì œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ëœë‹¤.
- ì•„ë˜ëŠ” í•´ë‹¹ ë²„íŠ¼ì— ì—°ê²°ëœ ê²°ì œ ì§„í–‰ ë²„íŠ¼ì´ê³  ì£¼ë¬¸ì„œì— ì €ì¥ë˜ì–´ìˆë˜ ê²°ì œ ì •ë³´ë“¤ì„ ëª¨ì•„ì„œ jsë¡œ ë³´ë‚´ì–´ ê²°ì œ ìš”ì²­ì— í¬í•¨í•˜ì—¬ ë³´ë‚´ë©´ pgì—ì„œ ê²°ì œ ì°½ì„ ë„ì›Œì£¼ê³  ê²°ì œê°€ ì§„í–‰ë˜ê²Œ ëœë‹¤. 
- ë§Œì•½ pgì‚¬ì—ì„œ ê²°ì œê°€ ì„±ê³µí–ˆë‹¤ëŠ” ì‘ë‹µì´ ì˜¤ë©´ jsì—ì„œ ê²°ì œ ì™„ë£Œ ì ˆì°¨ë¥¼ ì§„í–‰í•˜ëŠ” js í•¨ìˆ˜ì¸ completePayment ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.
```js
// ì•„ì„í¬íŠ¸ ì´ˆê¸°í™”
    const IMP = window.IMP;
    const iamportCode = paymentButton.dataset.iamportCode;
    const pgProvider = paymentButton.dataset.pgProvider; // ë°±ì—”ë“œì—ì„œ ê²°ì •ëœ PG ì œê³µì ì‚¬ìš©
    const orderName = paymentButton.dataset.orderName;
    
    IMP.init(iamportCode); // ì„œë²„ì—ì„œ ì „ë‹¬ëœ ê³ ê°ì‚¬ ì‹ë³„ì½”ë“œ ì‚¬ìš©
    
    // ê²°ì œ ìš”ì²­
    IMP.request_pay({
        pg: pgProvider, // ì„œë²„ì—ì„œ ì „ë‹¬ëœ PG ì œê³µì ì‚¬ìš©
        pay_method: pgMethod,
        merchant_uid: orderNumber, // ì£¼ë¬¸ë²ˆí˜¸ë¥¼ merchant_uidë¡œ ì‚¬ìš©
        name: orderName, // ì„œë²„ì—ì„œ ì „ë‹¬ëœ ê²°ì œëª… ì‚¬ìš©
        amount: totalAmount, // ê²°ì œê¸ˆì•¡
        buyer_email: ordererEmailEl ? ordererEmailEl.value : '',
        buyer_name: receiverNameEl.value,
        buyer_tel: receiverPhoneEl.value,
        buyer_addr: addressEl.value + ' ' + detailAddressEl.value,
        buyer_postcode: postcodeEl.value
    }, async function(paymentResponse) {
        if (paymentResponse.success) {                 
            // ì„œë²„ì— ê²°ì œ ì™„ë£Œ ì •ë³´ ì „ì†¡
            await completePayment(orderNumber, deliveryMemo, paymentMethod.value, paymentResponse);
        } else {
            // ê²°ì œ ì‹¤íŒ¨
            alert('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\n' + paymentResponse.error_msg);
        }
    });
```
- completePaymentë©”ì„œë“œì—ì„  ê²°ì œ ì™„ë£Œì‹œì— ìµœì¢… ì£¼ë¬¸ì„œì˜ ì •ë³´ë“¤ì„ ëª¨ì•„ì„œ ìµœì¢… ì£¼ë¬¸ ê²€ì¦ì„ ë°±ì—”ë“œì— ìš”ì²­í•œë‹¤.
- ì´ë•Œ ê²€ì¦ìš”ì²­ì„ êµ³ì´ ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬í•˜ëŠ” ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
- ë³´ì•ˆì„±: ê²°ì œëŠ” ë³´ì•ˆì´ ê°€ì¥ ì¤‘ìš”í•œ ì˜ì—­ -> ì‹¤ì œ dbì •ë³´ì™€ ë°”ë¡œ ë¹„êµê°€ëŠ¥, apií‚¤ ìì²´ë„ í”„ë¡ íŠ¸ë¡œ ë”°ë¡œ ì•ˆë³´ë‚´ê³  ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ê°€ëŠ¥ ë‚˜ë¨¸ì§€ëŠ” ì™¸ë¶€ ì½”ë“œì—ì„œí•´ë„ ê²€ì¦ì€ ë°±ì—”ë“œ ìì²´ì ìœ¼ë¡œ í•œë²ˆì€ í•  í•„ìš”ê°€ ìˆìŒ.
- ì‹ ë¢°ì„±: PGì‚¬ë„ ë°±ì—”ë“œ ê²€ì¦ì„ ê¶Œì¥
- ê·œì • ì¤€ìˆ˜: ì „ììƒê±°ë˜ë²•ìƒ ì„œë²„ ê²€ì¦ í•„ìš”
- ìœ ì§€ë³´ìˆ˜: ê²€ì¦ ë¡œì§ì´ í•œ ê³³ì— ì§‘ì¤‘ë¨
- paymentResponseì—ëŠ” ê²°ì œê°€ ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ê²°ì œê±´ì˜ ê³ ìœ  ì •ë³´ë“¤ì´ ë“¤ì–´ìˆë‹¤.
```js
// ì•½ê´€ ë™ì˜ í™•ì¸
    const purchaseTerm = Array.from(document.querySelectorAll('.detail-agree[data-required="true"]')).every(cb => cb.checked);
    
    // ë°°ì†¡ë¹„ ê°€ì ¸ì˜¤ê¸° (hidden inputì—ì„œ)
    const deliveryPriceEl = document.getElementById('deliveryPrice');
    const deliveryPrice = deliveryPriceEl ? parseInt(deliveryPriceEl.value) || 0 : 0;
    
    // FormData ìƒì„±
    const formData = new FormData();
    formData.append('orderNumber', orderNumber);
    formData.append('receiverName', receiverNameEl.value);
    formData.append('receiverPhone', receiverPhoneEl.value);
    formData.append('receiverPostcode', postcodeEl.value);
    formData.append('receiverAddress', addressEl.value);
    formData.append('receiverDetailAddress', detailAddressEl.value);
    formData.append('deliveryMemo', deliveryMemo);
    formData.append('paymentMethod', paymentMethod);
    formData.append('purchaseTerm', purchaseTerm);
    formData.append('deliveryPrice', deliveryPrice);
    
    // ì•„ì„í¬íŠ¸ ê²°ì œ ì •ë³´ ì¶”ê°€
    formData.append('impUid', paymentResponse.imp_uid);
    formData.append('merchantUid', paymentResponse.merchant_uid);
    formData.append('paidAmount', paymentResponse.paid_amount);
    
    // êµ¬ë§¤ì ì´ë©”ì¼ ì •ë³´ ì¶”ê°€
    const buyerEmail = ordererEmailEl ? ordererEmailEl.value : '';
    formData.append('buyerEmail', buyerEmail);
    
    // ê²°ì œ ì™„ë£Œ API í˜¸ì¶œ
    const response = await fetch('/api/payment/complete', {
        method: 'POST',
        body: formData
    });
    
    const result = await response.json();
    
    if (result.success) {
        alert('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        // ì„±ê³µ í˜ì´ì§€ë¡œ ì´ë™ 
        window.location.href = `/payment/success?orderNumber=${orderNumber}`;
    } else {
        // ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        alert(result.message);
    }
```
- í•´ë‹¹ apië¡œ ê²€ì¦ì„ ìš”ì²­í•˜ë©´ ì•„ë˜ì˜ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤.
- paymentService.verifyPaymentWithBuyerInfo í•´ë‹¹ ë©”ì„œë“œë¥¼ í†µí•´ ì²˜ìŒ paymentResponseë¡œ ëŒë ¤ë°›ì•˜ë˜ impUid ì¦‰ ê²°ì œ ê³ ìœ  idì™€ impUidì™€ ì£¼ë¬¸ë²ˆí˜¸ì¸ merchant_uidë¥¼ í™œìš©í•˜ì—¬ ê²°ì œì •ë³´ë¥¼ ê²€ì¦í•œë‹¤.
- paymentService.verifyPaymentWithBuyerInfoì˜ ë‚´ë¶€ë¡œì§ì€ ìš°ì„  apií‚¤ì™€ secret keyë¥¼ ì´ìš©í•´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í† í°ì„ ë¶€ì—¬ë°›ê³  ì´ í† í°ê³¼ ê²°ì œê±´ ê³ ìœ  ì•„ì´ë””ë¥¼ í†µí•´ ê²°ì œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ì‹¤ì œ db ë‚´ë¶€ì˜ ê°’(ê¸ˆì•¡, ì£¼ë¬¸ë²ˆí˜¸)ê³¼ ë¹„êµí•œë‹¤.
- ë˜í•œ ì£¼ë¬¸ì„œì— ìƒˆë¡œ ì“°ì—¬ì§ˆ ë‚´ìš© (ìƒˆë¡œìš´ ê²°ì œë°©ë²•, ì£¼ì†Œ ë“±)ë„ pgì‚¬ì˜ ì •ë³´ì™€ ë§ëŠ”ì§€ ëŒ€ì¡°í•´ë³¸ë‹¤.
- ì´í›„ ê²€ì¦ì„ í†µê³¼í•˜ë©´ ìµœì¢… ì£¼ë¬¸ì„œë¥¼ ì™„ì„±í•˜ì—¬ dbì— ì €ì¥í•˜ê³  ì„±ê³µ ì‘ë‹µì„ ëŒë ¤ì¤€ë‹¤.
- í† ìŠ¤í˜ì´ê°€ ì‹ ìš©ì¹´ë“œ, ì‹¤ì‹œê°„ ê³„ì¢Œì´ì²´ë“± ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì„ í—ˆìš©í•´ì„œ ì˜¤ë¥˜ê°€ ë‚¬ì—ˆëŠ”ë° ê·¸ ëª¨ë“  ë°©ë²•ì— ë§ê²Œ í†µê³¼ì‹œì¼œ ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ì˜€ë‹¤.
```java
@PostMapping("/api/payment/complete")
    @Transactional(rollbackFor = Exception.class)
    public ResponseEntity<ResponseDTO> completePayment(
            @RequestParam(value = "orderNumber") String orderNumber,
            @RequestParam(value = "receiverName") String receiverName,
            @RequestParam(value = "receiverPhone") String receiverPhone,
            @RequestParam(value = "receiverPostcode") String receiverPostcode,
            @RequestParam(value = "receiverAddress") String receiverAddress,
            @RequestParam(value = "receiverDetailAddress") String receiverDetailAddress,
            @RequestParam(value = "deliveryMemo", required = false) String deliveryMemo,
            @RequestParam(value = "paymentMethod") String paymentMethod,
            @RequestParam(value = "purchaseTerm") boolean purchaseTerm,
            @RequestParam(value = "deliveryPrice") int deliveryPrice,
            @RequestParam(value = "impUid", required = false) String impUid,
            @RequestParam(value = "buyerEmail", required = false) String buyerEmail,
            @SessionAttribute("memberInfo") User member) throws Exception {
                
                String validReceiverName = validationManager.validateName(receiverName);
                String validReceiverPhone = validationManager.validatePhone(receiverPhone);
                String validReceiverPostcode = validationManager.validatePostcode(receiverPostcode);
                String validReceiverAddress = validationManager.validateAddress(receiverAddress);
                String validReceiverDetailAddress = validationManager.validateAddressDetail(receiverDetailAddress, receiverAddress);
                    
                    // í•„ìˆ˜ ì•½ê´€ ë™ì˜ ê²€ì¦
                    if (!purchaseTerm) {
                        throw new InvalidFormatException("í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.");
                    }
                    
                    // ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ ë° ì†Œìœ ì í™•ì¸
                    Order order = paymentService.getOrderByNumber(orderNumber);
                    if (order == null) {
                            throw new InternalServerErrorException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ë¬¸ì…ë‹ˆë‹¤.");
                    }
                    
                    if (order.getUserId() != member.getUserId()) {
                            throw new InternalServerErrorException("í•´ë‹¹ ì£¼ë¬¸ì— ëŒ€í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                    }
                    
                    // ì£¼ë¬¸ ìƒíƒœê°€ "ê²°ì œëŒ€ê¸°ì¤‘"ì¸ì§€ í™•ì¸
                    if (!"ê²°ì œëŒ€ê¸°ì¤‘".equals(order.getOrderStatus())) {
                            throw new InternalServerErrorException("ì´ë¯¸ ì²˜ë¦¬ëœ ì£¼ë¬¸ì…ë‹ˆë‹¤.");
                    }
                    
                    // ì•„ì„í¬íŠ¸ ê²°ì œ ê²€ì¦
                    if (impUid != null) {
                        // ì˜ˆìƒ ê²°ì œ ê¸ˆì•¡ ê³„ì‚° (ìƒí’ˆ ê¸ˆì•¡ + ë°°ì†¡ë¹„)
                        BigDecimal expectedAmount = BigDecimal.valueOf(order.getOrderPrice() + deliveryPrice);
                        
                        // êµ¬ë§¤ì ì •ë³´ ì¡°í•©
                        String buyerAddr = validReceiverAddress + " " + validReceiverDetailAddress;
                        String finalBuyerEmail = (buyerEmail != null && !buyerEmail.trim().isEmpty()) ? buyerEmail.trim() : "";
                        
                        // ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ì„ íƒí•œ ê²°ì œ ë°©ë²• ì‚¬ìš©
                        String merchantUid = order.getOrderNumber(); // ì£¼ë¬¸ë²ˆí˜¸
                        
                        // ì•„ì„í¬íŠ¸ ê²°ì œ ê²€ì¦ (PG ì½”ë“œë¡œ ì§ì ‘ ê²€ì¦)
                        if (!paymentService.verifyPaymentWithBuyerInfo(impUid, merchantUid, expectedAmount, paymentMethod,
                                validReceiverName, validReceiverPhone, finalBuyerEmail, buyerAddr, validReceiverPostcode)) {
                            throw new InternalServerErrorException("ê²°ì œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                        }
                    }
                    
                      // ë°°ì†¡ ì •ë³´ ì—…ë°ì´íŠ¸ (ê²€ì¦ëœ ê°’ ì‚¬ìš©)
                    order.setReceiverName(validReceiverName);
                    order.setReceiverPhone(validReceiverPhone);
                    order.setReceiverPostcode(validReceiverPostcode);
                    order.setReceiverAddress(validReceiverAddress);
                    order.setReceiverSpecificAddress(validReceiverDetailAddress);
                    
                    // ë°°ì†¡ë©”ëª¨ ì²˜ë¦¬: ë¹ˆ ë¬¸ìì—´ì´ê±°ë‚˜ ê¸°ë³¸ ì„ íƒê°’ì¸ ê²½ìš° nullë¡œ ì²˜ë¦¬
                    if (deliveryMemo == null || deliveryMemo.trim().isEmpty() || 
                        "ë°°ì†¡ë©”ëª¨ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.".equals(deliveryMemo.trim())) {
                        order.setReceiverMemo(null);
                    } else {
                        order.setReceiverMemo(deliveryMemo.trim());
                    }
                    
                    // PG ì½”ë“œë¥¼ í•œêµ­ì–´ë¡œ ë³€í™˜í•´ì„œ DBì— ì €ì¥
                    String koreanPaymentMethod = convertPGCodeToKorean(paymentMethod);
                    order.setPurchaseMethod(koreanPaymentMethod);
                    order.setPurchaseTerm(purchaseTerm);
                    order.setDeliveryPrice(deliveryPrice);
                    order.setOrderStatus("ë°°ì†¡ì¤€ë¹„ì¤‘");
                    
                    // ì£¼ë¬¸ ì •ë³´ ì—…ë°ì´íŠ¸
                    paymentService.updateOrderForPayment(order);
                    
                    // ì£¼ë¬¸ ì™„ë£Œ í›„ í•´ë‹¹ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
                    paymentService.removeOrderedItemsFromCart(orderNumber);
                    
                    // ì‘ë‹µ ë°ì´í„° êµ¬ì„±
                    Map<String, Object> responseData = new HashMap<>();
                    responseData.put("orderNumber", orderNumber);
                    
                    ResponseDTO response = ResponseDTO.builder()
                            .success(true)
                            .message("ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
                            .data(responseData)
                            .timestamp(LocalDateTime.now())
                            .build();                    
            return ResponseEntity.ok(response);
        }
```
- ì´í›„ ì„±ê³µì‘ë‹µì„ ë°›ì€ jsëŠ” ê²°ì œ ì„±ê³µ í™”ë©´ì„ ì£¼ë¬¸ì„œë¥¼ í†µí•´ ë„ìš°ê¸° ìœ„í•´ ì•„ë˜ì²˜ëŸ¼ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ í¬í•¨í•˜ì—¬ ì£¼ë¬¸ì„±ê³µ í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ìš”ì²­ì„ ë³´ë‚´ë©´ì„œ ê²°ì œ ê³¼ì •ì´ ëë‚˜ê²Œ ëœë‹¤.
```js
window.location.href = `/payment/success?orderNumber=${orderNumber}`;
```