# 📌 1. ANOVA와 회귀에서의 F검정
1. 회귀모형 F검정 vs ANOVA F검정
(1) 공통점

F통계량 구조는 같다:

𝐹
=
설명된 변동 / 자유도
설명 못한 변동 / 자유도

결국 “모델(또는 그룹)이 설명하는 힘 vs 오차”의 비율을 보는 것.

귀무가설은 항상 ‘효과 없음’ → 회귀: “변수 영향 없음”, ANOVA: “평균 차이 없음”.

(2) 차이점

회귀에서의 F검정

귀무가설: “모든 계수 β = 0 (독립변수가 종속변수에 전혀 영향 없음)”

대립가설: “최소한 하나의 계수는 ≠ 0 (적어도 하나는 영향 있음)”

활용: 모델 전체가 유의한가? → 회귀계수들을 추가할 가치가 있는가?

ANOVA에서의 F검정

귀무가설: “모든 그룹 평균이 같다”

대립가설: “적어도 하나의 그룹 평균은 다르다”

활용: 집단 간 차이가 유의한가? → 교육 방법, 치료 방법, 반별 차이 등 비교

👉 수학적으로는 같은 구조지만, 회귀는 변수의 효과, ANOVA는 집단 평균 비교라는 해석 차이가 있다.


# 📌 2. 최소제곱법(OLS)·자유도·ANOVA/F검정 

## 1) 목표와 기본 개념
- **모델(단순회귀 예)**: \(\hat y=\beta_0+\beta_1 x\)  
  (다중회귀: \(\hat y=\beta_0+\beta_1 x_1+\cdots+\beta_p x_p\))
- **잔차**: \(e_i = y_i - \hat y_i\)
- **최소제곱법(OLS)**: \(\sum_{i=1}^n e_i^2\) (잔차제곱합)을 **최소**로 만드는 \(\beta\)들을 찾는다.

---

## 2) OLS의 ‘균형’ 조건(정규방정식)
- **세로 위치 균형(절편 조건)**  
  \[
  \sum_{i=1}^n e_i = 0
  \]
  → 회귀식은 \((\bar x,\bar y)\)를 지난다.  
  (다중회귀 일반형: \(\beta_0=\bar y-\sum_{k=1}^p\beta_k\bar x_k\))

- **기울기 균형(각 설명변수 방향)**  
  \[
  \sum_{i=1}^n e_i x_{ki} = 0 \quad(k=1,\dots,p)
  \]
  → 잔차가 각 \(x_k\)와 **상관 0**이 되도록 기울기가 맞춰진 상태.

> 직관: **세로 위치**를 맞춰서 위/아래 잔차의 합이 0, **기울기**를 맞춰서 좌/우(설명변수 방향)로 잔차의 추세가 0.

---

## 3) 제곱합 분해(변동의 쪼개기)
- **전체 변동**: \(\displaystyle \text{SST}=\sum_{i=1}^n (y_i-\bar y)^2\)
- **설명된 변동**: \(\displaystyle \text{SSR}=\sum_{i=1}^n (\hat y_i-\bar y)^2\)
- **설명 못한 변동(오차)**: \(\displaystyle \text{SSE}=\sum_{i=1}^n (y_i-\hat y_i)^2\)

\[
\boxed{\text{SST}=\text{SSR}+\text{SSE}}
\]

- **결정계수**: \(\displaystyle R^2=\frac{\text{SSR}}{\text{SST}}=1-\frac{\text{SSE}}{\text{SST}}\)

---

## 4) 자유도(df)가 왜 그렇게 되나
- **총 자유도**: \(n-1\)  
  (평균 1개를 이미 썼기 때문: \(\sum_{i=1}^n(y_i-\bar y)=0\))

- **모형(설명된) 자유도**: \(p\)  
  \[
  \hat y-\bar y=\sum_{k=1}^p \beta_k \big(x_k-\bar x_k\big)
  \]
  → 평균을 뺀 예측값의 ‘흔들림’은 **중심화된 \(p\)개 변수의 결합**으로만 만들어짐.  
  → 변동을 만드는 **독립 방향 수가 \(p\)**.

- **오차 자유도**: \(n-p-1\)  
  잔차는 \(\sum e_i=0,\ \sum e_i x_{ki}=0\) (총 \(p+1\)개 조건)을 **반드시** 만족.  
  → \(n\)개 중 \(p+1\)개가 묶임 → \(n-(p+1)\).

> 정리: \(\;n-1 = p + (n-p-1)\) 이고, SS와 df가 1:1로 짝을 이룬다.

---

## 5) 평균제곱(MS)와 F검정(회귀 전체 유의성)
- \(\text{MS}_{\text{model}}=\text{SSR}/p\)  
- \(\text{MS}_{\text{error}}=\text{SSE}/(n-p-1)\)

- **F통계량(회귀 전체)**:
\[
F=\frac{\text{MS}_{\text{model}}}{\text{MS}_{\text{error}}}
=\frac{\text{SSR}/p}{\text{SSE}/(n-p-1)}
\sim F\big(p,\;n-p-1\big)
\]

- **R²와의 연결**:
\[
F=\frac{(R^2/p)}{(1-R^2)/(n-p-1)}
\]
→ “설명한 비율 대 남은 비율”을 **공정하게(df로 나눠)** 비교.

- **해석**: \(F\)가 클수록 \(p\)-값이 작아짐 → **모형 전체가 유의**(적어도 하나의 \(\beta_k\neq 0\)).

---

## 6) ANOVA(일원배치)와의 대응
- 집단 수 \(k\), 총 \(n\):
  - **집단 간**: \(\text{SSB}\), df \(=k-1\)
  - **집단 내**: \(\text{SSE}\), df \(=n-k\)
  - \(F=\dfrac{\text{MSB}}{\text{MSE}}=\dfrac{\text{SSB}/(k-1)}{\text{SSE}/(n-k)}\)

- **더미변수 회귀와 동등**:  
  더미를 쓰면 \(p=k-1\), \(\text{SSR}=\text{SSB}\), \(\text{SSE}=\text{SSE}\), df도 동일 → **같은 F, 같은 결론**.

---

## 7) 실무 팁
- **스케일 다르면** 표준화(또는 상관행렬 기반)로 공정한 축 선택.  
- **과적합 주의**: 변수 추가 시 \(R^2\)는 보통↑ → **보정 \(R^2\)**와 교차검증으로 점검.  
- **가정 점검**: 선형성·정규성·등분산·독립성. 위반 시 변환, 가중/로버스트 회귀, Welch ANOVA 등 고려.

---

## 8) 초간단 기억장치
- **OLS 최적조건**: \(\sum e_i=0\) & \(\sum e_i x_{ki}=0\)  
- **분해**: \(\text{SST}=\text{SSR}+\text{SSE}\), \(\;n-1=p+(n-p-1)\)  
- **F**: \((\text{설명 MS})/(\text{오차 MS})\)  
- **ANOVA=더미회귀**: \(k-1 \leftrightarrow p\)
