# ğŸ“Œ 0. ë³´ìŠ¤ í´ë¡ ì½”ë”©
### ğŸ“Œ 0-1. ê²€ìƒ‰ì–´ê°€ ì—†ì„ ê²½ìš° ì „ì²´ ìƒí’ˆ ì¡°íšŒ ë¡œì§ì„ ë”°ë¡œ ë¶„ë¦¬
- ì›ë˜ ê³µë°±ì´ ë“¤ì–´ì˜¤ë©´ ê³µë°±ìœ¼ë¡œ like ì—°ì‚°ì„ í•  ì…ˆì´ì—ˆì§€ë§Œ ê²€ìƒ‰ì–´ê°€ ì—†ì„ë•Œì˜ ë¡œì§ì„ ë¶„ë¦¬í•˜ë©´ ì¤‘ê°„ì— í† í¬ë‚˜ì´ì¦ˆ í•˜ê³  í•˜ëŠ” ë¡œì§ì„ ë§ì´ ì‚­ì œí•  ìˆ˜ ìˆì–´ ì´ë ‡ê²Œ í•˜ëŠ”ê²Œ ì¢‹ì€ ê±° ê°™ë‹¤.
- if (inputKeyword.isEmpty()) ë“¤ì–´ì˜¨ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ list = mainSearchService.getAllProducts(sort);ë¡œ ì „ì²´ ìƒí’ˆì„ ì¡°íšŒí•˜ë„ë¡ í•˜ì˜€ë‹¤.
- @RequestParam(value = "keyword", defaultValue = "")ë¥¼ í†µí•´ì„œ nullì„ ì›ì²œ ì°¨ë‹¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ nullì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. í•˜ì—¬ ê´€ë ¨ ë¡œì§ì„ ì‚­ì œí•˜ì˜€ë‹¤.
- ê¸°ì¡´ì˜ List<Product> list = List.of(); // ê¸°ë³¸ê°’ì„ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™” ê°€ ì–´ì§œí”¼ ë¬´ì¡°ê±´ í• ë‹¹ë˜ë¯€ë¡œ í•´ë‹¹ ë¡œì§ì„ ì‚­ì œí•˜ì˜€ë‹¤.
- List<Product> list; ë¡œ ë³€ê²½í•˜ì˜€ë‹¤.
```java
@Controller
@RequiredArgsConstructor
public class MainSearchController {

    private final MainSearchService mainSearchService;

    @GetMapping("/main-search")
    public String search(@RequestParam(value = "keyword", defaultValue = "") String keyword,
                        @RequestParam(name="sort", defaultValue="accuracy") String sortRaw,
                        Model model) throws Exception {

        SearchSort sort = SearchSort.from(sortRaw);
        List<Product> list = List.of(); // ê¸°ë³¸ê°’ì„ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™”
        
        // ê²€ìƒ‰ì–´ ìœ íš¨ì„± ê²€ì‚¬
        String inputKeyword = keyword.trim() : "";
        
        if (inputKeyword.isEmpty()) {
            // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ìƒí’ˆ ì¡°íšŒ
            list = mainSearchService.getAllProducts(sort);
        } else {
            // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í† í¬ë‚˜ì´ì¦ˆëœ ê²€ìƒ‰ ì‹¤í–‰
            list = mainSearchService.tokenizedSearch(inputKeyword, sort);
        }

        model.addAttribute("keyword", inputKeyword);
        model.addAttribute("sort", sort.getValue());
        model.addAttribute("products", list);
        model.addAttribute("resultCount", list.size());

        return "main_search/index";
    }
}
```

#### ğŸ“Œ 0-2. ì „ì²´ ìƒí’ˆì„ ì¡°íšŒí•˜ê¸° ìœ„í•œ ë©”ì„œë“œ ìƒˆë¡œ ì •ì˜
- tokenizedSearchëŠ” ê¸°ì¡´ì— í† í¬ë‚˜ì´ì¦ˆí•˜ë˜ ë©”ì„œë“œì´ë‹¤.
- getAllProductsëŠ” ì˜¤ë¡œì§€ ìµœì‹ ìˆœìœ¼ë¡œë§Œ ì „ì²´ ìƒí’ˆì„ ì¡°íšŒí•˜ê¸° ìœ„í•œ ë©”ì„œë“œì´ë‹¤.
- í•´ë‹¹ ë©”ì„œë“œëŠ” ìµœì‹  ìˆœì´ë©´ ìµœì‹ ìˆœìœ¼ë¡œ ì¡°íšŒí•˜ê³  ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì´ë¦„ìˆœìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•œë‹¤.
- ë¹ˆê²€ìƒ‰ì–´ë¥¼ í† í¬ë‚˜ì´ì¦ˆí•  ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. 
```java
@Service
@RequiredArgsConstructor
public class MainSearchServiceImpl implements MainSearchService {

    private final ProductMapper mapper;

    @Override
    public List<Product> tokenizedSearch(String keyword, SearchSort sort) throws Exception {

        // í† í¬ë‚˜ì´ì¦ˆ(ê³µë°± ê¸°ì¤€ìœ¼ë¡œ)
        String[] tokens = keyword.trim().split("\\s+");

        // ê° í† í°ì„ LIKE íŒ¨í„´ìœ¼ë¡œ ë³€í™˜  (%í† í°%)
        List<String> patterns = Arrays.stream(tokens)
            .map(this::escapeLike)     // ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìë¥¼ ë¶™ì„
            .map(t -> "%" + t + "%")   // ì–‘ìª½ % ì¶”ê°€ -> like ê²€ìƒ‰ì„ ìœ„í•œ íŒ¨í„´
            .toList(); 

        // Mapper í˜¸ì¶œ â€“ í† í°, íŒ¨í„´, ì •ë ¬ ì „ë‹¬
        List<Product> result = mapper.searchProducts(tokens, patterns, sort);
        return result;
    }

    @Override
    public List<Product> getAllProducts(SearchSort sort) throws Exception {
        // ì „ì²´ ìƒí’ˆì„ ì •ë ¬ëœ ìˆœì„œë¡œ ì¡°íšŒ
        List<Product> result = mapper.getAllProducts(sort);
        return result;
    }

    /** %, _, !ë¥¼ ì´ìŠ¤ì¼€ì´í”„ì‹œí‚¤ê¸° ìœ„í•œ ë©”ì„œë“œ */
    private String escapeLike(String src){
        return src.replace("!", "!!")
                    .replace("%","!%")
                    .replace("_","!_");
    }
}
```

### ğŸ“Œ 0-3. ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ë¡œê·¸ì•„ì›ƒì— ì ‘ê·¼í•  ê²½ìš° jsê°€ ë¡œê·¸ì•„ì›ƒ ì„ íƒìë¥¼ ëª»ì°¾ëŠ” ë¬¸ì œ
- ì²˜ìŒì— ë¡œê·¸ì¸ì´ ì•ˆëœ ìƒíƒœë¡œ ì ‘ê·¼í•˜ë¯€ë¡œ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì€ ê·¸ë•Œ jsê°€ ë‹¤ ë§¤í•‘ë˜ì§€ë§Œ ë¡œê·¸ì•„ì›ƒì€ ë§¤í•‘ë˜ì§€ ì•Šì•˜ë‹¤. 
- í•˜ì—¬ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ë° ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì€ htmlì—ì„œ ë°”ë¡œ í˜ì´ì§€ ì´ë™ì´ ì¼ì–´ë‚˜ì„œ ìƒê´€ì—†ì—ˆì§€ë§Œ ë¡œê·¸ì•„ì›ƒì€ ê±°ê¸°ì„œ ë°”ë¡œ ëª¨ë‹¬ì„ ë„ì›Œì•¼í•´ì„œ ë¬¸ì œê°€ ìƒê²¼ë˜ ê²ƒì´ë‹¤.
- í•˜ì—¬ logoutButtonì´ ì—†ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•˜ì—¬ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ í”¼í•´ê°”ë‹¤.
```js
const logoutButton = document.querySelector(".logout");
if (logoutButton) {
    logoutButton.addEventListener("click", async (e) => {
        try {
            const response = await fetch('/api/logout', {
                method: 'POST'
            });

            const json = await response.json();

            if (json.success) {
                alert(json.message);
                window.location.href = "/main";
            } else {
                alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: " + json.message);
                window.location.href = "/main";
            }
        } catch (err) {
            console.error("ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨", err);
            alert("ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    });
}
```

### ğŸ“Œ 0-4. ë©”ì¸ ê²€ìƒ‰ ëª¨ë‹¬
- cssì—ì„œ ì²œì²œíˆ ì—´ê¸° ìœ„í•´ì„œ setTimeoutì„ ì ìš©í•˜ì—¬ íŠ¸ëœì§€ì…˜ì´ ì ìš©ë˜ì–´ ì²œì²œíˆ ì—´ë¦´ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.
- í¬ì»¤ìŠ¤ë„ ëª¨ë“  ì¼ì´ ëë‚œ ì ê¹ì˜ ì‹œê°„ ì´í›„ì— ë¶€ì—¬í•œë‹¤.
```js
// ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸°, ë‹«ê¸° ì…ë‹ˆë‹¤ !!!

// ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
function openSearchModal() {
    const modal = document.getElementById('searchModal');
    if (modal) {
        modal.style.display = 'flex';
        // ë¸Œë¼ìš°ì €ê°€ ìŠ¤íƒ€ì¼ì„ ì ìš©í•  ì‹œê°„ì„ ì£¼ê¸° ìœ„í•´ setTimeout ì‚¬ìš©
        setTimeout(() => {
            modal.classList.add('show');
        }, 10);
        document.body.style.overflow = 'hidden';
        console.log('ëª¨ë‹¬ ì—´ë¦¼');
        
        setTimeout(() => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.focus();
            }
        }, 400); // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í¬ì»¤ìŠ¤
    }
}
```
- ëª¨ë‹¬ì„ ë‹«ì„ ë•Œë„ ì—ë‹ˆë©”ì´ì…˜ ì‹œê°„ì— ë§ì¶° ë‹«ëŠ”ë‹¤. 
- document.body.style.overflow = 'hidden';ë¡œ ìŠ¤í¬ë¡¤ì„ ë©ˆì¶°ë†¨ìœ¼ë¯€ë¡œ ëª¨ë‹¬ì„ ë‹«ìœ¼ë©´ì„œ ìŠ¤í¬ë¡¤ì„ ë‹¤ì‹œ í’€ì–´ì¤€ë‹¤.
- ëª¨ë‹¬ì„ ë‹«ì„ë•Œ inputê°’ì´ ìˆë‹¤ë©´ ë¹„ì›Œì¤€ë‹¤.
```js
// ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
function closeSearchModal() {
    const modal = document.getElementById('searchModal');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.style.display = 'none';
        }, 400); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ì— ë§ì¶¤
        document.body.style.overflow = '';
        
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = '';
        }
    }
}
```
- EscapeëŠ” escì´ê³  ë‹«ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ escë¥¼ ëˆ„ë¥´ê±°ë‚˜ ì˜¤ë²„ë ˆì´ ë°”ê¹¥ì˜ì—­ì„ ëˆŒë €ì„ë•Œ ë‹«í ìˆ˜ ìˆë„ë¡ í•œë‹¤.
```js
// ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸° ë²„íŠ¼
const openBtn = document.getElementById('openSearchModal');
if (openBtn) {
    openBtn.addEventListener('click', function(e) {
        e.preventDefault();
        openSearchModal();
    });
}

// ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
const searchCloseBtn = document.getElementById('search-modal-close');
if (searchCloseBtn) {
    searchCloseBtn.addEventListener('click', function() {
        closeSearchModal();
    });
}

// ì˜¤ë²„ë ˆì´ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
const modal = document.getElementById('searchModal');
if (modal) {
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeSearchModal();
        }
    });
}

// ESC í‚¤ë¡œ ë‹«ê¸°
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('searchModal');
        if (modal && modal.classList.contains('show')) {
            closeSearchModal();
        }
    }
});
```
- submit ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ëª¨ë‹¬ì„ ë‹«ëŠ” ì²˜ë¦¬ë¥¼ í•œë‹¤.
```js
// ê²€ìƒ‰ í¼ ì œì¶œ (ëª¨ë‹¬ ë‹«ê¸°ë§Œ ì²˜ë¦¬)
const searchForm = document.getElementById('searchForm');

if (searchForm) {
    searchForm.addEventListener('submit', function(e) {
        // í¼ ì œì¶œ ì „ì— ëª¨ë‹¬ì„ ì¦‰ì‹œ ë‹«ê¸° (ì• ë‹ˆë©”ì´ì…˜ ì—†ì´)
        const modal = document.getElementById('searchModal');
        if (modal) {
            modal.style.display = 'none';
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }
        return true;
    });
}
```

### ğŸ“Œ 0-5. ì¤‘ë³µ idê°€ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ë¡œ ì°¾ì€ ìš”ì†Œë§Œ ë°˜í™˜ëœë‹¤.
- toggleì€ ì¡°ê±´ì´ trueë©´ í´ë˜ìŠ¤ ì¶”ê°€ ì¦‰ resetBtn.classList.toggle('show', this.value.trim().length > 0);ì—ì„œ ì…ë ¥ê°’ì´ ìˆìœ¼ë©´ show í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ë¦¬ì…‹ë²„íŠ¼ì´ ë³´ì´ê²Œ í•œë‹¤.
- ë¦¬ì…‹ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ í•´ë‹¹ ì…ë ¥ê°’ì´ íƒ€ì„ë¦¬í”„ë¡œ ì…ë ¥ë˜ì–´ìˆì–´ì„œ ì˜ ì•ˆì§€ì›Œì¡Œë‹¤. -> ë¸Œë¼ìš°ì €ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¸ì§€í•˜ì—¬ valueë¥¼ ë¹„ìš°ëŠ” ì‹ìœ¼ë¡œ ì˜ ì•ˆë˜ì—ˆë˜ ê²ƒ 
- ì´ë¼ê³  ìƒê°í–ˆëŠ”ë° ê·¸ëƒ¥ ì¤‘ë³µ id ë¬¸ì œì˜€ë‹¤.
- ëª¨ë‹¬ì— ìˆëŠ” idì™€ ëª¨ë‹¬ì´ ì•„ë‹Œ í˜„ì¬ í˜ì´ì§€ì— ìˆëŠ” idê°€ ì¤‘ë³µë˜ì–´ ì²« ë²ˆì§¸ë¡œ ì°¾ì€ ìš”ì†Œë§Œ ë°˜í™˜ë˜ì—ˆê³  í—¤ë”ì˜ ê²€ìƒ‰ ëª¨ë‹¬ì´ ë¨¼ì € ë¡œë“œë˜ë¯€ë¡œ, í•­ìƒ ëª¨ë‹¬ì˜ inputì„ ê°€ì ¸ì™€ ë©”ì¸í˜ì´ì§€ì˜ ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì•„ì˜ˆ ì‘ë™í•˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ë‹¤.
- ë‚´ë¶€ë¡œì§ì—ì„œ ë¬¸ì œê°€ í•´ê²°ì´ ì•ˆë˜ë©´ ì™¸ë¶€ì™€ì˜ ìƒí˜¸ì‘ìš©ë¬¸ì œì„ì„ ì˜ì‹¬í•´ì•¼í•œë‹¤.
```html
<!-- header.html (ê²€ìƒ‰ ëª¨ë‹¬) -->
<input id="searchInput" class="search-modal-input" ...>

<!-- main_search/index.html (ë©”ì¸ ê²€ìƒ‰ í˜ì´ì§€) -->
<input id="searchInput" class="search-input" ...>
```
- í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì²˜ëŸ¼ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆë‹¤.
```js
if (searchInput && resetBtn) {
    
    // ë¦¬ì…‹ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ í•¨ìˆ˜
    function updateResetButton() {
      if (searchInput.value.trim().length > 0) {
        resetBtn.classList.add('show');
      } else {
        resetBtn.classList.remove('show');
      }
    }
    
    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    updateResetButton();
    
    // ì…ë ¥ ì‹œë§ˆë‹¤ ì—…ë°ì´íŠ¸
    searchInput.addEventListener('input', updateResetButton);
    
    // ë¦¬ì…‹ë²„íŠ¼ í´ë¦­
    resetBtn.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      
      // ì…ë ¥ê°’ë§Œ ì§€ìš°ê³  ë¦¬ì…‹ë²„íŠ¼ ìˆ¨ê¸°ê¸°
      searchInput.value = '';
      searchInput.focus();
      
      // ë¦¬ì…‹ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ -> show í´ë˜ìŠ¤ ì œê±°
      updateResetButton();
    });
  }
```
 
