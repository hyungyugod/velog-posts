# 📌 0. 배포
### 📌 0-1. 스프링으로 배포 기본
- 스프링 서버 포트 변경: application.properties에서 server.port=80 설정 (80번이 기본 http 포트이다.)
- 그래들 환경에서 스프링을 가동하고 있었기 때문에 코끼리 모양을 누르면 그래들을 다양한 기능을 사용할 수 있다.
- 원래 gradlew.bat bootrun 명령어를 실행해야 그래들이 스프링을 컴파일하고 실행한다. 기존의 vs 코드에서 스프링을 실행하던 버튼은 이를 대신 실행시켜준거다,
- 배포는 그래들 기능에서 task-build-build를 누르면 된다. 아니면 cmd에서 gradlew.bat build를 실행한다.
- 프로젝트 파일 -> build 파일 -> libs 파일에 jar 파일로 컴파일되어 압축된 형태의 프로젝트 폴더가 된다.
- java -jar 파일이름으로 하면 가동되고 정식오픈 시킬 수 있다. vs 코드가 아니더라도 따로 프롬프트로 이 명령어만 실행시키면 된다.
- 이렇게 좋은 컴퓨터에 24시간 가동시켜두면 된다.
- 그럼 수정사항이 있으면? -> 수정된 컴퓨터에 원격접속해서 코드를 수정할 수 있는 방법이 있다.
- 네트워크 주소가 192.168로 시작한다는 것은 무조건 공유기한테 물려있는 주소이다. 공유기 내부에 있는 컴퓨터에 공유기 외부의 접속을 허용하려면 공유기 설정을 바꾸어야한다.
- 포트포워딩을 통해 특정 ip 주소로 온 번호는 공유기에서 거르지 않고 공유기가 외부연결을 진행해준다. 
- DMZ는 외부에서 들어오는 모든 접속을 컴퓨터 한대에 몰빵 해주는 방법이 있다.
- window 자체적으로도 외부에서 들어오는 80번 포트를 잠궈버릴 수 있는 방화벽이 있다.
- 윈도우 + r을 누르고 wc.msc를 입력하면 방화벽 설정 창으로 들어간다. 아니면 네트워크 우클릭-> 속성 -> 왼쪽 밑에 방화벽을 누르면 방화벽을 열 수 있다.
- 여기서 방화벽을 설정 또는 해제할 수 있다. (또는 방화벽의 규칙설정 가능)
- 그리고 고급설정을 누르면 규칙들을 자세히 입력할 수도 있다. 이때 인바운드 규칙은 외부에서 진입할 수 있도록 포트를 열어둔 것들을 관리할 수 있다.
- 여기서 새 규칙을 누르고 포트를 여는 규칙을 만든 후 80번 포트를 열면 다 접속할 수 있도록 만들 수 있다.
- 여기까지하면 80번 포트 당 프로그램당 하나만 돌릴 수 있어서 여러개의 웹사이트는 돌릴 수 없다.
- 보통 80포트를 직접 연결하면 보안 허점이 많아서 80번 포트로 들어오는 요청을 8080을 이동시켜주는 포트포워딩을 하곤 한다. (운영체제 단에서 포트를 서로 연결해준다.)

### 📌 0-2. 톰캣을 통해 여러 웹 사이트 가동, 호스팅 사이트 원리
- 호스트네임.도메인네임 = blog.naver.com
- cofe24같은 도메인 네임 임대 사이트에서 (요청을 보내면 이 DNS에 들렸다가 간다) 도메인별 호스트같은 것도 임대할 수 있다.
- 메모장에서 컨트롤 o -> 호스트파일 열기
- c:\windows\system32\drivers\etc\hosts -> 호스트 파일에 도메인과 ip주소가 입력되어있으면 dns로 안가고 바로 입력한 ip주소로 이동한다.
- 127.0.0.1  www.naver.com 이면 네이버로 접속하면 내 컴퓨터로 이동한다.
- 톰캣으로 버츄얼 호스트를 사용해야한다.
- jar(내장서버(톰캣)를 포함하고 있음-직접실행가능) -> war(톰캣에서 가동할 수 있는 형태-톰캣에 의탁해서 실행가능)
- 기본적으로 이러한 개념들은 리눅스에서 사용할 줄 아는게 실무 스킬이 된다.
- 아래부턴 톰갯 활용에 대한 이야기이다.
- https://tomcat.apache.org/ 에서 최신버전보다 한단계 아래 버전을 다운받는다.
- C:\Users\사용자아이디\apache-tomcat-10.1.43-windows-x64 이 경로에 압축을 푸는게 낫다. (리눅스에선 권한 개념이 있는데 users 폴더 내에서는 어떤 것이든 할 수 있으므로)
- 스프링 포트번호가 8080인게 톰캣 포트번호가 8080인거에서 기원한 것이다. 정확히는 톰캣의 root 폴더를 의미한다.
- 초창기 프로그래밍언어인 jsp 파일을 톰캣 root 에 넣고 실행하면 컴파일할 필요없이 결과확인을 빠르게 할 수 있다. 그런데 jsp는 코드가 좀 스파게티 코드같아서 이를 정리하려고 mvc 패턴을 만들어냈고 jsp 문법은 발전하여 타임리프가 되었다.
- 아래는 jsp 코드이다.
```jsp
<%@ page contentType="text/html; charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <title>구구단 출력</title>
    <style>
        table { border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #333; padding: 8px 16px; text-align: center; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1>구구단 출력</h1>
    <table>
        <tr>
            <%-- 단 제목 출력 --%>
            <% for (int dan = 2; dan <= 9; dan++) { %>
                <th><%= dan %>단</th>
            <% } %>
        </tr>
        <%-- 각 행(곱하는 수)을 출력 --%>
        <% for (int i = 1; i <= 9; i++) { %>
            <tr>
                <% for (int dan = 2; dan <= 9; dan++) { %>
                    <td><%= dan %> x <%= i %> = <%= dan * i %></td>
                <% } %>
            </tr>
        <% } %>
    </table>
</body>
</html>
``` 
- 데이터 베이스는 항상 켜져있고 cmd로 mariadb 치고 그랬던 거는 거기에 프로그램을 실행시킨 것이 아니라 접속한 것이다.
- 톰캣을 이런 백그라운드 서비스로 사용하려면 톰캣이 설치된 폴더에서 service.bat를 실행하면 된다. 
- Batch는 ‘일괄 처리’를 의미하고 .bat 파일은 여러 개의 명령어(Command)를 한 번에 실행할 수 있도록 묶어놓은 텍스트 파일이다.
- 결국 외장 톰캣 사용을 위해 war로 패키징을 해야한다. build.gradle에 id war을 추가하고 의존성을 추가한다. 
- 또 메인 클래스가 특수한 클래스를 상속받고 메인 클래스에 상속받은 클래스에 내장된 메서드를 하나 오버라이딩한 후에 빌드 해야한다.
- 이후 빌드한 war 파일을 톰캣 내부 wappers폴더에 넣고 실행시키면 된다.
- 이때 개발중일때의 주소와 배포 이후의 주소가 다르다. 톰캣에서 배포할때 jar 파일의 이름이 추가로 붙기 때문이다. 그래서 타임리프로 링크를 걸면 이를 jar파일의 컨텍스트 패스(추가되는 주소)를 추가해서 링크를 자동으로 걸어준다.
- **컨텍스트 패스(Context Path)**는 웹 애플리케이션이 서버(예: 톰캣, WAS 등)에 배포될 때, 해당 애플리케이션을 구분하기 위한 고유한 URL 경로의 첫 부분을 의미한다.
- 이런 구조이기 때문에 스프링으로 여러 사이트를 만들어서 war로 외장 톰캣에 넣어두면 포트포워딩으로 한 포트로 모든 도메인 요청을 받아도 톰캣이 버추얼 호스트를 사용하여 포트로 들어오는 도메인 주소를 분석하여 내부 프로젝트로 연결해주는 것이다. 즉 톰캣으로 한 컴퓨터에서 여러 사이트를 80번 포트에서 돌릴 수 있게되는 것이다.
- 그래서 cafe24 호스팅 사이트가 톰캣을 깔아두고 여러 프로그램을 받아서 하드별로 돈을 받아 임대업을 하는 것이다.
- 이때 웹이 이미지를 다운받는데 드는 웹트래픽 용량으로도 돈을 받으므로 꽤 돈이 되는 거 같다.

# 📌 1. 스프링 안에서 리액트 사용하기
### 📌 1-1. 리액트 프로젝트 생성
- 스프링 프로젝트 폴더 내부에서 cmd 열고 yarn create react-app 이름으로 내부에 리액트를 만든다.
- com.github.node-gradle.node 의존성을 추가하여 그래들이 node를 호출할 수 있도록 한다.
- 또 아래 내용을 build에 넣어서 리액트를 스프링에 세팅한다. 그러면 이 이후에는 그래들의 application 탭에 있는 bootrun 기능을 이용하여 스프링부트를 가동해야한다.
- 아니면 터미널에서 gradlelew bootrun을 실행해도 된다.
- 이렇게 가동하면 스프링부트랑 리액트가 동시에 가동되게 된다.
```js
// ⭐⭐⭐ React 프로젝트 통합 설정 ⭐⭐⭐

// React 프로젝트 경로 설정
def frontendDir = file("frontend")

// Node.js 설정
node {
   version = "20.17.0"        // Node.js 버전
   download = true            // 자동 다운로드 활성화
   yarnVersion = "1.22.22"    // Yarn 버전 (Yarn 사용 시)
   nodeProjectDir = frontendDir
}

// 🔥 개발 환경: SpringBoot 실행 시 React 개발 서버도 함께 실행
task startReactDev(type: YarnTask) {
    dependsOn yarn
    yarnCommand = ['start']
}

// 🏗️ 빌드 환경: React 빌드 후 Spring Boot static 폴더로 복사
task buildReact(type: YarnTask) {
    dependsOn yarn
    yarnCommand = ['build']
}

bootRun {
   dependsOn startReactDev
}

task copyReactBuild(type: Copy) {
   dependsOn buildReact
   from "${frontendDir}/build"
   into "src/main/resources/static"
}

// 📦 Spring Boot jar 빌드 시 React도 함께 빌드
jar {
   dependsOn copyReactBuild
}

bootJar {
   dependsOn copyReactBuild
}
``` 
- 이후 리액트 내부에 프록시를 꼭 걸어줘야 이전처럼 매끄럽게 백엔드와 소통할 수 있게된다.
- 이때 프론트 서버를 접속할때는 설정한 홈페이지 주소를 붙였는지 확인해야한다.
- 위의 코드는 yarn 버전과 호환되는 것이므로 기본적인 npm과는 호환되지 않는다.
- bootRun을 실행했을때 startReactDev가 실행해야하는데 그게 없어서 계속 오류가 났었다. 이 구문을 추가하면 해결된다.