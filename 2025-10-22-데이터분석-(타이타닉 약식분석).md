# ğŸ“Œ 1. kaggle íƒ€ì´íƒ€ë‹‰ ë°ì´í„° ë¶„ì„ (ì•½ì‹)
## 1-1. ê²°ì¸¡ì¹˜ ì²˜ë¦¬
- infoë‚˜ isnaë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ì¸¡ì¹˜ë¥¼ ì¡°ì‚¬í•œë‹¤.
- ì¡°ì‚¬í•œ ê²°ê³¼ 
```py
train.isna().sum()
```
- .str Pandasì—ì„œ ë¬¸ìì—´ ê´€ë ¨ í•¨ìˆ˜(ì¸ë±ì‹±, ë¶„ë¦¬, ëŒ€ì²´ ë“±)ë¥¼ ì¼ê´„ ì ìš©í•˜ëŠ” ì ‘ê·¼ì
- ê²°ì¸¡ì¹˜ê°€ ë§ê¸° ë•Œë¬¸ì— ê²°ì¸¡ì¹˜ ìì²´ê°€ ì˜ë¯¸ìˆëŠ” ì •ë³´ë¼ê³  íŒë‹¨ -> ì¼ë‹¨ Uë¡œ ì²˜ë¦¬í•¨
- ì‹¤ì œ ì§€ë„ê°€ ìˆìœ¼ë©´ ê²°ì¸¡ì¹˜ë¥¼ ê·¸ë ‡ê²Œ ì¡°ì‚¬í•˜ì—¬ ì±„ì›Œë„£ì„ ìˆ˜ ìˆë‹¤.
- ë˜í•œ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í• ë•Œ ìƒˆë¡œìš´ ì»¬ëŸ¼ì„ ë§Œë“¤ì–´ì„œ ì±„ì›Œë‘ëŠ”ê²Œ ì¢‹ë‹¤.
- í•™ìŠµí• ë•ŒëŠ” ì´ cleanëœê²ƒë§Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```py
train["Cabin(clean)"] = train["Cabin"].str[0] 
train["Cabin(clean)"] = train["Cabin"].fillna("U") 
```
- ageëŠ” ì„±ë³„ê³¼ í‹°ì¼“ ë“±ê¸‰ë³„ë¡œ ë‚˜ì´ ì¤‘ì•™ê°’ì„ êµ¬í•´ ê²°ì¸¡ì¹˜ë¥¼ ì±„ì›Œë„£ëŠ”ë‹¤.
- train.groupby(["Sex", "Pclass"])["Age"] ì´ê±´ ì•„ì§ í‰ê· ì„ êµ¬í•œ ê²Œ ì•„ë‹ˆë©°. ë‹¨ì§€ **Sexì™€ Pclassë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¬¶ì€ ë‹¤ìŒ, Age ì»¬ëŸ¼ë§Œ ì„ íƒí•œ â€œê·¸ë£¹ ê°ì²´â€**ë¥¼ ë§Œë“  ê²ƒì´ë‹¤.
- ì´í›„ train.groupby(["Sex", "Pclass"])["Age"].mean()ì²˜ëŸ¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì§‘ê³„í•¨ìˆ˜ë¥¼ ë’¤ì— ë¶™ì—¬ì£¼ì–´ì•¼í•œë‹¤.
- transformì€ ê·¸ë£¹ ìš”ì•½ê°’ì„ ê° í–‰ì— â€œë°©ì†¡(broadcast)â€ í•´ì„œ ë¶™ì—¬ì¤€ë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ ("female", 1) ê·¸ë£¹ì˜ ì¤‘ì•™ê°’ì´ 38ì´ë¼ë©´, ê·¸ ê·¸ë£¹ì— ì†í•œ ëª¨ë“  í–‰ì— 38ì´ ë“¤ì–´ìˆëŠ” ì‹œë¦¬ì¦ˆê°€ ìƒì„±ëœë‹¤.
```py
train["Age(clean)"] = train["Age"].fillna(train.groupby(["Sex", "Pclass"])["Age"].transform("median"))
```
- ë‹¤ìŒì€ íƒ‘ìŠ¹í•œ í•­êµ¬ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë¥¼ ì±„ì›Œì•¼í•œë‹¤.
- ëª…ëª©í˜• ë³€ìˆ˜ëŠ” í‰ê· Â·ì¤‘ì•™ê°’ ê°œë…ì´ ì—†ê³  Sê°€ ì „ì²´ì˜ 70% ì´ìƒì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê²°ì¸¡ì¹˜ëŠ” ìµœë¹ˆê°’ìœ¼ë¡œ ì±„ìš°ëŠ” ê²ƒì´ ë§ë‹¤.
```py
train["Embarked(clean)"] = train["Embarked"].fillna(train["Embarked"].mode())
```

## 1-2. ë¬¸ìì—´ ë³€ìˆ˜ ì¸ì½”ë”©
- ì›í•«ì¸ì½”ë”©ìœ¼ë¡œ ìƒˆë¡œ ìƒê¸´ ì—´ì„ ì›ë˜ ë°ì´í„°ì— ìˆëŠ” ë¬¸ì ë°ì´í„°ë¡œ ë°”ê¿”ì¹˜ê¸°í•˜ê³  ì‹¶ë‹¤ë©´ train_encoded = pd.concat([train.drop(columns=obj_cols), encoded_df], axis=1)ë¥¼ í†µí•´ ë°”ê¾¸ë©´ ëœë‹¤.
```py
from sklearn.preprocessing import OneHotEncoder

ohe = OneHotEncoder(sparse_output=False).set_output(transform="pandas")

encoded_df = ohe.fit_transform(train.select_dtypes("object"))

encoded_df.index = train.index # ì¸ë±ìŠ¤ë¥¼ ì²˜ìŒì— ì´ë ‡ê²Œ í•´ë†”ì„œ ì´ë ‡ê²Œ ë§ì¶°ì£¼ì—ˆë‹¤.

train_with_ohe = pd.concat([train, encoded_df], axis=1)
```

## 1-3. í•™ìŠµ ë°ì´í„° ìƒì„±, ë¶„í• 
- ì•„ë˜ì²˜ëŸ¼ í•˜ê±°ë‚˜ train.columnsë¡œ ë³´ê³  ì¼ì¼íˆ ì§€ì›Œì¤˜ë„ëœë‹¤.
```py
from sklearn.model_selection import train_test_split

# 1) íƒ€ê¹ƒ ë¶„ë¦¬
y = train_with_ohe["Survived"]

# 2) clean ìˆ«ì ë³€ìˆ˜ ìë™ ì„ íƒ (ì´ë¦„ì— '(clean)'ì´ ë¶™ê³ , ìˆ«ìí˜•ì¸ ê²ƒë§Œ)
clean_cols = [c for c in train_with_ohe.columns if c.endswith("(clean)")]
clean_num_cols = train_with_ohe[clean_cols].select_dtypes("number").columns

# 3) ì›í•« ì¸ì½”ë”©ìœ¼ë¡œ ìƒˆë¡œ ìƒê¸´ ì—´ë§Œ ì„ íƒ
ohe_cols = encoded_df.columns  # fit_transformì—ì„œ ë‚˜ì˜¨ DFì˜ ì¹¼ëŸ¼ë“¤

# 4) (ì„ íƒ) ì¶”ê°€ë¡œ ì“¸ ì›ë³¸ ìˆ«ìì—´(ì˜ˆ: Pclass, Fare, SibSp, Parch) ì§€ì • -> ì›ë³¸ì¤‘ì—ì„œ ìœ„ì—ì„œ ë„£ì€ ê²ƒ ì™¸ì— ì›ë˜ ìˆë˜ ì¹¼ëŸ¼ ì§ì ‘ ì¶”ê°€
base_num_cols = ["Pclass","Fare","SibSp","Parch"]
base_num_cols = [c for c in base_num_cols if c in train_with_ohe.columns]

# 5) ìµœì¢… X êµ¬ì„±: clean ìˆ«ì + ì›í•« + (ì„ íƒ) ê¸°ë³¸ ìˆ«ì
X = train_with_ohe[list(clean_num_cols) + list(ohe_cols) + base_num_cols]

train_x, val_x, train_y, val_y = train_test_split(X, y, train_size=0.8, random_state=42)
```

## 1-4. ëª¨ë¸ í•™ìŠµ ë° ê²°ê³¼ ë¹„êµ
- ëœë¤ í¬ë ˆìŠ¤íŠ¸ì™€ ì˜ì‚¬ê²°ì • íŠ¸ë¦¬ë¡œ ê°ê° ê³„ì‚°í•´ì„œ ë†’ì€ í•™ìŠµê¸°ë¥¼ ì„ íƒí•œë‹¤.
```py
from sklearn.ensemble import RandomForestClassifier
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import roc_auc_score

rf_clf = RandomForestClassifier(random_state=42, n_jobs=-1)
dt_clf = DecisionTreeClassifier(random_state=42)

rf_clf.fit(train_x, train_y)
dt_clf.fit(train_x, train_y)

pred_y = rf_clf.predict(val_x)
preddt_y = dt_clf.predict(val_x)

print(roc_auc_score(val_y, pred_y), roc_auc_score(val_y, preddt_y)) # 0.818018018018018 0.8164736164736165 -> ëœë¤í¬ë ˆìŠ¤íŠ¸ê°€ ë” ìœ ì˜í•˜ë‹¤

```

## 1-5. íŒŒì´í”„ë¼ì¸ í™œìš© í…ŒìŠ¤íŠ¸ ì¼ì›í™”
- passthrough = â€œì´ ì»¬ëŸ¼ë“¤ì€ ë³€í™˜ ì•ˆ í•˜ê³  ê·¸ëŒ€ë¡œ ëª¨ë¸ë¡œ ë„˜ê²¨ì¤˜.â€ ë¼ëŠ” ëœ»ì´ë‹¤.
- íŒŒì´í”„ë¼ì¸ì„ í™œìš©í•˜ë©´ ì „ì²˜ë¦¬ ê³¼ì •ì„ ì •ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ groupby ê°™ì€ê²ƒì„ ì²˜ë¦¬í•˜ê¸°ëŠ” ë¹¡ì„¸ë‹¤ -> í• ìˆ˜ëŠ” ìˆê¸´í•œë° ë”°ë¡œ í•¨ìˆ˜ë§Œë“¤ì–´ì„œ í•´ì•¼í•˜ê³  ê·¸ë ‡ë‹¤
```py
import numpy as np
import pandas as pd
from sklearn.compose import ColumnTransformer
from sklearn.preprocessing import OneHotEncoder, StandardScaler
from sklearn.pipeline import Pipeline
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import roc_auc_score

# 1) ì›ë³¸ì—ì„œ ì“¸ ì—´ì„ ëª…ì‹œ
cat_cols = ["Sex", "Embarked(clean)", "Cabin(clean)"]
num_cols = ["Pclass", "Age(clean)", "Fare", "SibSp", "Parch"]

X = train[cat_cols + num_cols]
y = train["Survived"]

# 2) ì „ì²˜ë¦¬ ì •ì˜ -> imputerë¡œ ê²°ì¸¡ì¹˜ë„ ì²˜ë¦¬ê°€ëŠ¥
cat_pipe = Pipeline([
    ("imputer", SimpleImputer(strategy="most_frequent")),
    ("onehot", OneHotEncoder(handle_unknown="ignore", sparse_output=True))
])

num_pipe = Pipeline([
    ("imputer", SimpleImputer(strategy="median")),
    ("scaler", StandardScaler())  # ì„ íƒì‚¬í•­
])

preprocess = ColumnTransformer([
    ("cat", cat_pipe, cat_cols),
    ("num", num_pipe, num_cols)
])

# 3) íŒŒì´í”„ë¼ì¸ êµ¬ì„± (ì „ì²˜ë¦¬ â†’ ëª¨ë¸)
pipe = Pipeline([
    ("prep", preprocess),
    ("clf", RandomForestClassifier(random_state=42, n_jobs=-1)),
])

# 4) í•™ìŠµ/ê²€ì¦ ë¶„ë¦¬ + í•™ìŠµ
X_tr, X_val, y_tr, y_val = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)
pipe.fit(X_tr, y_tr)

# 5) í‰ê°€ (AUCëŠ” í™•ë¥  ì‚¬ìš©)
val_proba = pipe.predict_proba(X_val)[:, 1]
print("AUC:", roc_auc_score(y_val, val_proba))
```

## 1-6. íŒŒìƒë³€ìˆ˜ ìƒì„±
- ë²ˆì™¸ë¡œ íŒŒìƒë³€ìˆ˜ë¥¼ í•œë²ˆ ë§Œë“¤ì–´ë´¤ë‹¤.
```py
# derived variables(feature) : sibsp + parch + 1
train["Family"] = train["SibSp"] + train["Parch"] + 1
```
- train.columnsì„ í†µí•´ 
```py
Index(['Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch', 'Ticket',
       'Fare', 'Cabin', 'Embarked', 'Cabin(clean)', 'Age(clean)',
       'Embarked(clean)', 'Family'],
      dtype='object')
```
- ë¼ëŠ” ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ì´ê±¸ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ í•™ìŠµí•  ë°ì´í„°ì˜ ì»¬ëŸ¼ì„ êµ¬ì„±í•´ì£¼ì—ˆë‹¤.
- ìê¸° ìƒê´€ì˜ ë¬¸ì œ ë•Œë¬¸ì— ì—°ê´€ëœ ì»¬ëŸ¼ì„ ì‚­ì œí•´ë³´ì•˜ë‹¤.
```py
train.columns
f_names = ['Survived', 'Pclass', 'Name', 'Sex', 'Ticket',
       'Fare', 'Cabin(clean)', 'Age(clean)',
       'Embarked(clean)', 'Family']

X = train[f_names].drop(columns="Survived")
y = train["Survived"]
```
- ì´ì œ ì•„ë˜ì„œ ì•½ì‹ ì›í•« ì¸ì½”ë”©ì„ í–ˆë‹¤. ì—¬ê¸°ê¹Œì§€ í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ìœ„ì²˜ëŸ¼ ë‹¤ì‹œ ëª¨ë¸ì„ ëŒë ¤ë³´ë©´ ëœë‹¤.
- drop_first=True ì˜µì…˜ì€ í•˜ë‚˜ì˜ ì—´ì„ ë²„ë ¤ë„ ë‚˜ë¨¸ì§€ë¡œ ì˜ˆì¸¡ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ë‹¤ì¤‘ê³µì„ ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì ì›í•«ì¸ì½”ë”©ë˜ì–´ ëŠ˜ì–´ë‚œ ì—´ ì¤‘ í•œ ì—´ì„ ë²„ë ¤ì¤€ë‹¤.
```py
X = pd.get_dummies(X, columns=["Sex", "Embarked(clean)", "Cabin(clean)"], drop_first=True)
```