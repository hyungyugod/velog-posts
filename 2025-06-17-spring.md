# ğŸ“Œ 1. í•™ê³¼ ì •ë³´ ìˆ˜ì •
### ğŸ“Œ 1-1. regexHelper ì •ê·œí‘œí˜„ì‹ ìˆ˜ì •
- ì•ì„œì„œ ì •ê·œí‘œí˜„ì‹ helperì˜ ëª‡ê°€ì§€ë¥¼ ìˆ˜ì •í•˜ì˜€ë‹¤. 
```java
if (!Pattern.matches("^[ã„±-ã…ê°€-í£\\s]*$", str)) {
            throw new StringFormatException(message);
        }
```
- ì—¬ê¸°ì„œ ì›ë˜ ë„ì–´ì“°ê¸°ëŠ” í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ë° //së¡œ ê³µë°±ë„ í¬í•¨í•´ì£¼ì—ˆë‹¤.
- ê·¸ë˜ê³  [ -]?ëŠ” ê³µë°± ë˜ëŠ” í•˜ì´í”ˆì´ ìˆì–´ë„ ë˜ê³  ì—†ì–´ë„ ë˜ëŠ”ê±´ë° ë°˜ì˜ì´ë˜ì–´ìˆì§€ ì•Šê¸¸ë˜ ìˆ˜ì •í•´ì£¼ì—ˆë‹¤.
```java
public void isPhone(String str, String message) throws StringFormatException {
        boolean cellPhone = Pattern.matches("^01(?:0|1|[6-9])[ -]?(\\d{3}|\\d{4})[ -]?\\d{4}$", str);
        boolean telPhone = Pattern.matches("^\\d{2,3}[ -]?\\d{3,4}[ -]?\\d{4}$", str);

        if (!cellPhone && !telPhone) {
            throw new StringFormatException(message);
        }
    }
```

### ğŸ“Œ 1-2. return null;ì˜ ì˜ë¯¸
- ë¦¬í„´ì„ nullë¡œ ì£¼ë©´ ì•ì„œ ì°¾ì•„ì™”ë˜ ì£¼ì†Œë¡œ ë‹¤ì‹œ ì°¾ì•„ê°€ë ¤ê³  í•œë‹¤. í•˜ì§€ë§Œ ìš”ì²­ì— íŒŒë¼ë¯¸í„°ê°€ ë¶™ì€ ê²½ìš° ì‹¤ì œë¡œ í•´ë‹¹ í˜ì´ì§€ëŠ” ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê·¸ëƒ¥ ëª…í™•í•œ ê²½ë¡œë¥¼ ë‹¤ì‹œ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.
```java
@GetMapping("/department/edit/{id}")
        public String edit(Model model, @PathVariable(value="id", required = true) int id) {
        Department input = new Department();
        input.setId(id);
        Department output = null;
        try {
            output = departmentService.getItem(input);
        } catch (Exception e) {
            webHelper.serverError(e);   
            return null;
        }
        model.addAttribute("department", output);
        return "department/edit";
        }
```
- í•˜ì§€ë§Œ ìœ„ì˜ ê²½ìš° ë¦¬í„´ì´ ì¼ì–´ë‚˜ê¸° ì „ì— ì•„ë˜ì²˜ëŸ¼ redirectì—ì„œ history backì„ writerë¥¼ í†µí•´ ì‘ë‹µì„ ë³´ë‚´ëŠ”ë° ì´ë•Œ  **Springì˜ view ë¦¬ì¡¸ë²„(í…œí”Œë¦¿ ì²˜ë¦¬)**ë¥¼ ê±°ì¹˜ì§€ ì•Šê³ 
HTTP ì‘ë‹µì´ ì´ë¯¸ ëë‚˜ë²„ë¦° ìƒíƒœê°€ ëœë‹¤. ê·¸ë˜ì„œ ì„œë¡œ ì†Œí†µì— ì˜¤ë¥˜ê°€ ìƒê²¨ì„œ ê°€ë” ë¦¬í„´í•œ ê°’ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²½ê³ ë¬¸êµ¬ê°€ ëœ¨ê¸´í•œë‹¤.
- ê·¼ë° ì´ë ‡ê²Œ webHelperë¥¼ ì“°ëŠ” ê²ƒë³´ë‹¤ ê·¸ëƒ¥ redirectë¥¼ returnì— ë„£ëŠ”ê²Œ ë” ê¹”ë”í•œ ê²ƒ ê°™ë‹¤.
- webHelperë¥¼ ì‚¬ìš©í•  ê±°ë©´ í•¨ìˆ˜ë¥¼ voidë¡œ ì„ ì–¸í•´ì•¼í•œë‹¤.
```java
public void redirect(int statusCode, String url, String message) {
        // HTTP 403 Forbidden í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ ìƒíƒœ ì‘ë‹µ ì½”ë“œëŠ” ì„œë²„ì— ìš”ì²­ì´ ì „ë‹¬ë˜ì—ˆì§€ë§Œ,
        // ê¶Œí•œ ë•Œë¬¸ì— ê±°ì ˆë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸
        response.setStatus(statusCode);
        response.setContentType("text/html; charset=UTF-8");

        PrintWriter out;
        try {
            out = response.getWriter();
        } catch (IOException e) {
            log.error("ì‘ë‹µ ì¶œë ¥ ìŠ¤íŠ¸ë¦¼ ìƒì„± ì‹¤íŒ¨", e);
            return;
        }

        out.println("<!DOCTYPE html>");
        out.println("<html lang='ko'>");
        out.println("<head>");
        out.println("<script>");

        if (message != null && !message.isEmpty()) {
            out.println("alert('" + message + "');");
        }

        if (url != null && !url.isEmpty()) {
            //out.println("<meta http-equiv='refresh' content='0; url=" + url + "' />");
            out.println("window.location.replace('" + url + "');");
        } else {
            out.println("history.back();");
        }

        out.println("</script>");
        out.println("</head>");
        out.println("<body>");
        out.println("</body>");
        out.println("</html>");

        out.flush();
    }
```

### ğŸ“Œ 1-3. ìˆ˜ì •í˜ì´ì§€ êµ¬í˜„
- edit_okë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ë©´ì„œ ì •ë³´ë¥¼ í¬í•¨ì‹œí‚¨ë‹¤. idëŠ” ë”°ë¡œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— í¬í•¨ì‹œí‚¨ë‹¤. ì´ë•Œ putíƒ€ì…ìœ¼ë¡œ htmlì—ì„œëŠ” ê·¸ëƒ¥ ë³´ë‚¼ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì´ê²Œ putì´ë¼ëŠ” ê²ƒì„ hiddenì„ í†µí•´ ìˆ¨ê²¨ì„œ í‚¤ê°’_methodì™€ ë²¨ë¥˜ê°’ putìœ¼ë¡œ ë³´ë‚´ì•¼ í•œë‹¤.
- idëŠ” ë°”ë€Œì§€ ì•ŠëŠ” ê°’ì´ê¸° ë•Œë¬¸ì— ì „ì— ì €ì¥ëë˜ ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ë³´ë‚´ê³  ë‚˜ë¨¸ì§€ ì •ë³´ëŠ” ìˆ˜ì •ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ìˆ˜ì •ì„ ë°›ì•„ì„œ bodyì— ë„£ì–´ ì „ì†¡í•œë‹¤.
- ê·¸ë¦¬ê³  restfull ê·œì¹™ì—ì„œ idëŠ” ê²½ë¡œì— ë‘ëŠ” ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆë‹¤.
```html
        <h2>í•™ê³¼ê³¼ëª©ìˆ˜ì •</h2>

        <form id="my-form" th:action="@{'/department/edit_ok/' + ${department.id}}" method="post">
            <input type="hidden" name="_method" value="put" />
            <table class="my-table item-table">
                <tbody>
                    <tr>
                        <th>í•™ê³¼ëª…</th>
                        <td>
                            <input type="text" name="dname" id="dname" placeholder="í•™ê³¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.dname}" />
                        </td>
                    </tr>
                    <tr>
                        <th>ìœ„ì¹˜</th>
                        <td>
                            <input type="text" name="loc" id="loc" placeholder="ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.loc}" />
                        </td>
                    </tr>
                    <tr>
                        <th>ì „í™”ë²ˆí˜¸</th>
                        <td>
                            <input type="text" name="phone" id="phone" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.phone}" />
                        </td>
                    </tr>
                    <tr>
                        <th>ì´ë©”ì¼</th>
                        <td>
                            <input type="email" name="email" id="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.email}" />
                        </td>
                    </tr>
                    <tr>
                        <th>ì„¤ë¦½ë…„ë„</th>
                        <td>
                            <input type="number" name="established" id="established" placeholder="ì„¤ë¦½ë…„ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.established}" />
                        </td>
                    </tr>
                    <tr>
                        <th>í™ˆí˜ì´ì§€</th>
                        <td>
                            <input type="url" name="homepage" id="homepage" placeholder="í™ˆí˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”."
                                th:value="${department.homepage}" />
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="buttons">
                <button type="submit" class="mybutton blue">ë“±ë¡</button>
                <button type="reset" class="mybutton gray">ì´ˆê¸°í™”</button>
            </div>
        </form>

        <script>
        document.querySelector('#my-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // ì •ê·œí‘œí˜„ì‹ì„ ì‚¬ìš©í•œ ì…ë ¥ê°’ í˜•ì‹ ê²€ì‚¬ ìˆ˜í–‰ (ì—¬ê¸°ì„œëŠ” ìƒëµ)

            e.currentTarget.submit();
        });
        </script>
    </body>
</html> 
```

### ğŸ“Œ 1-4. ìˆ˜ì • ì»¨íŠ¸ë¡¤ëŸ¬
- post ë°©ì‹ìœ¼ë¡œ ë³´ë‚´ë©´ springì€ ìë™ìœ¼ë¡œ ì •ë³´ë¥¼ bodyì—ì„œ êº¼ë‚´ì“°ë¯€ë¡œ êµ³ì´ @RequestBodyë¥¼ ì“°ì§€ ì•Šì•„ë„ ì•Œì•„ì„œ ë§¤í•‘í•´ì¤€ë‹¤. ë‹¤ë§Œ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë°›ì•˜ì„ ë•ŒëŠ” @RequestBodyë¡œ ê¼­ ë°›ì•„ì£¼ì–´ì•¼í•œë‹¤.
- ì•„ë˜ëŠ” voidë¡œ methodë¥¼ ì„ ì–¸í–ˆê¸° ë•Œë¬¸ì— returnì€ ê·¸ëƒ¥ ì¤‘ë‹¨ìë¡œ ì¨ì£¼ëŠ” ëª¨ìŠµì´ë‹¤.
- ì›ë˜ ìœ íš¨ì„± ê²€ì‚¬ëŠ” ë³´ë‚´ëŠ” ìª½ê³¼ ë°›ëŠ” ìª½ì´ ëª¨ë‘ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ë§ë‹¤.
```java
@PostMapping("/department/edit_ok")
        public void editOk(Model model,
                            @RequestParam(value = "id", required = true) int id,
                            @RequestParam(value = "dname", required = true) String dname,
                            @RequestParam(value = "loc", required = true) String loc,
                            @RequestParam(value = "phone", required = true) String phone,
                            @RequestParam(value = "email", required = true) String email,
                            @RequestParam(value = "established", required = true) String established,
                            @RequestParam(value = "homepage", required = true) String homepage) {

            // ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬
            try {
                regexHelper.isValue(dname, "í•™ê³¼ ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤.");
                regexHelper.isKor(dname, "ì´ë¦„ì€ í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");

                regexHelper.isValue(loc, "í•™ê³¼ ìœ„ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.");

                regexHelper.isValue(phone, "ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                regexHelper.isPhone(phone, "ì—°ë½ì²˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");

                regexHelper.isValue(email, "ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
                regexHelper.isEmail(email, "ì´ë©”ì¼ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");

                regexHelper.isValue(established, "ì„¤ë¦½ë…„ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                regexHelper.isNum(established, "ì„¤ë¦½ë…„ë„ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");

                regexHelper.isValue(homepage, "í™ˆí˜ì´ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                regexHelper.isUrl(homepage, "í™ˆí˜ì´ì§€ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");

            } catch (StringFormatException e) {
                webHelper.serverError(e);
                return;
            }

            // ë°ì´í„° ì „ë‹¬ìš© ê°ì²´ ìƒì„±
            Department input = new Department();
            input.setId(id);
            input.setDname(dname);
            input.setLoc(loc);
            input.setPhone(phone);
            input.setEmail(email);
            input.setEstablished(Integer.parseInt(established));
            input.setHomepage(homepage);

            Department output = null;

            try {
                output = departmentService.editItem(input);
            } catch (Exception e) {
                webHelper.serverError(e);
                return;
            }

            webHelper.redirect("/department/view/" + output.getId(), "ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
```

# ğŸ“Œ 2. íŒŒì¼ ì—…ë¡œë“œ
- multipart: ì›¹ì—ì„œ íŒŒì¼ ì—…ë¡œë“œ(ì´ë¯¸ì§€, ë¬¸ì„œ ë“±)ë‚˜ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°(í¼+íŒŒì¼)ë¥¼ í•œ ë²ˆì— ì „ì†¡í•  ë•Œ ì‚¬ìš©í•˜ëŠ” íŠ¹ë³„í•œ ë°ì´í„° ì „ì†¡ ë°©ì‹ì´ë‹¤.
- ì¦‰ ì—¬ëŸ¬ íŒŒíŠ¸ê°€ ë‹´ê²¨ì ¸ ìˆì–´ multipartë¼ê³  ë¶€ë¥¸ë‹¤.
- í™•ì¥ìëŠ” íŒŒì¼ì˜ ì¢…ë¥˜ë¥¼ ì˜ë¯¸í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ê·¸ íŒŒì¼ì´ ì—°ê²°ë  í”„ë¡œê·¸ë¨ì„ ì˜ë¯¸í•œë‹¤.

### ğŸ“Œ 2-1. application properties ì„¤ì •
- spring.servlet.multipart.max-file-size=25MB : íŒŒì¼ í•˜ë‚˜ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ ì„¤ì •
- spring.servlet.multipart.max-request-size=100MB : ì „ì²´ ìš”ì²­ì˜ ìµœëŒ€í¬ê¸° ì„¤ì •
- upload.dir=C:/Users/leekh/study-springboot/upload : ìœˆë„ìš°ìš© ì €ì¥í•  ìœ„ì¹˜ ì§€ì •
- upload.url=/files : http://localhost:8080/files ì²˜ëŸ¼ íŒŒì¼ì´ ë‚˜íƒ€ë‚  URLì„ ì˜ë¯¸í•œë‹¤.

### ğŸ“Œ 2-2. íŒŒì¼ ì—…ë¡œë“œ í…œí”Œë¦¿ ê¸°ë³¸
- input type="file" name="photo" id="photo" accept="image/*" : ëª¨ë“  ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•´ë‹¬ë¼ëŠ” ëœ»
- enctype="multipart/form-data": ì¸ì½”ë”© íƒ€ì…ì„ "í¼ ì•ˆì˜ ê° ì…ë ¥ ìš”ì†Œë§ˆë‹¤ ë”°ë¡œë”°ë¡œ ì—¬ëŸ¬ ì¡°ê°(íŒŒíŠ¸)ë¡œ ë‚˜ëˆ ì„œ" ë³´ë‚´ë¼ëŠ” ëœ»ì´ë‹¤.
```html
<body>
    <div th:replace="~{fragments/header :: my-header}"></div>

    <h2>ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ</h2>
    <!--
        1) GETë°©ì‹ì€ ì—…ë¡œë“œ ë¶ˆê°€
        2) enctype="multipart/form-data"ëŠ” íŒŒì¼ ì—…ë¡œë“œì‹œ í•„ìˆ˜
    -->
    <form method="post" th:action="@{/simple/upload_single_ok}" enctype="multipart/form-data">
        <div>
            <label for="subject">ì‚¬ì§„ì œëª©</label>
            <input type="text" name="subject" id="subject" />
        </div>
        <div>
            <label for="photo">ì‚¬ì§„ì„ íƒ</label>
            <input type="file" name="photo" id="photo" accept="image/*" />
        </div>

        <button type="submit">ì—…ë¡œë“œí•˜ê¸°</button>
    </form>
</body>
```

### ğŸ“Œ 2-3. webConfig ìˆ˜ì •
- uploadDir, uploadUrl : application propertiesì—ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
- addResourceHandlersëŠ” ìŠ¤í”„ë§ì—ì„œ ì •ì  ìì›ì„ ì›¹ì— ë³´ì—¬ì¤„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì„¤ì • í•¨ìˆ˜ì´ë‹¤.
- addResourceHandler(): ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ "ì–´ë–¤ ê²½ë¡œë¡œ ì ‘ê·¼í•  ë•Œ" /files/ì‚¬ì§„.jpgì²˜ëŸ¼ íŠ¹ì • URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤.
- ploadUrlì´ ì˜ˆë¥¼ ë“¤ì–´ /filesë¼ë©´, ì‹¤ì œë¡œëŠ” /files/**ë¡œ ë°”ë€ë‹¤. ì¦‰, /files/ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ê²½ë¡œ(ì´ë¯¸ì§€, ë¬¸ì„œ ë“± ì „ë¶€!)ì— ëŒ€í•œ ìš”ì²­ì„ ì¡ê² ë‹¤ëŠ” ëœ»ì´ë‹¤.
- addResourceLocations(): ì‹¤ì œ íŒŒì¼ì´ "ì„œë²„ì˜ ì–´ë””ì— ì €ì¥ë¼ ìˆëŠ”ì§€" ì•Œë ¤ì¤€ë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ /files/ì‚¬ì§„.jpgë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ì‹¤ì œë¡œëŠ” ì„œë²„ì˜ ì–´ëŠ í´ë”(ë””ë ‰í† ë¦¬)ì—ì„œ ê·¸ íŒŒì¼ì„ ì°¾ì„ì§€ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.
- @Configurationì€ ì„¤ì • íŒŒì¼ë¡œ ìŠ¤í”„ë§ ìì²´ì˜ í™˜ê²½ ì„¤ì •ì„ java ì½”ë“œë¡œ í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. 
- í•˜ì—¬ @Overrideì•ˆí•˜ë©´ **Springì˜ â€œê¸°ë³¸ ì„¤ì •â€**ì´ ë™ì‘í•˜ì—¬ /static í´ë” ì•ˆì˜ íŒŒì¼ë§Œ ì„œë¹„ìŠ¤ëœë‹¤.
```java
@Configuration
public class MyWebConfig implements WebMvcConfigurer {

    @Autowired
    private MyInterceptor myInterceptor;

    @Value("${upload.dir}")
    private String uploadDir;

    @Value("${upload.url}")
    private String uploadUrl;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        InterceptorRegistration ir = registry.addInterceptor(myInterceptor);
        ir.excludePathPatterns("/hello", "world", "/error", "/robots/txt", "/favicon.ico", "/assets/**");
    }

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(String.format("%s/**", uploadUrl))
                .addResourceLocations(String.format("file://%s/"));
                
    }
    
}
```

### ğŸ“Œ 2-4. íŒŒì¼ ì—…ë¡œë“œ controller
- String targetDir = String.format("%s/%04d/%02d/%02d", uploadDir, c.get(Calendar.YEAR), c.get(Calendar.MONTH) + 1, c.get(Calendar.DAY_OF_MONTH)); : í¬ë©§ì„ í†µí•´ íƒ€ê²Ÿ í´ë” ìƒì„±
- f.mkdirs();: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íŒŒì¼ì´ ì—†ìœ¼ë©´ í•´ë‹¹ urlê¹Œì§€ ëª¨ë“  íŒŒì¼ì„ ìƒì„±í•¨.
- String ext = originName.substring(originName.lastIndexOf(".") ); : í™•ì¥ì ì´ë¦„ì„ ì›ë˜ ì´ë¦„ì—ì„œ ë¶„ë¦¬í•´ì„œ ext ë§Œë“¤ì–´ë‘ê¸°
- ì €ì¥í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ì¶œë ¥í•´ì£¼ê¸°
```java
@Slf4j
@Controller
public class SimpleUploadController {

    /** WebHelper ì£¼ì… */
    @Autowired
    private WebHelper webHelper;

    /** ì—…ë¡œë“œ ëœ íŒŒì¼ì˜ ì €ì¥ë  ê²½ë¡œ (application.propertiesë¡œë¶€í„° ì½ì–´ì˜´) */
    @Value("${upload.dir}")
    private String uploadDir;

    /** ì—…ë¡œë“œ ëœ íŒŒì¼ì˜ ë…¸ì¶œë  URL ê²½ë¡œ (application.propertiesë¡œë¶€í„° ì½ì–´ì˜´) */
    @Value("${upload.url}")
    private String uploadUrl;

    /** ì—…ë¡œë“œ í¼ì„ êµ¬ì„±í•˜ëŠ” í˜ì´ì§€ */
    @GetMapping("/simple/upload_single")
    public String uploadSingle() {
        return "simple/upload_single";
    }

    /**
     * Spring ì†Œì…œ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„
     * - ì—…ë¡œë“œê°€ ë˜ëŠ” ê³¼ì •ì—ì„œ ë‹¤ë£¨ì–´ì•¼ í•˜ëŠ” ê°’ë“¤ì„ í™•ì¸í•˜ê¸° ìœ„í•œ ì˜ˆì œ
     */
    @PostMapping("/simple/upload_single_ok")
    public String uploadOk(Model model,
            @RequestParam(value="subject", required=false) String subject,
            @RequestParam(value="photo", required=false) MultipartFile photo) {

        /** 1) ì—…ë¡œë“œ ëœ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤. */
        if (photo.getOriginalFilename().isEmpty()) {
            webHelper.badRequest("ì—…ë¡œë“œ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.");
            return null;
        }

        // ì—…ë¡œë“œ ëœ íŒŒì¼ì˜ ì •ë³´ë¥¼ ë¡œê·¸ë¡œ ê¸°ë¡
        log.debug("===============================");
        log.debug("ì›ë³¸íŒŒì¼ì´ë¦„ : " + photo.getOriginalFilename());
        log.debug("í•„ë“œëª… : " + photo.getName());
        log.debug("ì»¨í…ì¸ íƒ€ì… : " + photo.getContentType());
        log.debug("íŒŒì¼í¬ê¸° : " + photo.getSize());

        // ì—…ë¡œë“œ ëœ íŒŒì¼ì´ ì €ì¥ë  í´ë”ì˜ ì´ë¦„ì„ "ë…„/ì›”/ì¼" í˜•ì‹ìœ¼ë¡œ ìƒì„±í•œë‹¤.
        Calendar c = Calendar.getInstance();
        String targetDir = String.format("%s/%04d/%02d/%02d", uploadDir,
                c.get(Calendar.YEAR),
                c.get(Calendar.MONTH) + 1,
                c.get(Calendar.DAY_OF_MONTH));

        File f = new File(targetDir);
        if (!f.exists()) {
            f.mkdirs();
        }

        String originName = photo.getOriginalFilename();

        String ext = originName.substring(originName.lastIndexOf(".") );
        String fileName = null;
        File targetFile = null;
        int count = 0;

        while (true) {
            fileName = String.format("%d%d%s", System.currentTimeMillis(), count, ext);
            targetFile = new File(String.format(targetDir, fileName));
            if (!targetFile.exists()) {
                // íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë°˜ë³µë¬¸ì„ ë¹ ì ¸ë‚˜ê°„ë‹¤.
                break;
            }

            count++;
        }

        // ì—…ë¡œë“œ ëœ íŒŒì¼ì„ ì§€ì •ëœ ê²½ë¡œë¡œ ë³µì‚¬í•œë‹¤.
        // ì—…ë¡œë“œ ì‹¤íŒ¨ë¥¼ ìœ„í•´ try-catch êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤.
        try {
            photo.transferTo(targetFile);
        } catch (Exception e) {
            webHelper.serverError(e);
            return null;
        }

        /** 2) ì—…ë¡œë“œ ê²½ë¡œ ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ê¸° */
        // ë³µì‚¬ëœ íŒŒì¼ì˜ ì ˆëŒ€ê²½ë¡œë¥¼ ì¶”ì¶œí•œë‹¤.
        String absPath = targetFile.getAbsolutePath().replace("\\", "/");

        String filePath = null;
        if (absPath.contains(uploadDir.replace("\\", "/"))) {
            // Mac, Linux ê²½ë¡œ ì²˜ë¦¬
            filePath = absPath.replace(uploadDir.replace("\\", "/"), "");
        } else {
            // Windows ê²½ë¡œ ì²˜ë¦¬
            filePath = absPath.replace(uploadDir.substring(1), "");
        }

        log.debug("ì—…ë¡œë“œ í´ë” ë‚´ì—ì„œì˜ ìµœì¢… ê²½ë¡œ ì •ë³´ : " + filePath);

        /** 3) ì—…ë¡œë“œ ê²°ê³¼ë¥¼ Beansì— ì €ì¥ */
        UploadItem item = new UploadItem();
        item.setFieldName(photo.getName());
        item.setContentType(photo.getContentType());
        item.setFileName(photo.getName());
        item.setFileSize(photo.getSize());
        item.setOriginName(photo.getOriginalFilename());
        item.setFilePath(filePath);

        // ì—…ë¡œë“œ ê²½ë¡œë¥¼ ì›¹ ìƒì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ê²½ë¡œ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ Beansì— ì¶”ê°€í•œë‹¤.
        String fileUrl = String.format("%s%s", uploadUrl, filePath);
        log.debug("íŒŒì¼ì˜ URL : " + fileUrl);

        log.debug("===============================");

        /** 4) View ì²˜ë¦¬ */
        model.addAttribute("subject", subject);
        model.addAttribute("item", item);

        return "simple/upload_single_ok";
    }
}
```