# ğŸ“Œ 1. aop
- **AOP(ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°)**ëŠ” "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶€ê°€ ê¸°ëŠ¥(ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜, ê³µí†µ ì²˜ë¦¬ ë“±)ì„ ë¶„ë¦¬"í•˜ëŠ” ì„¤ê³„ ê¸°ë²•ìœ¼ë¡œ **í•µì‹¬ ë¡œì§(ì˜ˆ: ê³„ì‚°, DB ì²˜ë¦¬)**ê³¼ **ê³µí†µ ì²˜ë¦¬(ì˜ˆ: ë¡œê·¸ ì°ê¸°, ì‹œê°„ ì¸¡ì •, ê¶Œí•œ ì²´í¬)**ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
- AOPëŠ” â€˜ëŒ€ìƒ ê°ì²´â€™ë¥¼ ê°ì‹¸ì„œ(í”„ë¡ì‹œë¡œ ê°ì‹¸ì„œ) ê³µí†µ ì²˜ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ë¼ì›Œë„£ëŠ” ë°©ì‹ì¸ë° **ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ë¹ˆ(= @Component, @Service ë“±ìœ¼ë¡œ ë“±ë¡ëœ ê°ì²´)**ë§Œ í”„ë¡ì‹œë¡œ ê°ì‹¸ì„œ AOPë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤. 
- ì¦‰ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ê°ì²´(ë¹ˆ)ì—ë§Œ í”„ë¡ì‹œê°€ ì”Œì›Œì§€ë‹ˆê¹Œ **@Component/@AutowiredëŠ” AOPì˜ "ì „ì œì¡°ê±´"**ì´ë‹¤. 

- ì•„ë˜ëŠ” aopë¥¼ í™œìš©í•˜ì—¬ ìŠ¤í”„ë§ ê°ì²´ì— í”„ë¡ì‹œë¡œ aspectë¥¼ ì¶”ê°€í•œ ì˜ˆì‹œ ì½”ë“œì´ë‹¤.
```java
@Aspect
@Component // ë¹ˆ ë“±ë¡
public class LogAspect {
    @Before("execution(* kr.hossam.aop.services.MyCalcService.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("[AOP] ë©”ì„œë“œ ì‹¤í–‰ ì „: " + joinPoint.getSignature());
    }
}
```
- @Aspect : ì´ í´ë˜ìŠ¤ê°€ AOP(ë¶€ê°€ê¸°ëŠ¥) ì—­í• ì„ì„ ëª…ì‹œí•œë‹¤.
- @Before("execution(* kr.hossam.aop.services.MyCalcService.*(..))") â†’ MyCalcService ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì„œë“œ ì‹¤í–‰ ì§ì „ì— logBeforeê°€ ì‹¤í–‰ëœë‹¤.
- ì¸í„°ì…‰í„°ì™€ ì´ aopì˜ ì°¨ì´ëŠ” ì¸í„°ì…‰í„°ëŠ” "HTTP ìš”ì²­/ì‘ë‹µ"ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë™ì‘í•˜ê³  aopëŠ” "ë©”ì„œë“œ ì‹¤í–‰"ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê³µí†µ ì²˜ë¦¬ë¥¼ ì‚½ì…í•˜ëŠ”ë°ì— ìˆë‹¤.
- AOPëŠ” "ìŠ¤í”„ë§ ë¹ˆ ë©”ì„œë“œ"ë§Œ ê°€ë¡œì±Œ ìˆ˜ ìˆìœ¼ë‚˜ InterceptorëŠ” HTTP ë ˆë²¨ì—ì„œ ë™ì‘í•˜ì—¬ ì •ì  ìì›, íŒŒì¼ ì—…ë¡œë“œ, ëª¨ë“  ìš”ì²­/ì‘ë‹µì„ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆë‹¤.

| êµ¬ë¶„        | AOP (Aspect)    | Interceptor           |
| --------- | --------------- | --------------------- |
| **ì ìš© ëŒ€ìƒ** | ë¹ˆ(Bean) ë©”ì„œë“œ(ìë°”) | HTTP ìš”ì²­/ì‘ë‹µ(ì›¹ ë ˆì´ì–´)     |
| **ì£¼ ì‚¬ìš©ì²˜** | ì„œë¹„ìŠ¤, ë¡œì§, DB ë“±   | ì¸ì¦, ì¸ê°€, ì„¸ì…˜, ë¦¬ë‹¤ì´ë ‰íŠ¸     |
| **ì„¸ë°€í•¨**   | ë©”ì„œë“œ ë‹¨ìœ„ë¡œ ë§¤ìš° ì„¸ë°€   | ìš”ì²­ ì „ì²´ íë¦„ì— ë„“ê²Œ ì ìš©       |
| **ì£¼ì… ìœ„ì¹˜** | ë©”ì„œë“œ ì‹¤í–‰ ì „/í›„      | ì»¨íŠ¸ë¡¤ëŸ¬ ì‹¤í–‰ ì „/í›„, ì‘ë‹µ ì „     |
| **ì˜ˆì‹œ**    | íŠ¸ëœì­ì…˜, ë¡œê¹…, ì„±ëŠ¥    | ë¡œê·¸ì¸ ì²´í¬, ì ‘ê·¼ ì œí•œ, URL ì²´í¬ |


### ğŸ“Œ 1-1. Spring ë¹ˆ/í”„ë¡ì‹œ/DI ì›ë¦¬ ê¸°ë°˜ webHelper ë¦¬íŒ©í† ë§
- @Component: í´ë˜ìŠ¤ë¥¼ @Componentë¡œ ì„ ì–¸ â†’ ìŠ¤í”„ë§ì´ ì§ì ‘ ê°ì²´ë¡œ ë§Œë“¤ì–´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì•ˆì— ë¹ˆìœ¼ë¡œ ê´€ë¦¬í•¨, í•„ìš”í•  ë•Œë§ˆë‹¤ newë¡œ ë§Œë“¤ì§€ ì•Šê³ , ìŠ¤í”„ë§ì´ ì•Œì•„ì„œ ì‹±ê¸€í„´ ê°ì²´ë¡œ ê´€ë¦¬í•´ì¤Œ. ì¦‰ í˜„ì¬ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë§Œë“¤ì–´ë‘ëŠ” ê²ƒ
- @Autowired: ìŠ¤í”„ë§ì´ í˜„ì¬ ìš”ì²­ì— ë§ëŠ” ê°ì²´ë¥¼ ì•Œì•„ì„œ ë„£ì–´ì£¼ê¸° ë•Œë¬¸ì— ë§¤ê°œë³€ìˆ˜ë¡œ êµ³ì´ ì„¤ì • ì•ˆí•´ë‘ì–´ë„ ê°ì²´ì— ë¶€ì—¬ë  ì´ë¦„ë§Œ ìƒë‹¨ì— ì„ ì–¸í•´ë‘ë©´ êµ³ì´ ë§¤ê°œë³€ìˆ˜ë¡œ ì£¼ì§€ ì•Šë”ë˜ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì´ë•Œ @Component(í˜¹ì€ @Service, @Repository, @Controller ë“±)ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ì´ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ @Autowiredë¡œëŠ” ì ˆëŒ€ ëª» ê°€ì ¸ì˜¨ë‹¤. 
- í”„ë¡ì‹œ ë¹ˆ: ìŠ¤í”„ë§ ë¹ˆì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€í„´(í•˜ë‚˜ë§Œ ìƒì„±)ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ”ë° íŠ¹ì • ìƒí™©ì— ë”°ë¼ "ì‚¬ìš©ìë§ˆë‹¤" ë˜ëŠ” "ìš”ì²­ë§ˆë‹¤" ìƒˆë¡œìš´ ê°ì²´ê°€ í•„ìš”í•  ë•Œê°€ ìˆë‹¤. ì´ëŸ° ê°ì²´ë¥¼ ì¼ë°˜ ì‹±ê¸€í„´ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ë¬¸ì œê°€ ìƒê¸°ë¯€ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ë†“ê³ , ì‹¤ì œ ìš”ì²­/ì„¸ì…˜ì´ ìƒê¸¸ ë•Œ ì§„ì§œ ê°ì²´ë¡œ ì—°ê²°í•´ì£¼ëŠ” ë°©ì‹(í”„ë¡ì‹œ íŒ¨í„´)ì„ ì‚¬ìš©í•œë‹¤. (ì—°ê²°í•´ì£¼ë©´ì„œ ë‹¤ì–‘í•œ ì²˜ë¦¬ë¥¼ ë„£ì„ ìˆ˜ ìˆìŒ.) 
- ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šì•˜ëŠ”ë° @Autowiredë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” HttpServletRequestê°™ì€ ê°ì²´ëŠ” ëª¨ë‘ ì´ëŸ° í”„ë¡ì‹œ ë¹ˆì„ í†µí•´ ìŠ¤í”„ë§ ìì²´ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê°ì²´ì´ë‹¤.
- **ìŠ¤í”„ë§(í˜¹ì€ í†°ìº£ ê°™ì€ WAS)**ì´ ê° ìš”ì²­ë§ˆë‹¤ ì§„ì§œ HttpServletRequest ê°ì²´ë¥¼ ë¨¼ì € ë§Œë“¤ì–´ë‘”ë‹¤. ì´ë•Œ í”„ë¡ì‹œ ë¹ˆì€ ë¬¸ì§€ê¸° ì—­í• ë¡œ ì‹±ê¸€í„´ìœ¼ë¡œ ìƒì„±ë˜ì–´ ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê·¸ ê°ì²´ë¥¼ ëŒ€ì‹  ì „ë‹¬í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰ @Autowired ë˜ì–´ ìˆëŠ” ë§¤ê°œë³€ìˆ˜ëŠ” ìš°ì„  ë¬¸ì§€ê¸°ë¥¼ í•œë²ˆ ê±°ì³ì„œ ê°ì²´ë¥¼ ì—°ê²°ë°›ì•„ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤. ì´ëŠ” ì‹±ê¸€í„´ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ ê°ì²´ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
- êµ³ì´ ì‹±ê¸€í„´ìœ¼ë¡œ í•˜ëŠ” ì´ìœ ëŠ” ë¹ˆì„ ì‹±ê¸€í„´ìœ¼ë¡œ ì£¼ì…í•˜ë©´ â€œíš¨ìœ¨ì ì´ê³ , ì•ˆì „í•˜ê³ , ê´€ë¦¬ë„ ì‰¬ìš´â€ ëŒ€ê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°ë¥¼ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ë‚´ë¶€ì  ì›ë¦¬ì— ë”°ë¥¸ ê²ƒì´ë‹¤.
- ìš°ì„  ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ helperë¥¼ ê°ì²´ ì£¼ì… ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì •í•˜ì˜€ë‹¤. ì´í›„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ webConfig, Interceptorë„ ìˆ˜ì •í•˜ì˜€ë‹¤. ì•„ë˜ëŠ” webhelperë§Œ ì²¨ë¶€í•œë‹¤.
```java
@Slf4j
@Component
public class WebHelper {
    @Autowired
    private HttpServletRequest request;
    private HttpServletResponse response;

    public String getClientIp() {
        String ip = request.getHeader("X-Forwarded-For");

        if (ip == null) {
            ip = request.getHeader("Proxy-Client-IP");
        }
        if (ip == null) {
            ip = request.getHeader("WL-Proxy-Client-IP"); // ì›¹ë¡œì§
        }
        if (ip == null) {
            ip = request.getHeader("HTTP_CLIENT_IP");
        }
        if (ip == null) {
            ip = request.getHeader("HTTP_X_FORWARDED_FOR");
        }
        if (ip == null) {
            ip = request.getRemoteAddr();
        }

        return ip;
    }

    public void writeCookie(String name, String value, int maxAge, String domain, String path) throws Exception {
        if (value != null && !value.equals("")) {
            try {
                value = URLEncoder.encode(value, "utf-8");
            } catch (UnsupportedEncodingException e) {
                // ì˜¤ë¥˜ ì²˜ë¦¬
                log.error("ì¿ í‚¤ê°’ ì¸ì½”ë”© ì‹¤íŒ¨", e);
                throw e;
            }
        }
        Cookie cookie = new Cookie(name, value);
        cookie.setPath(path);

        if (domain != null) {
            cookie.setDomain(domain);
        }
        if (maxAge > 0) {
            cookie.setMaxAge(maxAge);
        }

        response.addCookie(cookie);
    }

    public void writeCookie(String name, String value, int maxAge, String domain) throws Exception {
        this.writeCookie(name, value, maxAge, domain, "/");
    }

    public void writeCookie(String name, String value, int maxAge) throws Exception {
        this.writeCookie(name, value, maxAge, null, "/");
    }

    public void writeCookie(String name, String value) throws Exception {
        this.writeCookie(name, value, 0, null, "/");
    }

    public void deleteCookie(HttpServletResponse response, String name) throws Exception {
        this.writeCookie(name, null, -1, null, "/");
    }
}
```

### ğŸ“Œ 1-2. ì‚¬ì¹™ì—°ì‚° ì„œë¹„ìŠ¤ êµ¬í˜„
- ì•„ë˜ëŠ” ì‚¬ì¹™ì—°ì‚° ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìˆ˜ë¥¼ êµ¬í˜„í•œ ì‹¤ì œ êµ¬í˜„ì²´ì´ë‹¤. 
- @ServiceëŠ” @Componentë¥¼ ìƒì†ë°›ì•„ì„œ ê°™ì€ ì—­í• ì„ í•˜ì§€ë§Œ ê°œë°œìë‚˜ í”„ë¡œê·¸ë¨ì— ì—¬ê¸°ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ ë¹ˆì¸ ê²ƒì„ ì„¤ëª…í•´ì¤€ë‹¤. 
- ì´ëŠ” ì½”ë“œ ì‘ì„±ìì˜ ì˜ë„ë¥¼ ëª…í™•í•˜ê²Œ ë‚˜íƒ€ë‚´ê³  ê³„ì¸µêµ¬ì¡°ë¥¼ êµ¬ë¶„í•˜ëŠ”ë° ë„ì›€ì„ ì¤€ë‹¤.
```java
@Slf4j
@Service // <-- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” ëª¨ë“  êµ¬í˜„ì²´ í´ë˜ìŠ¤ì— ëª…ì‹œ
public class MyCalcServiceImpl implements MyCalcService {
    // ì´ ê°ì²´ê°€ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒì„±ì ì •ì˜í•¨
    // ë³´í†µì˜ Service êµ¬í˜„ì²´ëŠ” ìƒì„±ìë¥¼ ì •ì˜í•˜ì§€ ì•ŠìŒ
    public MyCalcServiceImpl() {
        log.debug("MyCalcServiceImpl() ìƒì„±ì í˜¸ì¶œë¨!");
    }

    @Override
    public int plus(int x, int y) {
        return x + y;
    }

    @Override
    public int minus(int x, int y) {
        return x - y;
    }
}
```

# ğŸ“Œ 2. ë©”ì¼ ë³´ë‚´ê¸°

### ğŸ“Œ 2-1. ë©”ì¼ ë³´ë‚´ê¸° ìœ„í•œ ì„œë²„ ì»¨íƒ, ì„¤ì •
- ìš°ì„  ì–´í”Œë¦¬ì¼€ì´ì…˜ ì†ì„±ì— ì‚¬ìš©í•  ë©”ì¼ ì†ì„±ì„ ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
```json
spring.application.name=mailer

#-------------------------------------------------
# ë””ë²„ê·¸ ëª¨ë“œì—ì„œ ìë™ ê°±ì‹  ì„¤ì •
# í¬ë¡¬ì—ì„œ live reload í™•ì¥ ì„¤ì¹˜ í•„ìš”í•¨
#-------------------------------------------------
spring.devtools.restart.enabled=true

#-------------------------------------------------
# ì „ì†¡ ë°ì´í„° ì••ì¶• (ì„±ëŠ¥ ìµœì í™”)
#-------------------------------------------------
server.compression.enabled=true
server.compression.mime-types=text/html,text/plain,text/css,application/javascript,application/json
server.compression.min-response-size=500

#-------------------------------------------------
# Java Mail
#-------------------------------------------------
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=dd
spring.mail.password=ë°œê¸‰ë°›ì€ ë¹„ë°€ë²ˆí˜¸
#-------------------------------------------------
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
#-------------------------------------------------
# ê°œë°œìê°€ ì§ì ‘ ì •ì˜í•œ í™˜ê²½ì„¤ì • ê°’
# í•œê¸€ì„ ì‚¬ìš©í•´ì•¼ í•  ê²½ìš° ìœ ë‹ˆì½”ë“œë¡œ ë³€í™˜í•´ì„œ ì§€ì •í•´ì•¼ í•¨.
# https://www.learnkoreantools.com/kr/korean-to-unicode
mailhelper.sender.name=\uc131\ud604\uaddc
mailhelper.sender.email=hyungyugood0129@gmail.com
spring.application.name=mailer
```
- ë°œê¸‰ë°›ì€ ë¹„ë°€ë²ˆí˜¸ëŠ” ì•± ë¹„ë°€ë²ˆí˜¸ì—ì„œ ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ ì„¤ì •ì„ í†µí•´ êµ¬ê¸€ì˜ ë©”ì¼ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

### ğŸ“Œ 2-2. ë©”ì¼ ë³´ë‚´ê¸° ì»¨íŠ¸ë¡¤ëŸ¬, html êµ¬ì¡°
- JavaMailSender: ë©”ì¼ì„ ì‰½ê²Œ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤. (ë©”ì¼ì„ ë§Œë“œëŠ” ê³µì¥) ê¸°ì¡´ ìë°”ì—ì„œ javax.mailë¥¼ ì´ìš©í•˜ì—¬ ë³µì¡í•˜ê²Œ ë©”ì¼ì„ ë³´ë‚´ë˜ ë°©ì‹ì„ ìŠ¤í”„ë§ì—ì„œ ê°œì„ í•˜ì˜€ë‹¤.
- ì´ í´ë˜ìŠ¤ëŠ” ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ Autowiredë¡œ ìë™ë“±ë¡ì´ ê°€ëŠ¥í•œë° ì˜ì¡´ì„± ì„¤ì •í• ë•Œ spring-boot-starter-mailì„ ì¶”ê°€í•˜ë©´ í˜¹ì€ ë¹„ìŠ·í•œ ë‹¤ë¥¸ ì˜ì¡´ì„±ì„ ì„¤ì •í•˜ë©´ ìŠ¤í”„ë§ ë¹ˆì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤€ë‹¤.

| ë©”ì„œë“œ                                      | ì„¤ëª…                           |
| ---------------------------------------- | ---------------------------- |
| `createMimeMessage()`                    | ì²¨ë¶€íŒŒì¼, HTML ë“± ë³µì¡í•œ ë©”ì¼ ê°ì²´ ìƒì„±    |
| `createMimeMessage(InputStream)`         | ì…ë ¥ ìŠ¤íŠ¸ë¦¼ì—ì„œ MimeMessage ìƒì„±      |
| `send(MimeMessage message)`              | MimeMessageë¡œ ë©”ì¼ ë°œì†¡           |
| `send(SimpleMailMessage message)`        | ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ë©”ì¼ ë°œì†¡(HTML, ì²¨ë¶€íŒŒì¼ ë¶ˆê°€) |
| `send(MimeMessagePreparator preparator)` | ëŒë‹¤ ë“±ìœ¼ë¡œ ë¯¸ë¦¬ ì¤€ë¹„í•œ ë©”ì¼ í•œë²ˆì— ë³´ë‚´ê¸°     |

- MimeMessageë€ ì´ë©”ì¼ ë‚´ìš©ì„ ì½”ë“œë¡œ í‘œí˜„í•´ì£¼ëŠ” í‘œì¤€ í´ë˜ìŠ¤ë¡œ javax.mailì—ì„œ ì œê³µí•˜ëŠ” ë³µì¡í•œ ì´ë©”ì¼ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì´ë•Œ mimeì€ Multipurpose Internet Mail Extensionsì˜ ì•½ìë¡œ ë‹¤ëª©ì  ì´ë©”ì¼ ì¦‰ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œë„ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆê²Œ ì§€ì›í•œë‹¤ëŠ” ëœ»ì´ë‹¤.
- MimeMessageHelper: ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ë„ìš°ë¯¸(Helper) í´ë˜ìŠ¤ì´ê³  ìŠ¤í”„ë§ì—ì„œ ì œê³µí•œë‹¤. MimeMessage í´ë˜ìŠ¤ì— ê°’ì„ ì…ë ¥í•˜ëŠ” ê²ƒì„ ë‚´ì¥ ë©”ì„œë“œë¥¼ í†µí•´ ë„ì™€ì¤€ë‹¤. 

| ê¸°ëŠ¥            | ì„¤ëª…                                    |
| ------------- | ------------------------------------- |
| setTo         | ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼/ì´ë¦„ ì„¸íŒ…                       |
| setSubject    | ì œëª© ì„¸íŒ…                                 |
| setText       | ë‚´ìš©(plain text ë˜ëŠ” HTML) ì„¸íŒ…             |
| setFrom       | ë³´ë‚´ëŠ” ì‚¬ëŒ(ì´ë©”ì¼/ì´ë¦„/ì¸ì½”ë”©) ì„¸íŒ…                 |
| addAttachment | ì²¨ë¶€íŒŒì¼ ì¶”ê°€                               |
| setCc, setBcc | ì°¸ì¡°(CC), ìˆ¨ì€ì°¸ì¡°(BCC) ì¶”ê°€                  |
| ì¸ì½”ë”© ì§€ì •        | í•œê¸€, íŠ¹ìˆ˜ë¬¸ì ë“± ê¹¨ì§ ë°©ì§€ (ë³´í†µ UTF-8ë¡œ ì„¤ì •)       |
| ë©€í‹°íŒŒíŠ¸ ì§€ì •       | ì²¨ë¶€íŒŒì¼, HTML/í…ìŠ¤íŠ¸ ë™ì‹œ ì§€ì› (ìƒì„±ìì—ì„œ trueë¡œ ì§€ì •) |

```java
@Slf4j
@Controller
public class MailController {
    
    @Autowired
    JavaMailSender javaMailSender;

    @GetMapping("/")
    public String index() {
        return "index";
    }

    @PostMapping("/sendmail")
    public String sendmail(@RequestParam("sender-name") String senderName,
                            @RequestParam("sender-email") String senderEmail,
                            @RequestParam("receiver-name") String receiverName,
                            @RequestParam("receiver-email") String receiverEmail,
                            @RequestParam("subject") String subject,
                            @RequestParam("content") String content) {
        
        log.debug("------------------------------------------------------------");
        log.debug(String.format("SenderName: %s", senderName));
        log.debug(String.format("SenderEmail: %s", senderEmail));
        log.debug(String.format("RecvName: %s", receiverName));
        log.debug(String.format("RecvEmail: %s", receiverEmail));
        log.debug(String.format("Subject: %s", subject));
        log.debug(String.format("Content: %s", content));
        log.debug("------------------------------------------------------------");


        MimeMessage message = javaMailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message);

        
        try {
            helper.setSubject(subject);
            helper.setText(content, true);
            helper.setTo(new InternetAddress(receiverEmail, receiverName, "UTF-8"));
            helper.setFrom(new InternetAddress(senderEmail, senderName, "UTF-8"));
        } catch (MessagingException | UnsupportedEncodingException e) {
            e.printStackTrace();
        }
            
        javaMailSender.send(message);
        
        return "redirect:/";
    }
}
```
- ì•„ë˜ëŠ” í•´ë‹¹ êµ¬ì¡°ì˜ html ì½”ë“œì´ë‹¤.
- actionì— ì•„ë¬´ê²ƒë„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ì§€ê¸ˆ í˜„ì¬ ì£¼ì†Œë¡œ ë‹¤ì‹œ ìš”ì²­ì´ ê°€ê²Œëœë‹¤.
- action="/sendmail"ì€ í™•ì •ì ìœ¼ë¡œ ê°€ëŠ¥í•˜ê³  ì–´ì§œí”¼ ë¡œë“œë ë•Œ index()ë¥¼ ë“¤ë ¸ë‹¤ ê°€ì„œ th:action="@{/sendmail}" ë¼ê³  í•´ë„ ìƒê´€ì´ ì—†ë‹¤.
- ë‹¤ë§Œ í›„ìë¡œ í•˜ëŠ”ê²Œ ì£¼ì†Œê°€ ì¶”ê°€ë˜ê±°ë‚˜ ë³€ê²½ë˜ì—ˆì„ë•Œ ìœ ì§€ë³´ìˆ˜ê°€ í¸í•´ì„œ í›„ìë¡œ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
```html
<body>
    <div th:replace="~{fragments/header :: my-header}"></div>
    <h2>Java ë©”ì¼ ë°œì†¡ ì—°ìŠµ</h2>
    <form method="post" action="/sendmail">
        <div>
            <label for="sender-name">ë°œì‹ ì¸: </label>
            <input type="text" name="sender-name" id="sender-name" />
        </div>
        <div>
            <label for="sender-email">ë°œì‹ ì´ë©”ì¼: </label>
            <input type="email" name="sender-email" id="sender-email" />
        </div>
        <div>
            <label for="receiver-name">ìˆ˜ì‹ ì¸: </label>
            <input type="text" name="receiver-name" id="receiver-name" />
        </div>
        <div>
            <label for="receiver-email">ìˆ˜ì‹ ì´ë©”ì¼: </label>
            <input type="email" name="receiver-email" id="receiver-name" />
        </div>
        <div>
            <label for="subject">ë©”ì¼ì œëª©: </label>
            <input type="text" name="subject" id="subject" />
        </div>
        <hr />
        <textarea name="content" id="content"></textarea>
        <hr />
        <input type="submit" value="ë©”ì¼ë³´ë‚´ê¸°" />
    </form>
    <script src="https://cdn.ckeditor.com/ckeditor5/37.0.1/classic/ckeditor.js"></script>
    <script>
        ClassicEditor.create( document.querySelector( '#content' ) );
    </script>
</body>
```

### ğŸ“Œ 2-3. ë©”ì¼ë¡œ ì£¼ë¬¸ì„œ ë³´ë‚´ê¸°
- ì•„ë˜ëŠ” mailhelperì— ìˆëŠ” ì½”ë“œ ì¤‘ ì¼ë¶€ì¸ë° ì´ë•Œ @ValueëŠ” ìŠ¤í”„ë§ì—ì„œ **í™˜ê²½ì„¤ì • íŒŒì¼(application.properties ë˜ëŠ” application.yml)**ì— ì €ì¥ëœ ê°’ì„ ìë°” ì½”ë“œì˜ ë³€ìˆ˜ì— ìë™ìœ¼ë¡œ ë„£ì–´ì£¼ëŠ”(ì£¼ì…í•˜ëŠ”) ê¸°ëŠ¥ì´ë‹¤. 
```java
@Slf4j
@Component
public class MailHelper {
    @Autowired
    private final JavaMailSender javaMailSender = null;

    // í™˜ê²½ì„¤ì •íŒŒì¼ì— ì„¤ì •ëœ ê°’ì„ ì½ì–´ë“¤ì´ê¸° ìœ„í•œ ë³€ìˆ˜
    @Value("${mailhelper.sender.name}")
    private final String senderName = null;

    @Value("${mailhelper.sender.email}")
    private final String senderEmail = null;
}
```
- ìœ„ì˜ ì½”ë“œëŠ” ì„¤ì • íŒŒì¼ì— ë‚´ê°€ ì„¤ì •í•œ ì•„ë˜ ê²½ë¡œë¥¼ @Valueë¡œ ì°¸ê³ í•˜ì—¬ ë„£ì–´ì¤€ë‹¤. 
```json
mailhelper.sender.name=\uc131\ud604\uaddc
mailhelper.sender.email=hyungyugood0129@gmail.com
```
- webHelperí´ë˜ìŠ¤ì—ì„œ  @Autowired private HttpServletResponse response;ë¥¼ í•´ë†¨ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ê°ì²´ë„ ìë™ìƒì„± ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ êµ³ì´ responseë¥¼ ì–¸ê¸‰í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
```java
webHelper.sendRedirect(500, null, "ë©”ì¼ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
```
- ì•„ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì „ì²´ ì½”ë“œì´ë‹¤. ì„¸ ì¢…ë¥˜ì˜ mapper componentë¥¼ Autowiredí•˜ì—¬ ì‚¬ìš©í•˜ê³  ì²˜ìŒ order í˜ì´ì§€ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ë©´ ìš”ì²­ì´ ë“¤ì–´ì™€ orderOk ë©”ì„œë“œê°€ ì‹¤í–‰ëœë‹¤.
- ì•„ë˜ ì½”ë“œëŠ” db ì²˜ë¦¬ëŠ” ì œì™¸í•˜ì˜€ë‹¤.
- ë©”ì¼ í…œí”Œë¦¿ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ClassPathResource resource = new ClassPathResource("mail_templates/order_result.html"); ì™€ mailTempatePath = resource.getFile().getAbsolutePath(); ì´í›„ template = fileHelper.readString(mailTempatePath);ë¥¼ í†µí•´ mailí…œí”Œë¦¿ ë‚´ìš©ì„ inputstreamìœ¼ë¡œ ê°€ì ¸ì™€ì„œ ë°”ì´íŠ¸ë¥¼ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë³€í™˜ëœ ê°’ì„ í…œí”Œë¦¿ìœ¼ë¡œ ë°›ì•„ë‘”ë‹¤. (fileHelperê°€ ì´ ì²˜ë¦¬ë¥¼ ëŒ€í–‰)
- í•´ë‹¹ í…œí”Œë¦¿ì— ë‚ ì§œ ì •ë³´ì™€ dbì •ë³´, ì‚¬ìš©ì ì…ë ¥ì •ë³´ë¥¼ replaceë¡œ ì…ë ¥í•œë‹¤. 
- ì´í›„ mailHelper.sendMail(orderEmail, subject, template); ë¥¼ í†µí•´ ë©”ì¼ì„ ë³´ë‚´ê³  webHelper.sendRedirect("/mail_templates/order_result"); ë¥¼ í†µí•´ ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™í•´ì¤€ë‹¤. (ì¤‘ë³µê²°ì œë¥¼ ë§‰ê¸°ìœ„í•´)
```java
@Controller
public class OrderController {
    
    @Autowired
    private FileHelper fileHelper = null;

    @Autowired
    private MailHelper mailHelper = null;

    @Autowired
    private WebHelper webHelper = null;

    @GetMapping("/order")
    public String order() {
        return "order";
    }

    @PostMapping("/order_ok")
    public void orderOk(
                        HttpServletResponse response,
                        @RequestParam("order-name") String orderName,
                        @RequestParam("order-email") String orderEmail,
                        @RequestParam("order-price") int orderPrice ) {
        
        // dbì—ì„œ ìƒí’ˆì •ë³´ë¥¼ ê°€ì ¸ì™”ë‹¤ê³  ê°€ì •í•œë‹¤.

        String productName = "ë‚´ê°€ ì£¼ë¬¸í•œ ìƒí’ˆëª…";
        int qty = 1;

        Calendar cal = Calendar.getInstance(); 
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH) + 1;
        int date = cal.get(Calendar.DATE);

        String orderDate = String.format("%dë…„ %dì›” %dì¼", year, month, date);

        String orderNumber = String.format("%04d%02d%02d%02d", year, month, date, 78);

        // db ì €ì¥ì€ ìƒëµ ë‚ ì§œì™€ ì£¼ë¬¸ë‚´ì—­ì„ dbì— ì €ì¥í•´ì•¼í•´ì„œ ì½”ë“œê°€ ì´ ìˆœì„œì¸ ê±° ê°™ë‹¤.

        ClassPathResource resource = new ClassPathResource("mail_templates/order_result.html");
        String mailTempatePath = null;

        try {
            mailTempatePath = resource.getFile().getAbsolutePath();
        } catch (IOException e) {
            webHelper.sendRedirect(500, null, "ë©”ì¼ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        String template = null;

        try {
            template = fileHelper.readString(mailTempatePath);
        } catch (Exception e) {
            webHelper.sendRedirect(500, null, "ë©”ì¼ í…œí”Œë¦¿ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // ë©”ì¼ í…œí”Œë¦¿ ì•ˆì˜ ì¹˜í™˜ì ì²˜ë¦¬
        template = template.replace("{{userName}}", orderName);
        template = template.replace("{{orderNumber}}", orderNumber);
        template = template.replace("{{productName}}", productName);
        template = template.replace("{{qty}}", String.valueOf(qty));
        template = template.replace("{{orderDate}}", orderDate);
        template = template.replace("{{orderPrice}}", String.valueOf(orderPrice));

        // ë©”ì¼ ì œëª©
        String subject = orderName + "ë‹˜ì˜ ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";

        try {
            mailHelper.sendMail(orderEmail, subject, template);
        } catch (Exception e) {
            // ì—ëŸ¬ ë°œìƒ ì‹œ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ê³  ì „ í˜ì´ì§€ë¡œ ì´ë™
            webHelper.sendRedirect(500, null, "ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        // ì£¼ë¬¸ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
        webHelper.sendRedirect("/mail_templates/order_result"); 
    }

    @GetMapping("/order_result")
        public String orderResult() {
        return "order_result";
    } 
}
```
- webHelper.sendRedirect("/order_result"); ì´ë ‡ê²Œë§Œ ì ì–´ì¤˜ë„ ì•„ë˜ì²˜ëŸ¼ helperê°€ êµ¬ì„±ë˜ì–´ìˆì–´ ì´ë™ì´ ëœë‹¤.
```java
/**
     * HTTP ìƒíƒœ ì½”ë“œ 200ìœ¼ë¡œ ì„±ê³µê³¼ ë©”ì‹œì§€ ì¶œë ¥ ì—†ì´ ì§€ì •ëœ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
     * @param response - HttpServletResponse ê°ì²´
     */
    public void sendRedirect(String url) {
        this.sendRedirect(200, url, null);
    }
```
- ë©”ì¼ í…œí”Œë¦¿ì€ ì•„ë˜ì™€ ê°™ì€ë° ì¹˜í™˜ìëŠ” ë³¸ì¸ì´ ì•Œì•„ì„œ ì •í•˜ë©´ ëœë‹¤.
- ì´ëŸ° ì´ë©”ì¼ë¡œ ë³´ë‚¼ í…œí”Œë¦¿ì— í¬í•¨ë  ì´ë¯¸ì§€ëŠ” ì¸í„°ë„·ì— ê²€ìƒ‰í•´ì„œ ë‚˜ì˜¤ê²Œ í•  ìˆ˜ ìˆëŠ” ì ˆëŒ€ê²½ë¡œë¥¼ ë„£ëŠ” ê²ƒì´ ë§ë‹¤.
```html
<body>
    <div class="email-container">
        <div class="email-header">
            ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
        </div>
        <div class="email-body">
            <div class="logo-img">
                <img src="https://img.megastudyacademy.co.kr/campus/intra/logo/B0002/2022111413335616684004367613.png" />
            </div>
            <h1>ì•ˆë…•í•˜ì„¸ìš”, {{userName}}ë‹˜!</h1>
            <p>ê³ ê°ë‹˜ì˜ ì˜¨ë¼ì¸ ê²°ì œìš”ì²­ì€ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì£¼ë¬¸ ë‚´ì—­ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
            <div class="order-details">
                <h2>ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h2>
                <p><strong>ì£¼ë¬¸ ë²ˆí˜¸ :</strong> {{orderNumber}}</p>
                <p><strong>ì£¼ë¬¸ ìƒí’ˆ :</strong> {{productName}}</p>
                <p><strong>ìˆ˜ëŸ‰ :</strong> {{qty}}</p>
                <p><strong>ë°°ì†¡ì§€ :</strong> {{orderDesti}}</p>
                <p><strong>ì´ ê²°ì œ ê¸ˆì•¡ :</strong> {{orderPrice}}ì›</p>
            </div>
            <p>ì£¼ë¬¸í•˜ì‹  ë¬¼í’ˆì€ ì‹œì¼ ë‚´ì— ë°œì†¡ë  ì˜ˆì •ì…ë‹ˆë‹¤. ë°°ì†¡ ì§„í–‰ ìƒí™©ì€ ë³„ë„ì˜ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br>
            ì¶”ê°€ ë¬¸ì˜ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì €í¬ ê³ ê°ì„¼í„°ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.</p>
        </div>
        <div class="email-footer">
            Â© 2024 ë©”ê°€ìŠ¤í„°ë”” IT ì•„ì¹´ë°ë¯¸. All rights reserved.<br>
            <a href="#">ì´ìš©ì•½ê´€</a> | <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
        </div>
    </div>
</body>
```


